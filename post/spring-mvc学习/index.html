<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-180310890-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-180310890-1');
</script>

  <meta charset="UTF-8">
  <title>Spring MVC学习 - 代码L</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  
  <meta name="description" content="自学导航 idea版&#43;黑马程序员学习视频 笔记源码资料： 链接：https://pan.baidu.com/s/1hcgH_mkHJYuQQcM3">
  
  <meta itemprop="name" content="Spring MVC学习 - 代码L">
  <meta itemprop="description" content="自学导航 idea版&#43;黑马程序员学习视频 笔记源码资料： 链接：https://pan.baidu.com/s/1hcgH_mkHJYuQQcM3">
  <meta itemprop="image" content="https://qianlong98.github.io/img/author.jpg">
  
  
  <meta name="twitter:description" content="">
  
  <link rel="shortcut icon" href="https://qianlong98.github.io/img/favicon.ico"/>
  <link rel="apple-touch-icon" href="https://qianlong98.github.io/apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="https://qianlong98.github.io/apple-touch-icon.png" />
  <link rel="stylesheet" href="https://qianlong98.github.io/highlight/styles/github.css">
  <script src="https://qianlong98.github.io/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  
  <link rel="stylesheet" href="https://qianlong98.github.io/font/hack/css/hack.min.css">
  <link rel="stylesheet" href="https://qianlong98.github.io/css/style.css">
</head>

<body>
  <header>
    <div>
  <div id="imglogo">
    <a href="https://qianlong98.github.io/"><img src='https://qianlong98.github.io/img/logo.svg' alt="代码L" title="代码L"/></a>
  </div>
  <div id="textlogo">
    <h1 class="site-name"><a href="https://qianlong98.github.io/" title="代码L">代码L</a></h1>
    <h2 class="blog-motto">一个勇敢的快乐boy</h2>
  </div>
  <div class="navbar"><a class="navbutton navmobile" href="#" title="menu"></a></div>
  <nav class="animated">
    <ul>
      
      
      <li><a href="/">首页</a></li>
      
      <li><a href="/about">关于</a></li>
      
      
      <li>
        <form class="search" method="get" action="https://www.google.com/search">
          <div>
            <input type="text" id="search" name="q" placeholder='搜索'>
          </div>
        </form>
      </li>
    </ul>
  </nav>
</div>

  </header>
  <div id="container">
    <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody">
    <header class="article-info clearfix">
  <h1 itemprop="name">
      <a href="https://qianlong98.github.io/post/spring-mvc%E5%AD%A6%E4%B9%A0/" title="Spring MVC学习" itemprop="url">Spring MVC学习</a>
  </h1>
  <p class="article-author">By
    
      <a href="https://qianlong98.github.io/post/" title="代码L">代码L</a>
    
  </p>
  <p class="article-time">
    <time datetime="2020-11-23 14:39:25 &#43;0800 CST" itemprop="datePublished">2020年11月23日</time>
  </p>
</header>

	<div class="article-content">
    
		<div class="toc-article">
			<strong class="toc-title">文章目录</strong>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#idea版黑马程序员学习视频httpswwwbilibilicomvideobv1mt411g7a8p1"><a href="https://www.bilibili.com/video/BV1Mt411G7A8?p=1">idea版+黑马程序员学习视频</a></a></li>
    <li><a href="#笔记源码资料">笔记源码资料：</a></li>
    <li><a href="#eclipse版尚硅谷学习视频httpswwwbilibilicomvideobv1bb411v7icp1"><a href="https://www.bilibili.com/video/BV1Bb411V7ic?p=1">eclipse版+尚硅谷学习视频</a></a></li>
    <li><a href="#笔记源码资料-1">笔记源码资料：</a></li>
    <li><a href="#推荐本人采用---eclipse版ssmspringspring-mvcmybatis尚硅谷_雷丰阳-学习视频httpswwwbilibilicomvideobv1ue411c7cwp8">推荐：（本人采用）   									<a href="https://www.bilibili.com/video/BV1uE411C7CW?p=8">eclipse版+ssm（spring+spring mvc+mybatis）+尚硅谷_雷丰阳 学习视频</a></a></li>
    <li><a href="#笔记资料工具">笔记资料工具：</a></li>
  </ul>

  <ul>
    <li><a href="#mvc新的软件架构模式">MVC：新的软件架构模式</a></li>
  </ul>

  <ul>
    <li><a href="#1导包">1、导包</a></li>
    <li><a href="#2写配置">2、写配置</a></li>
    <li><a href="#3测试">3、测试</a></li>
    <li><a href="#4helloworld细节">4、HelloWorld细节</a>
      <ul>
        <li><a href="#3总体架构image-20201127091639277httpsilolinet20201127nxgicumfs6csr4gpng">3.<strong>总体架构：</strong><img src="https://i.loli.net/2020/11/27/NxGicuMFS6CsR4g.png" alt="image-20201127091639277"></a></li>
        <li><a href="#4webxml">4.<strong>web.xml:</strong></a></li>
        <li><a href="#5springdispatcherservlet-servletxml">5.<strong>springDispatcherServlet-servlet.xml:</strong></a></li>
        <li><a href="#6controller类">6.<strong>Controller类：</strong></a></li>
        <li><a href="#7indexjsp">7.<strong>index.jsp:</strong></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1rest风格是什么">1、REST风格是什么？</a></li>
    <li><a href="#2总体架构image-20201127101303126httpsilolinet20201127lfszjad3tamsqrxpng">2、总体架构<img src="https://i.loli.net/2020/11/27/LFSZJaD3TAMsQRX.png" alt="image-20201127101303126"></a></li>
    <li><a href="#3webxml">3、web.xml</a></li>
    <li><a href="#4springmvc-servletxml">4、springMvc-servlet.xml</a></li>
    <li><a href="#5controller类">5、Controller类</a></li>
    <li><a href="#6indexjsp">6、index.jsp</a></li>
    <li><a href="#7successjsp">7、success.jsp:</a>
      <ul>
        <li><a href="#注意">==注意==：</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1总体架构image-20201127110153768httpsilolinet20201127tyl9jgsfmqoirmdpng">1、总体架构<img src="https://i.loli.net/2020/11/27/tYL9JgSFMqoiRmd.png" alt="image-20201127110153768"></a></li>
    <li><a href="#2webxml">2、web.xml</a></li>
    <li><a href="#3springmvc-servletxml">3、springMvc-servlet.xml</a></li>
    <li><a href="#4pojo">4、Pojo</a></li>
    <li><a href="#5controller类-1">5、Controller类</a></li>
    <li><a href="#6indexjsp-1">6、index.jsp</a></li>
  </ul>

  <ul>
    <li><a href="#1总体架构image-20201203084619687httpsilolinet202012033lkca2mucdlywevpng">1、总体架构<img src="https://i.loli.net/2020/12/03/3LkcA2MuCDlYwEV.png" alt="image-20201203084619687"></a></li>
    <li><a href="#2webxml-1">2、web.xml</a></li>
    <li><a href="#3springdispatcherservlet-servletxml">3、springDispatcherServlet-servlet.xml</a></li>
    <li><a href="#4controller类">4、Controller类</a></li>
    <li><a href="#5indexjsp">5、index.jsp</a></li>
    <li><a href="#6successjsp">6、success.jsp</a></li>
    <li><a href="#7modelattribute原理">7、ModelAttribute原理：</a></li>
  </ul>

  <ul>
    <li><a href="#1前端控制器">1、前端控制器</a></li>
    <li><a href="#2dodispatch详细细节">2、doDispatch()详细细节：</a></li>
    <li><a href="#3gethandler细节">3、getHandler()细节：</a>
      <ul>
        <li><a href="#1怎么根据当前请求就能找到哪个类能来处理">1.怎么根据当前请求就能找到哪个类能来处理</a></li>
        <li><a href="#2如何找到目标处理器类的适配器">2.如何找到目标处理器类的适配器？</a></li>
      </ul>
    </li>
    <li><a href="#4springmvc九大组件">4、SpringMVC九大组件：</a>
      <ul>
        <li><a href="#1springmvc的九大组件工作原理">1.SpringMVC的九大组件工作原理：</a></li>
        <li><a href="#2dispatcherservlet中九大组件初始化的地方">2.DispatcherServlet中九大组件初始化的地方：</a></li>
        <li><a href="#3初始化handlermapping">3.初始化HandlerMapping：</a></li>
        <li><a href="#4组件的初始化">4.组件的初始化：</a></li>
        <li><a href="#5未完待续版本不一致">5.未完待续(版本不一致)</a></li>
        <li><a href="#6sessionattributesvaluehaha">6.<code>@SessionAttributes(value=&quot;haha&quot;)</code></a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1源码">1、源码</a>
      <ul>
        <li><a href="#1modelandview">1.ModelAndView</a></li>
        <li><a href="#2来到页面的方法">2.来到页面的方法</a></li>
        <li><a href="#3渲染页面">3.渲染页面</a></li>
        <li><a href="#4view与viewresolver">4.View与ViewResolver</a></li>
        <li><a href="#5怎么能根据方法的返回值视图名得到view对象">5.怎么能根据方法的返回值（视图名）得到View对象？</a></li>
        <li><a href="#6resolveviewname实现">6.resolveViewName实现：</a></li>
        <li><a href="#7创建view对象">7.创建view对象</a></li>
        <li><a href="#8视图接口">8.视图接口</a></li>
        <li><a href="#9返回view对象">9.返回View对象</a></li>
      </ul>
    </li>
    <li><a href="#2总结">2、总结：</a>
      <ul>
        <li><a href="#1viewresolver接口">1.ViewResolver接口</a></li>
        <li><a href="#2视图">2.视图</a></li>
      </ul>
    </li>
    <li><a href="#3国际化">3、国际化</a>
      <ul>
        <li><a href="#1javaweb国际化步骤">1.javaWeb国际化步骤</a></li>
        <li><a href="#2jstlview">2.Jstlview</a></li>
        <li><a href="#3注意">3.注意</a></li>
        <li><a href="#4扩展">4.扩展</a></li>
        <li><a href="#5自定义视图和视图解析器">5.自定义视图和视图解析器</a></li>
      </ul>
    </li>
    <li><a href="#4总体架构image-20201203141147863httpsilolinet20201203sckz1spvuge9ncdpng">4、总体架构：<img src="https://i.loli.net/2020/12/03/SCKZ1sPVUge9ncd.png" alt="image-20201203141147863"></a></li>
    <li><a href="#5webxml同上">5、web.xml(同上)</a></li>
    <li><a href="#6springdispatcherservlet-servletxml">6、springDispatcherServlet-servlet.xml</a></li>
    <li><a href="#7jsp">7、jsp</a></li>
    <li><a href="#8conf国际化properties">8、conf(国际化properties)</a></li>
    <li><a href="#9view自定义视图">9、view(自定义视图)</a></li>
    <li><a href="#10controller类">10、Controller类</a></li>
  </ul>

  <ul>
    <li><a href="#1需求">1、需求</a>
      <ul>
        <li><a href="#1员工列表">1.员工列表</a></li>
        <li><a href="#2员工添加">2.员工添加</a></li>
        <li><a href="#3员工修改">3.员工修改</a></li>
        <li><a href="#4员工删除-点击完成删除来到列表页面">4.员工删除-点击完成删除来到列表页面</a></li>
      </ul>
    </li>
    <li><a href="#2逻辑">2、逻辑</a></li>
    <li><a href="#3总体架构image-20201203160818936httpsilolinet20201203nd8giwzv2klibe3png">3、总体架构：<img src="https://i.loli.net/2020/12/03/nd8gIwzV2KlibE3.png" alt="image-20201203160818936"></a></li>
    <li><a href="#4webxml-1">4、web.xml</a></li>
    <li><a href="#5springmvcxml">5、springmvc.xml</a></li>
    <li><a href="#6jsp页面">6、jsp页面</a></li>
    <li><a href="#7bean">7、bean</a></li>
    <li><a href="#8dao">8、dao</a></li>
    <li><a href="#9controller">9、Controller</a></li>
  </ul>

  <ul>
    <li><a href="#1新的源码">1、新的源码</a>
      <ul>
        <li><a href="#modelattributemethodprocessor">ModelAttributeMethodProcessor</a></li>
      </ul>
    </li>
    <li><a href="#2webdatabinder数据绑定器">2、WebDataBinder（数据绑定器）</a>
      <ul>
        <li><a href="#1conversionservice组件">1.ConversionService组件</a></li>
        <li><a href="#2validators">2.validators</a></li>
        <li><a href="#3bindresult">3.bindResult</a></li>
      </ul>
    </li>
    <li><a href="#3数据绑定流程">3、数据绑定流程</a></li>
    <li><a href="#4自定义类型转换">4、自定义类型转换</a>
      <ul>
        <li><a href="#1步骤">1.步骤</a></li>
        <li><a href="#2总结三步换一种说法">2.总结三步（换一种说法）</a></li>
      </ul>
    </li>
    <li><a href="#5mvcannotation-driven">5、<code>&lt;mvc:annotation-driven/&gt;</code></a>
      <ul>
        <li><a href="#1springmvc解析mvcannotation-driven标签">1.SpringMVC解析<code>&lt;mvc:annotation-driven/&gt;</code>标签</a></li>
        <li><a href="#2mvcdefault-servlet-handler和mvcannotation-driven">2.<code>&lt;mvc:default-servlet-handler/&gt;</code>和	<code>mvc:annotation-driven</code></a></li>
      </ul>
    </li>
    <li><a href="#6格式化">6、格式化</a>
      <ul>
        <li><a href="#1需求-1">1.需求</a></li>
        <li><a href="#2解决">2.解决</a></li>
      </ul>
    </li>
    <li><a href="#7数据校验">7、数据校验</a>
      <ul>
        <li><a href="#1jsr-303">1.JSR 303</a></li>
        <li><a href="#2如何快速的进行后端校验">2.如何快速的进行后端校验</a></li>
        <li><a href="#3原生的表单怎么办">3.原生的表单怎么办？</a></li>
        <li><a href="#4国际化定制自己的错误消息显示">4.国际化定制自己的错误消息显示</a></li>
        <li><a href="#5简单错误消息显示不能国际化">5.简单错误消息显示（不能国际化）</a></li>
      </ul>
    </li>
    <li><a href="#8ajax">8、ajax</a>
      <ul>
        <li><a href="#1springmvc快速的完成ajax功能">1.SpringMVC快速的完成ajax功能</a></li>
      </ul>
    </li>
    <li><a href="#9总体架构image-20201211175931170httpsilolinet20201211jh75l6xtliaacuqpng">9、总体架构：<img src="https://i.loli.net/2020/12/11/jH75l6xTLiaACuq.png" alt="image-20201211175931170"></a></li>
    <li><a href="#10webxml">10、web.xml</a></li>
    <li><a href="#11springmvcxml">11、springmvc.xml</a></li>
    <li><a href="#12jsp页面">12、jsp页面</a></li>
    <li><a href="#13bean">13、bean</a></li>
    <li><a href="#14component">14、component</a></li>
    <li><a href="#15controller">15、Controller</a></li>
    <li><a href="#16文件上传">16、文件上传</a>
      <ul>
        <li><a href="#1indexjsp">1.index.jsp</a></li>
        <li><a href="#2springmvcxml">2.springmvc.xml</a></li>
        <li><a href="#3uploadcontroller">3.UploadController</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1介绍">1、介绍</a></li>
    <li><a href="#2设置拦截器">2、设置拦截器</a></li>
    <li><a href="#3拦截器的运行流程">3、拦截器的运行流程</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#4源码">4、源码</a>
      <ul>
        <li><a href="#1prehandler">1.preHandler</a></li>
        <li><a href="#2posthandle">2.postHandle</a></li>
        <li><a href="#3页面渲染逻辑">3.页面渲染逻辑</a></li>
        <li><a href="#4aftercompletion">4.afterCompletion</a></li>
      </ul>
    </li>
    <li><a href="#5流程总结图">5、流程总结图</a></li>
    <li><a href="#6filter和拦截器使用时机">6、Filter和拦截器使用时机</a></li>
  </ul>

  <ul>
    <li><a href="#1简单国际化">1、简单国际化</a>
      <ul>
        <li><a href="#1写好国际化资源文件">1.写好国际化资源文件</a></li>
        <li><a href="#2让spring的resourcebundlemessagesource管理国际化资源文件">2.让Spring的ResourceBundleMessageSource管理国际化资源文件</a></li>
        <li><a href="#3直接去页面取值">3.直接去页面取值</a></li>
      </ul>
    </li>
    <li><a href="#2页面显示现象">2、页面显示现象</a></li>
    <li><a href="#3javaweb获取浏览器区域信息">3、javaWeb获取浏览器区域信息</a></li>
    <li><a href="#4springmvc区域信息">4、SpringMVC区域信息</a></li>
    <li><a href="#5区域信息解析器">5、区域信息解析器</a>
      <ul>
        <li><a href="#1acceptheaderlocaleresolver">1.AcceptHeaderLocaleResolver</a></li>
        <li><a href="#2fixedlocaleresolver">2.FixedLocaleResolver</a></li>
        <li><a href="#3sessionlocaleresolver">3.SessionLocaleResolver</a></li>
        <li><a href="#4cookielocaleresolver">4.CookieLocaleResolver</a></li>
      </ul>
    </li>
    <li><a href="#6点击链接切换国际化">6、点击链接切换国际化</a>
      <ul>
        <li><a href="#1自定义区域信息解析器推荐">1.自定义区域信息解析器(推荐)</a></li>
        <li><a href="#2区域信息从session中拿">2.区域信息从session中拿</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#1源码-1">1、源码</a>
      <ul>
        <li><a href="#1handlerexceptionresolver">1.HandlerExceptionResolver</a></li>
        <li><a href="#2异常处理">2.异常处理</a></li>
        <li><a href="#3异常解析">3.异常解析</a></li>
      </ul>
    </li>
    <li><a href="#2异常解析器用法">2、异常解析器用法</a></li>
    <li><a href="#3集中处理异常推荐">3、集中处理异常（推荐）</a></li>
    <li><a href="#4simplemappingexceptionresolver">4、<strong>SimpleMappingExceptionResolver</strong></a></li>
  </ul>

  <ul>
    <li><a href="#1目的分工明确">1、目的（分工明确）</a></li>
    <li><a href="#2配置文件">2、配置文件</a></li>
    <li><a href="#3springmvc和spring分容器">3、SpringMVC和Spring分容器</a></li>
    <li><a href="#4-spring-mvc-配置文件中引用业务层的-bean">4、 Spring MVC 配置文件中引用业务层的 Bean</a></li>
  </ul>
</nav>
		</div>
    
    <hr>
<h1 id="自学导航">自学导航</h1>
<h2 id="idea版黑马程序员学习视频httpswwwbilibilicomvideobv1mt411g7a8p1"><a href="https://www.bilibili.com/video/BV1Mt411G7A8?p=1">idea版+黑马程序员学习视频</a></h2>
<h2 id="笔记源码资料">笔记源码资料：</h2>
<p>链接：https://pan.baidu.com/s/1hcgH_mkHJYuQQcM3VQaBWQ
提取码：rt0t
复制这段内容后打开百度网盘手机App，操作更方便哦&ndash;来自百度网盘超级会员V2的分享</p>
<hr>
<h2 id="eclipse版尚硅谷学习视频httpswwwbilibilicomvideobv1bb411v7icp1"><a href="https://www.bilibili.com/video/BV1Bb411V7ic?p=1">eclipse版+尚硅谷学习视频</a></h2>
<h2 id="笔记源码资料-1">笔记源码资料：</h2>
<p>链接：https://pan.baidu.com/s/1vNq5JTAp4sAu6e_eM_2qww
提取码：f8ac
复制这段内容后打开百度网盘手机App，操作更方便哦&ndash;来自百度网盘超级会员V2的分享</p>
<hr>
<h2 id="推荐本人采用---eclipse版ssmspringspring-mvcmybatis尚硅谷_雷丰阳-学习视频httpswwwbilibilicomvideobv1ue411c7cwp8">推荐：（本人采用）   									<a href="https://www.bilibili.com/video/BV1uE411C7CW?p=8">eclipse版+ssm（spring+spring mvc+mybatis）+尚硅谷_雷丰阳 学习视频</a></h2>
<h2 id="笔记资料工具">笔记资料工具：</h2>
<p>链接：https://pan.baidu.com/s/1vi8-mYl8h5BLeO2QMN_-ww
提取码：czx8
复制这段内容后打开百度网盘手机App，操作更方便哦&ndash;来自百度网盘超级会员V2的分享</p>
<hr>
<h1 id="一spring-mvc简介">一、Spring MVC简介</h1>
<h2 id="mvc新的软件架构模式">MVC：新的软件架构模式</h2>
<p><strong>M</strong>：Model模型：封装和映射数据（JavaBean）</p>
<p><strong>V</strong>：View视图：界面显示工作（.jsp）</p>
<p><strong>C</strong>：Controller控制器：控制整个网站的跳转逻辑（Servlet）</p>
<p><img src="https://gitee.com/qianlong98/blogimage/raw/master/img/20201125105954.png" alt="image-20201125105953701"></p>
<hr>
<h1 id="二helloworld">二、HelloWorld:</h1>
<p><strong>新建Web动态工程：</strong></p>
<p><img src="https://gitee.com/qianlong98/blogimage/raw/master/img/20201125114130.png" alt="image-20201125114130843"></p>
<p><img src="https://gitee.com/qianlong98/blogimage/raw/master/img/20201125114146.png" alt="image-20201125114146911"></p>
<h2 id="1导包">1、导包</h2>
<p>spring相关jar包（spring-5.2.9）</p>
<blockquote>
<hr>
</blockquote>
<blockquote>
<p>链接：https://pan.baidu.com/s/15X79BzT2_dGS_wviCJiKYQ
提取码：8e71
复制这段内容后打开百度网盘手机App，操作更方便哦&ndash;来自百度网盘超级会员V2的分享</p>
</blockquote>
<hr>
<ul>
<li>核心容器模块：</li>
</ul>
<p><img src="https://gitee.com/qianlong98/blogimage/raw/master/img/20201125114544.png" alt="image-20201125114544246"></p>
<ul>
<li>web模块：</li>
</ul>
<p><img src="https://gitee.com/qianlong98/blogimage/raw/master/img/20201125134151.png" alt="image-20201125134151781"></p>
<h2 id="2写配置">2、写配置</h2>
<ul>
<li><strong>web.xml：</strong></li>
</ul>
<p>配置springmvc的前端控制器，指定springmvc配置文件位置</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span> <span class="na">id=</span><span class="s">&#34;WebApp_ID&#34;</span> <span class="na">version=</span><span class="s">&#34;3.1&#34;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;display-name&gt;</span>1.SpringMVC_helloWorld<span class="nt">&lt;/display-name&gt;</span>
  <span class="nt">&lt;welcome-file-list&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.jsp<span class="nt">&lt;/welcome-file&gt;</span>
  <span class="nt">&lt;/welcome-file-list&gt;</span>
  
  <span class="c">&lt;!-- SpringMVC思想是有一个前端控制器能拦截所有请求，并智能派发
</span><span class="c">  		这个前端控制器是一个Servlet：应该在web.xml中配置这个servlet来拦截所有请求
</span><span class="c">   --&gt;</span>
   <span class="c">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span>
	<span class="nt">&lt;servlet&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springDispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
		<span class="c">&lt;!-- contextConfigLocation：指定springMVC配置文件位置 --&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>classpath:springmvc.xml<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="c">&lt;!-- servlet启动加载，servlet原本是第一次访问创建对象；
</span><span class="c">		load-on-startup:服务启动的时候创建对象：值越小优先级越高，越先创建对象；
</span><span class="c">		 --&gt;</span>
		<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
	<span class="nt">&lt;/servlet&gt;</span>

	<span class="c">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span>
	<span class="nt">&lt;servlet-mapping&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springDispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="c">&lt;!--
</span><span class="c">		   /*和/都是拦截所有请求；/：会拦截所有请求，但不会拦截*.jsp；能保证jsp访问正常；
</span><span class="c">		   /*的范围更大；还会拦截到*.jsp这些请求；一旦拦截jsp页面就不能显示了；
</span><span class="c">		 --&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/servlet-mapping&gt;</span>
  
<span class="nt">&lt;/web-app&gt;</span>
</code></pre></div><ul>
<li>框架自身</li>
</ul>
<p><strong>springmvc.xml：</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
	<span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
	<span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd&#34;</span><span class="nt">&gt;</span>

	<span class="c">&lt;!-- 扫描所有组件 --&gt;</span>
	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.lql&#34;</span><span class="nt">/&gt;</span>
	<span class="c">&lt;!-- 配置一个视图解析器：能帮我们拼接页面地址 --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/pages/&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>

</code></pre></div><p><strong>Controller类：</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 1.告诉SpringMVC这是一个处理器，可以处理请求
</span><span class="cm"> * 		@Controller，表示哪个组件是控制器
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyFirstController</span> <span class="o">{</span>
	<span class="cm">/**
</span><span class="cm">	 *  /代表从当前项目下开始：处理当前项目下的hello请求
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">myfirstRequest</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;请求收到了....正在处理中&#34;</span><span class="o">);</span>
		<span class="c1">//视图解析器自动拼串
</span><span class="c1"></span>		<span class="c1">//&lt;property name=&#34;prefix&#34; value=&#34;/WEB-INF/pages/&#34;&gt;&lt;/property&gt;
</span><span class="c1"></span>		<span class="c1">//&lt;property name=&#34;suffix&#34; value=&#34;.jsp&#34;&gt;&lt;/property&gt;
</span><span class="c1"></span>		<span class="c1">//    (拼接)/WEB-INF/pages/+返回值(success)+后缀(.jsp)
</span><span class="c1"></span>		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">MyFirstController</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated constructor stub
</span><span class="c1"></span>	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div><hr>
<ul>
<li><strong>总体架构：</strong></li>
</ul>
<p><img src="https://gitee.com/qianlong98/blogimage/raw/master/img/20201125154501.png" alt="image-20201125154501672"></p>
<h2 id="3测试">3、测试</h2>
<h2 id="4helloworld细节">4、HelloWorld细节</h2>
<h3 id="3总体架构image-20201127091639277httpsilolinet20201127nxgicumfs6csr4gpng">3.<strong>总体架构：</strong><img src="https://i.loli.net/2020/11/27/NxGicuMFS6CsR4g.png" alt="image-20201127091639277"></h3>
<hr>
<h3 id="4webxml">4.<strong>web.xml:</strong></h3>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span> <span class="na">id=</span><span class="s">&#34;WebApp_ID&#34;</span> <span class="na">version=</span><span class="s">&#34;3.1&#34;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;display-name&gt;</span>2.SpringMVC_helloWorld<span class="nt">&lt;/display-name&gt;</span>
  <span class="nt">&lt;welcome-file-list&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.jsp<span class="nt">&lt;/welcome-file&gt;</span>
  <span class="nt">&lt;/welcome-file-list&gt;</span>
  
  <span class="c">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span>
	<span class="nt">&lt;servlet&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springDispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
		<span class="c">&lt;!-- &lt;init-param&gt;
</span><span class="c">			&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
</span><span class="c">			&lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;
</span><span class="c">		&lt;/init-param&gt; --&gt;</span>
		<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
	<span class="nt">&lt;/servlet&gt;</span>

	<span class="c">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span>
	<span class="c">&lt;!-- /：拦截所有请求，不拦截jsp页面（*.jsp请求）
</span><span class="c">		 /*：拦截所有请求，拦截jsp页面（*.jsp请求）
</span><span class="c">		 
</span><span class="c">		 
</span><span class="c">		 处理*.jsp是tomcat做的事，所有项目的小web.xml都是继承于大web.xml
</span><span class="c">		 DefaultServlet是Tomcat中处理静态资源的；
</span><span class="c">		 	除过jsp和servlet外剩下的都是静态资源，
</span><span class="c">		 	index.html是静态资源，tomcat就会在服务器下找到这个资源并返回；
</span><span class="c">		 	我们前端控制器的/禁用了tomcat服务器中的DefaultServlet
</span><span class="c">		 	
</span><span class="c">		 1）服务器的大web.xml中有一个DefaultServlet是url-pattern=/
</span><span class="c">		 2)我们的配置中前端控制器url-pattern=/
</span><span class="c">		 	静态资源会来到DispatcherServlet（前端控制器）看哪个方法的RequestMapping是这个index.html
</span><span class="c">		 3)为什么jsp能访问呢？因为我们没有覆盖服务器中的JspServlet的配置
</span><span class="c">		 4）/* 直接就是拦截所有请求；写/，也是为了迎合后来的Rest风格的URL地址
</span><span class="c">		 		REST:资源表现层状态转化
</span><span class="c">	 --&gt;</span>
	<span class="nt">&lt;servlet-mapping&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springDispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/servlet-mapping&gt;</span>
  
<span class="nt">&lt;/web-app&gt;</span>
</code></pre></div><hr>
<h3 id="5springdispatcherservlet-servletxml">5.<strong>springDispatcherServlet-servlet.xml:</strong></h3>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
	<span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
	<span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd&#34;</span><span class="nt">&gt;</span>

<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.lql&#34;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>

	<span class="c">&lt;!-- 视图解析器，可以简化方法的返回值，返回值就是作为目标页面地址，
</span><span class="c">		   只不过视图解析器可以帮我们拼串
</span><span class="c">	 --&gt;</span>
 	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
 		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/pages/&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
 		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
 	<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>

</code></pre></div><hr>
<h3 id="6controller类">6.<strong>Controller类：</strong></h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 1.告诉SpringMVC这个类是一个处理器
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *HelloWorld 细节：
</span><span class="cm"> *1、运行流程：
</span><span class="cm"> *		1）、客户端点击链接会发送http://localhost:8080/springmvc/hello
</span><span class="cm"> *		2）、来到tomcat服务器
</span><span class="cm"> *		3）、SpringMVC的前端控制器收到所有请求
</span><span class="cm"> *		4）、来看请求地址和@RequestMapping标注的哪个匹配，来找到底使用哪个类的哪个方法
</span><span class="cm"> *		5）、前端控制器找到了目标处理器类和目标方法，直接利用反射执行目标方法
</span><span class="cm"> *		6）、方法执行完成以后会有一个返回值，SpringMVC认为这个返回值就是要去的页面地址
</span><span class="cm"> *		7）、拿到方法返回值以后，用视图解析器进行拼串得到完整的页面地址
</span><span class="cm"> *		8）、拿到页面地址，前端控制器帮我们转发到页面
</span><span class="cm"> *
</span><span class="cm"> *2、@RequestMapping：
</span><span class="cm"> *		就是告诉SpringMVC，这个方法用来处理什么请求；
</span><span class="cm"> *		这个/是可以省略的，即使省略了，也是默认从当前项目下开始
</span><span class="cm"> *		习惯加上比较好  /hello
</span><span class="cm"> *		@RequestMapping的使用（后面再说）
</span><span class="cm"> *
</span><span class="cm"> *3、如果不指定配置文件位置
</span><span class="cm"> *	也会默认去找一个文件：/WEB-INF/springDispatcherServlet-servlet.xml
</span><span class="cm"> *	就在web应用的/WEB-INF下创建一个名叫 前端控制器名-servlet.xml
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/hello03&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(){</span>
		<span class="k">return</span> <span class="s">&#34;error&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle01&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">hilo</span><span class="o">(){</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/hello02&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">hi</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;hi.....&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
<span class="o">===============================================================</span>
    
<span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * @RequestMapping 模糊匹配功能
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> * 
</span><span class="cm"> * URL地址可以写模糊的通配符：
</span><span class="cm"> * 	?：能替代任意一个字符
</span><span class="cm"> * 	*：能替代任意多个字符，和一层路径
</span><span class="cm"> * 	**：能替代多层路径
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestMappingTest</span> <span class="o">{</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/antTest01&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">antTest01</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;antTest01...&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * ?匹配一个字符（0个多个都不行）
</span><span class="cm">	 * 		模糊和精确多个匹配情况下，精确优先。
</span><span class="cm">	 */</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/antTest0?&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">antTest02</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;antTest02...&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * *匹配任意多个字符
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/antTest0*&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">antTest03</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;antTest03...&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;error&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="cm">/**
</span><span class="cm">	 * *：匹配一层路径
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/a/*/antTest01&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">antTest04</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;antTest04...&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;error&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="cm">/**
</span><span class="cm">	 * **：匹配多层路径
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/a/**/antTest01&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">antTest05</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;antTest05...&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;error&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="c1">//路径上可以有占位符，占位符语法就是可以任意路径的地方写一个{变量名}
</span><span class="c1"></span>	<span class="c1">//   /user/admin	/user/lql
</span><span class="c1"></span>	<span class="c1">//路径上的占位符只能占一层路径
</span><span class="c1"></span>	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/user/{id}&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">pathVariableTest</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">id</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;路径上的第一个占位符的值：&#34;</span><span class="o">+</span><span class="n">id</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span>
<span class="o">===============================================================</span>
    
<span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="cm">/**
</span><span class="cm"> * 为当前类所有的方法的请求地址指定一个基准路径
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/haha&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestMappingTestController</span> <span class="o">{</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle01&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle01</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;RequestMappingTestController....handle01&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="cm">/**
</span><span class="cm">	 * RequestMapping的其他属性
</span><span class="cm">	 * method：限定请求方式
</span><span class="cm">	 * 		HTTP协议中的所有请求方式：
</span><span class="cm">	 * 			【GET】, HEAD, 【POST】, PUT, PATCH, DELETE, OPTIONS, TRACE
</span><span class="cm">	 * 		GET、POST
</span><span class="cm">	 * 		method=RequestMethod.POST：只接收这种类型的请求，默认是什么都可以；
</span><span class="cm">	 * 			不是规定的方式报错：4xx：都是客户端错误
</span><span class="cm">	 * 				Request method &#39;GET&#39; not supported(a标签是GET请求)
</span><span class="cm">	 * 
</span><span class="cm">	 * params：规定请求参数
</span><span class="cm">	 * params 和 headers支持简单的表达式：
</span><span class="cm">			param1: 表示请求必须包含名为 param1 的请求参数
</span><span class="cm">				eg：params={&#34;username&#34;}:
</span><span class="cm">					发送请求的时候必须带上一个名为username的参数，没带404；
</span><span class="cm">					
</span><span class="cm">			!param1: 表示请求不能包含名为 param1 的请求参数
</span><span class="cm">				eg：params={&#34;!username&#34;}:
</span><span class="cm">					发送请求的时候必须不携带一个名为username的参数，带了404；
</span><span class="cm">					
</span><span class="cm">			param1 != value1: 表示请求包含名为 param1 的请求参数，但其值不能为 value1
</span><span class="cm">				eg：params={&#34;username!=123&#34;}:
</span><span class="cm">					发送请求的时候携带username的值必须不是123（不带username或者username不是123）
</span><span class="cm">					
</span><span class="cm">			{&#34;param1=value1&#34;, &#34;param2&#34;}: 请求必须包含名为 param1 和param2 的两个请求参数，且 param1 参数的值必须为 value1
</span><span class="cm">				eg:params={&#34;username!=123&#34;,&#34;pwd&#34;,&#34;!age&#34;}
</span><span class="cm">					请求参数必须满足以上规则：
</span><span class="cm">					请求的username不能是123，必须有pwd的值，不能有age
</span><span class="cm">	 * headers：规定请求头，也和params一样，能写简单的表达式
</span><span class="cm">	 * 
</span><span class="cm">	 * consume：只接受内容类型是哪种的请求，规定请求头中的Content-type
</span><span class="cm">	 * produces：告诉浏览器返回的内容类型是什么，给响应头加上Content-type/html;charset=utf-8
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/handle02&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle02</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;handle02....&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/handle03&#34;</span><span class="o">,</span><span class="n">params</span><span class="o">={</span><span class="s">&#34;username!=123&#34;</span><span class="o">,</span><span class="s">&#34;pwd&#34;</span><span class="o">,</span><span class="s">&#34;!age&#34;</span><span class="o">})</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle03</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;RequestMappingTestController....handle03&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * User-Agent:浏览器信息
</span><span class="cm">	 * 让火狐能访问，谷歌不能访问(自己查浏览器的User-Agent)
</span><span class="cm">	 * 
</span><span class="cm">	 * 谷歌：
</span><span class="cm">	 * User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36
</span><span class="cm">	 * 
</span><span class="cm">	 * 火狐：
</span><span class="cm">	 * 
</span><span class="cm">	 * User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/handle04&#34;</span><span class="o">,</span><span class="n">headers</span><span class="o">={</span><span class="s">&#34;User-Agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0&#34;</span><span class="o">})</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle04</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;handle04....&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div><hr>
<h3 id="7indexjsp">7.<strong>index.jsp:</strong></h3>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;!-- 以前一个servlet配置url-pattern(/hello) --&gt;
&lt;a href=&quot;handle01&quot;&gt;你好&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;hello02&quot;&gt;你好&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;hello03&quot;&gt;你好&lt;/a&gt;&lt;br&gt;
&lt;hr&gt;
&lt;h1&gt;RequestMapping测试&lt;/h1&gt;

&lt;a href=&quot;handle01&quot;&gt;test01-写在方法上的requestMapping&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;haha/handle01&quot;&gt;test01-写在类上的requestMapping&lt;/a&gt;&lt;br&gt;
&lt;h1&gt;测试RequestMapping的属性&lt;/h1&gt;
&lt;a href=&quot;haha/handle02&quot;&gt;handle02&lt;/a&gt;&lt;br&gt;&lt;br&gt;
&lt;form action=&quot;haha/handle02&quot; method=&quot;post&quot;&gt;
	&lt;input type=&quot;submit&quot;/&gt;
&lt;/form&gt;

&lt;a href=&quot;haha/handle03&quot;&gt;handle03--测试params属性&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;haha/handle04&quot;&gt;handle04--测试headers&lt;/a&gt;&lt;br&gt;
&lt;hr/&gt;
&lt;h1&gt;RequestMapping-Ant风格的URL&lt;/h1&gt;
&lt;a href=&quot;antTest01&quot;&gt;精确请求地址-antTest01&lt;/a&gt;
&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;a href=&quot;user/admin&quot;&gt;测试PathVariable&lt;/a&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h1 id="三hiddenhttpmethodfilter-rest">三、HiddenHttpMethodFilter (==REST==)</h1>
<p>REST即表述性状态传递（英文：Representational State Transfer，简称REST）是Roy Fielding博士在2000年他的博士论文中提出来的一种软件架构风格。</p>
<h2 id="1rest风格是什么">1、REST风格是什么？</h2>
<p>①   REST：即 Representational State Transfer。<strong>（资源）表现层状态转化。是目前最流行的一种互联网软件架构</strong>。它结构清晰、符合标准、易于理解、扩展方便，所以正得到越来越多网站的采用</p>
<ul>
<li>
<p><strong>资源（Resources）</strong>：网络上的一个实体，或者说是网络上的一个具体信息。</p>
<p>它可以是一段文本、一张图片、一首歌曲、一种服务，总之就是一个具体的存在。</p>
<p>可以用一个URI（统一资源定位符）指向它，每种资源对应一个特定的 URI 。</p>
<p>获取这个资源，访问它的URI就可以，因此 URI 即为每一个资源的独一无二的识别符。</p>
</li>
<li>
<p><strong>表现层（Representation）</strong>：把资源具体呈现出来的形式，叫做它的表现层（Representation）。比如，文本可以用 txt 格式表现，也可以用 HTML 格式、XML 格式、JSON 格式表现，甚至可以采用二进制格式。</p>
</li>
<li>
<p><strong>状态转化（State Transfer）</strong>：每发出一个请求，就代表了客户端和服务器的一次交互过程。HTTP协议，是一个无状态协议，即所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生“状态转化”（State Transfer）。</p>
<p>而这种转化是建立在表现层之上的，所以就是 “表现层状态转化”。</p>
</li>
<li>
<p><strong>具体说，就是 HTTP</strong>协议里面，四个表示操作方式的动词：<strong>GET、POST、PUT、DELETE。</strong></p>
</li>
</ul>
<p><strong>它们分别对应四种基本操作：GET</strong> <strong>用来获取资源，POST</strong> <strong>用来新建资源，PUT</strong> <strong>用来更新资源，DELETE</strong> <strong>用来删除资源。</strong></p>
<p>②   <strong>URL风格</strong></p>
<p>示例：</p>
<table>
<thead>
<tr>
<th>请求路径</th>
<th>请求方法</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-/user/1</td>
<td>HTTP GET</td>
<td>得到id为1的user</td>
</tr>
<tr>
<td>-/user/1</td>
<td>HTTP DELETE</td>
<td>删除id为1的user</td>
</tr>
<tr>
<td>-/user/1</td>
<td>HTTP PUT</td>
<td>更新id为1的user</td>
</tr>
<tr>
<td>-/user</td>
<td>HTTP POST</td>
<td>新增user</td>
</tr>
</tbody>
</table>
<p>③   <strong>HiddenHttpMethodFilter</strong></p>
<p>浏览器 form 表单只支持 GET 与 POST 请求，而DELETE、PUT 等 method 并不支持，</p>
<p>Spring3.0 添加了一个过滤器，可以将这些请求转换为标准的 http 方法，使得支持 GET、POST、PUT 与 DELETE 请求。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
		<span class="c1">//获取表单上_method的值
</span><span class="c1"></span>		<span class="n">HttpServletRequest</span> <span class="n">requestToUse</span> <span class="o">=</span> <span class="n">request</span><span class="o">;</span>
		
        <span class="c1">//判断如果表单是一个post而且_method有值
</span><span class="c1"></span>		<span class="k">if</span> <span class="o">(</span><span class="s">&#34;POST&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">WebUtils</span><span class="o">.</span><span class="na">ERROR_EXCEPTION_ATTRIBUTE</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">String</span> <span class="n">paramValue</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">methodParam</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">hasLength</span><span class="o">(</span><span class="n">paramValue</span><span class="o">))</span> <span class="o">{</span>
				<span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="n">paramValue</span><span class="o">.</span><span class="na">toUpperCase</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">ENGLISH</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">ALLOWED_METHODS</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">method</span><span class="o">))</span> <span class="o">{</span>
					<span class="n">requestToUse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpMethodRequestWrapper</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">method</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="c1">//直接放行
</span><span class="c1"></span>		<span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">requestToUse</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
	<span class="o">}</span>
</code></pre></div><hr>
<hr>
<hr>
<hr>
<h2 id="2总体架构image-20201127101303126httpsilolinet20201127lfszjad3tamsqrxpng">2、总体架构<img src="https://i.loli.net/2020/11/27/LFSZJaD3TAMsQRX.png" alt="image-20201127101303126"></h2>
<h2 id="3webxml">3、web.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span> <span class="na">id=</span><span class="s">&#34;WebApp_ID&#34;</span> <span class="na">version=</span><span class="s">&#34;3.1&#34;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;display-name&gt;</span>3.SpringMVC_rest<span class="nt">&lt;/display-name&gt;</span>
  <span class="nt">&lt;welcome-file-list&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.jsp<span class="nt">&lt;/welcome-file&gt;</span>
  <span class="nt">&lt;/welcome-file-list&gt;</span>
  
  <span class="c">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span>
	<span class="nt">&lt;servlet&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springMvc<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
		<span class="c">&lt;!-- &lt;init-param&gt;
</span><span class="c">			&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
</span><span class="c">			&lt;param-value&gt;location&lt;/param-value&gt;
</span><span class="c">		&lt;/init-param&gt; --&gt;</span>
		<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
	<span class="nt">&lt;/servlet&gt;</span>

	<span class="c">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span>
	<span class="nt">&lt;servlet-mapping&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springMvc<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/servlet-mapping&gt;</span>
	
	<span class="c">&lt;!-- 配置转化请求转化 --&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="nt">&lt;/filter-class&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>
	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
	
<span class="nt">&lt;/web-app&gt;</span>
</code></pre></div><hr>
<h2 id="4springmvc-servletxml">4、springMvc-servlet.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
	<span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
	<span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd&#34;</span><span class="nt">&gt;</span>

	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.lql&#34;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>

	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/pages/&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>

</code></pre></div><hr>
<h2 id="5controller类">5、Controller类</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringMvcTestRestController</span> <span class="o">{</span>
	
	<span class="c1">//添加图书
</span><span class="c1"></span>	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/book&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">addBook</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;成功添加图书&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="c1">//查询图书
</span><span class="c1"></span>	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/book/{bid}&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">selectBook</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;bid&#34;</span><span class="o">)</span><span class="n">Integer</span> <span class="n">bid</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;成功查询到&#34;</span><span class="o">+</span><span class="n">bid</span><span class="o">+</span><span class="s">&#34;号图书&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="c1">//修改图书
</span><span class="c1"></span>	<span class="c1">//@ResponseBody
</span><span class="c1"></span>	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/book/{bid}&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">PUT</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">updateBook</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;bid&#34;</span><span class="o">)</span><span class="n">Integer</span> <span class="n">bid</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;成功修改&#34;</span><span class="o">+</span><span class="n">bid</span><span class="o">+</span><span class="s">&#34;号图书&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
		<span class="c1">//return &#34;redirect:/success&#34;;//重定向到一个没有指定 method的 Handler方法
</span><span class="c1"></span>	<span class="o">}</span>
	
	<span class="cm">/*@RequestMapping(value=&#34;/success&#34;)
</span><span class="cm">	public String successGenecal(){
</span><span class="cm">		return &#34;success&#34;;//由该方法 转发到success.jsp页面
</span><span class="cm">	}*/</span>
	
	<span class="c1">//删除图书
</span><span class="c1"></span>	<span class="c1">//@ResponseBody
</span><span class="c1"></span>	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/book/{bid}&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteBook</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;bid&#34;</span><span class="o">)</span><span class="n">Integer</span> <span class="n">bid</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;成功删除&#34;</span><span class="o">+</span><span class="n">bid</span><span class="o">+</span><span class="s">&#34;号图书&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
		<span class="c1">//return &#34;redirect:/success&#34;;//重定向到一个没有指定 method的 Handler方法
</span><span class="c1"></span>	<span class="o">}</span>



<span class="o">}</span>

</code></pre></div><hr>
<h2 id="6indexjsp">6、index.jsp</h2>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;!-- 发起图书的增删改查请求：使用Rest风格的URL地址：
请求url	请求方式	表示含义
/book/1	GET		查询1号图书
/book/1	DELETE	删除1号图书
/book/1	PUT		更新1号图书
/book	POST	添加图书

从页面发起PUT、DELETE形式的请求？Spring提供了对Rest风格的支持：
1）、SpringMVC中有一个Filter，可以把普通的请求转化为规定形式的请求
配置这个filter:
&lt;filter&gt;
		&lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;
		&lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-class&gt;
	&lt;/filter&gt;
	&lt;filter-mapping&gt;
		&lt;filter-name&gt;HiddenHttpMethodFilter&lt;/filter-name&gt;
		&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
	&lt;/filter-mapping&gt;
	
2）、如何发起其他形式请求？
	按照以下要求：
		1、创建一个post类型的表单
		2、表单项中携带一个_method的参数
		3、这个_method的值就是DELETE、PUT
 --&gt;

&lt;form action=&quot;book&quot; method=&quot;post&quot;&gt;
	&lt;input type=&quot;submit&quot; value=&quot;添加图书&quot;/&gt;
&lt;/form&gt;&lt;br&gt;

&lt;form action=&quot;book/1&quot; method=&quot;get&quot;&gt;
	&lt;input type=&quot;submit&quot; value=&quot;查询图书&quot;/&gt;
&lt;/form&gt;&lt;br&gt;

&lt;form action=&quot;book/1&quot; method=&quot;post&quot;&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;delete&quot;/&gt;
	&lt;input type=&quot;submit&quot; value=&quot;删除图书&quot;/&gt;
&lt;/form&gt;&lt;br&gt;

&lt;form action=&quot;book/1&quot; method=&quot;post&quot;&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;put&quot;/&gt;
	&lt;input type=&quot;submit&quot; value=&quot;修改图书&quot;/&gt;
&lt;/form&gt;&lt;br&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><h2 id="7successjsp">7、success.jsp:</h2>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot; isErrorPage=&quot;true&quot; %&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;成功了，666！&lt;/h1&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<hr>
<h3 id="注意">==注意==：</h3>
<h4 id="高版本tomcatrest支持有问题">高版本Tomcat：Rest支持有问题：</h4>
<p><img src="https://i.loli.net/2020/11/26/uarAbFX7jf3R9xt.png" alt="image-20201126120329254"></p>
<p>解决方案（两种方式）：</p>
<p>1.重定向：见上图Controller类里配置。</p>
<p>2.修改jsp：<img src="https://i.loli.net/2020/11/26/OEuQzpk6CiloJfN.png" alt="image-20201126120539377"></p>
<hr>
<h1 id="四请求参数">四、请求参数</h1>
<h2 id="1总体架构image-20201127110153768httpsilolinet20201127tyl9jgsfmqoirmdpng">1、总体架构<img src="https://i.loli.net/2020/11/27/tYL9JgSFMqoiRmd.png" alt="image-20201127110153768"></h2>
<h2 id="2webxml">2、web.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span> <span class="na">id=</span><span class="s">&#34;WebApp_ID&#34;</span> <span class="na">version=</span><span class="s">&#34;3.1&#34;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;display-name&gt;</span>4.SpringMVC_helloWorld<span class="nt">&lt;/display-name&gt;</span>
  <span class="nt">&lt;welcome-file-list&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.jsp<span class="nt">&lt;/welcome-file&gt;</span>
  <span class="nt">&lt;/welcome-file-list&gt;</span>
  
  <span class="c">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span>
	<span class="nt">&lt;servlet&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springMvc<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
		<span class="c">&lt;!-- &lt;init-param&gt;
</span><span class="c">			&lt;param-name&gt;springMvc&lt;/param-name&gt;
</span><span class="c">			&lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;
</span><span class="c">		&lt;/init-param&gt; --&gt;</span>
		<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
	<span class="nt">&lt;/servlet&gt;</span>

	<span class="c">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span>
	<span class="nt">&lt;servlet-mapping&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springMvc<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/servlet-mapping&gt;</span>
	
	<span class="c">&lt;!-- 配置一个字符编码的Filter；一定注意filter一般都在其他Filter之前；--&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
		<span class="c">&lt;!-- encoding：指定解决POST请求乱码 --&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
		<span class="c">&lt;!-- forceResponseEncoding：顺手解决响应乱码；response.setCharacterEncoding(encoding); --&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>forceResponseEncoding<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>forceRequestEncoding<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>

	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
	
	<span class="c">&lt;!-- 支持Rest风格的Filter --&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="nt">&lt;/filter-class&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>
	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
	
	
	<span class="c">&lt;!-- 使用SpringMVC控制器，写完就直接写字符编码过滤器；
</span><span class="c">		Tomcat一装上，上手就是server.xml的8080处添加URIEncoding=&#34;UTF-8&#34; --&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</code></pre></div><hr>
<h2 id="3springmvc-servletxml">3、springMvc-servlet.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
	<span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
	<span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd&#34;</span><span class="nt">&gt;</span>

	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.lql&#34;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>

	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/pages/&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>

</code></pre></div><hr>
<h2 id="4pojo">4、Pojo</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.pojo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="n">String</span> <span class="n">province</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">city</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">street</span><span class="o">;</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getProvince</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">province</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProvince</span><span class="o">(</span><span class="n">String</span> <span class="n">province</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">province</span> <span class="o">=</span> <span class="n">province</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getCity</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">city</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCity</span><span class="o">(</span><span class="n">String</span> <span class="n">city</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">city</span> <span class="o">=</span> <span class="n">city</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getStreet</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">street</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStreet</span><span class="o">(</span><span class="n">String</span> <span class="n">street</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">street</span> <span class="o">=</span> <span class="n">street</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">&#34;Address [province=&#34;</span> <span class="o">+</span> <span class="n">province</span> <span class="o">+</span> <span class="s">&#34;, city=&#34;</span> <span class="o">+</span> <span class="n">city</span> <span class="o">+</span> <span class="s">&#34;, street=&#34;</span> <span class="o">+</span> <span class="n">street</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	

<span class="o">}</span>

<span class="o">===============================================================</span>
<span class="kn">package</span> <span class="nn">com.lql.pojo</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">bookName</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">author</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">Double</span> <span class="n">price</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">stock</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">salse</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>
	
	
	<span class="kd">public</span> <span class="n">Address</span> <span class="nf">getAddress</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">address</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAddress</span><span class="o">(</span><span class="n">Address</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">address</span> <span class="o">=</span> <span class="n">address</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getBookName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">bookName</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBookName</span><span class="o">(</span><span class="n">String</span> <span class="n">bookName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">bookName</span> <span class="o">=</span> <span class="n">bookName</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getAuthor</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">author</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAuthor</span><span class="o">(</span><span class="n">String</span> <span class="n">author</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Double</span> <span class="nf">getPrice</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">price</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrice</span><span class="o">(</span><span class="n">Double</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getStock</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">stock</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStock</span><span class="o">(</span><span class="n">Integer</span> <span class="n">stock</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">stock</span> <span class="o">=</span> <span class="n">stock</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getSalse</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">salse</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSalse</span><span class="o">(</span><span class="n">Integer</span> <span class="n">salse</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">salse</span> <span class="o">=</span> <span class="n">salse</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">&#34;Book [bookName=&#34;</span> <span class="o">+</span> <span class="n">bookName</span> <span class="o">+</span> <span class="s">&#34;, author=&#34;</span> <span class="o">+</span> <span class="n">author</span> <span class="o">+</span> <span class="s">&#34;, price=&#34;</span> <span class="o">+</span> <span class="n">price</span> <span class="o">+</span> <span class="s">&#34;, stock=&#34;</span> <span class="o">+</span> <span class="n">stock</span>
				<span class="o">+</span> <span class="s">&#34;, salse=&#34;</span> <span class="o">+</span> <span class="n">salse</span> <span class="o">+</span> <span class="s">&#34;, address=&#34;</span> <span class="o">+</span> <span class="n">address</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
	<span class="o">}</span>	
<span class="o">}</span>

</code></pre></div><hr>
<h2 id="5controller类-1">5、Controller类</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.PrintWriter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.CookieValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestHeader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.lql.pojo.Book</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>

	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle01</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;handle01....&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * SpringMVC如何获取请求带来的各种信息
</span><span class="cm">	 * 默认方式获取请求参数：
</span><span class="cm">	 * 		直接给方法入参写一个和请求参数名相同的变量，这个变量就来接收请求参数的值
</span><span class="cm">	 * 		带：有值； 没带：null；
</span><span class="cm">	 * 
</span><span class="cm">	 * @RequestParam：获取请求参数(参数默认是必须带的)
</span><span class="cm">	 * 		@RequestParam(&#34;user&#34;)String username
</span><span class="cm">	 * 		解释username = request.getParameter(&#34;user&#34;)
</span><span class="cm">	 * 
</span><span class="cm">	 * @RequestParam(&#34;user&#34;)
</span><span class="cm">	 * @PathVariable(&#34;user&#34;)  /book/【{user}pathvariabale】?【use=admin（ReqeestParam）】
</span><span class="cm">	 * 
</span><span class="cm">	 * 属性：
</span><span class="cm">	 * 		value：指定要获取的参数key
</span><span class="cm">	 * 		required：这个参数是否必须的
</span><span class="cm">	 * 		defaultValue：默认值，没带默认是null
</span><span class="cm">	 * 
</span><span class="cm">	 * 
</span><span class="cm">	 * @RequestHeader：获取请求头中某个key的值
</span><span class="cm">	 * 		request.getHeader(&#34;User-Agent&#34;)；
</span><span class="cm">	 * 		@RequestHeader(&#34;User-Agent&#34;)String userAgent：
</span><span class="cm">	 * 		userAgent = request.getHeader(&#34;User-Agent&#34;)
</span><span class="cm">	 * 如果请求头中没有这个值，就会报错
</span><span class="cm">	 * value()
</span><span class="cm">	 * required()
</span><span class="cm">	 * defaultValue()
</span><span class="cm">	 * 
</span><span class="cm">	 * @CookieValue：获取某个cookie的值；
</span><span class="cm">	 * 以前的操作获取某个cookie：
</span><span class="cm">	 * cookie[] cookies = request.getCookies();
</span><span class="cm">	 * for(cookie c:cookies){
</span><span class="cm">	 * 		if(c.getName().eqals(&#34;JSESSIONID&#34;)){
</span><span class="cm">	 * 			String cv = c.getValue();
</span><span class="cm">	 * }}
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle01&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle02</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;user33&#34;</span><span class="o">,</span><span class="n">required</span><span class="o">=</span><span class="kc">false</span><span class="o">,</span><span class="n">defaultValue</span><span class="o">=</span><span class="s">&#34;你没带&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span>
						   <span class="nd">@RequestHeader</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;Agent&#34;</span><span class="o">,</span><span class="n">required</span><span class="o">=</span><span class="kc">false</span><span class="o">,</span><span class="n">defaultValue</span><span class="o">=</span><span class="s">&#34;她也没带&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">userAgent</span><span class="o">,</span>
						   <span class="nd">@CookieValue</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;JSESSIONIDhaha&#34;</span><span class="o">,</span><span class="n">required</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span><span class="n">String</span> <span class="n">jid</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;这个变量的值：&#34;</span><span class="o">+</span><span class="n">username</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;请求头中浏览器的信息：&#34;</span><span class="o">+</span><span class="n">userAgent</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;cookie中的jid的值：&#34;</span><span class="o">+</span><span class="n">jid</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 如果我们的请求参数是一个POJO，
</span><span class="cm">	 * SpringMVC会自动的为这个POJO进行赋值：
</span><span class="cm">	 * 1）、将POJO中的每一个属性，从request参数中尝试获取出来，并封装即可；
</span><span class="cm">	 * 2）、还可以级联封装：属性的属性
</span><span class="cm">	 * 3）、请求参数的参数名和对象中的属性名一一对应就行
</span><span class="cm">	 * 
</span><span class="cm">	 * 
</span><span class="cm">	 * 提交的数据可能有乱码：
</span><span class="cm">	 * 请求乱码：
</span><span class="cm">	 * 	GET请求：改server.xml：在8080端口处URIEncoding=&#34;UTF-8&#34;(我的里面没有)
</span><span class="cm">	 * 	POST请求：
</span><span class="cm">	 * 		在第一次获取请求参数之前设置
</span><span class="cm">	 * 		request.setCharacterEncoding(&#34;UTF-8&#34;);
</span><span class="cm">	 * 		自己写一个filter；SpringMVC有这个filter
</span><span class="cm">	 * 响应乱码：
</span><span class="cm">	 * 		response.setContentType(&#34;text/html;charset=utf-8&#34;)
</span><span class="cm">	 * @param book
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/book&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">addbook</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;我要保存的图书&#34;</span><span class="o">+</span><span class="n">book</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * SpringMVC可以直接在参数写原生API:
</span><span class="cm">	 * HttpServletRequest
</span><span class="cm">	 * HttpServletResponse
</span><span class="cm">	 * HttpSession
</span><span class="cm">	 * 
</span><span class="cm">	 * java.security.Principal
</span><span class="cm">	 * Locale：国际化有关的区域信息对象
</span><span class="cm">	 * InputStream：
</span><span class="cm">	 * 		ServletInputStream inputStream = request.getInputStream();
</span><span class="cm">	 * Outputstream：
</span><span class="cm">	 * 		ServletOutputStream outputStream = response.getOutputStream();
</span><span class="cm">	 * Reader：
</span><span class="cm">	 * 		BufferedReader reader = request.getReader();
</span><span class="cm">	 * Writer：
</span><span class="cm">	 * 		PrintWriter writer = response.getWriter();
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle03&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle03</span><span class="o">(</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">,</span>
			<span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">){</span>
		<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;reqParam&#34;</span><span class="o">,</span> <span class="s">&#34;我是请求域中的&#34;</span><span class="o">);</span>
		<span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;sessionParam&#34;</span><span class="o">,</span> <span class="s">&#34;我是Session域中的&#34;</span><span class="o">);</span>
		
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
		
	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div><hr>
<h2 id="6indexjsp-1">6、index.jsp</h2>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;a href=&quot;hello&quot;&gt;hello&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;handle01?user=tomcat&quot;&gt;handle01&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;handle03&quot;&gt;handle03&lt;/a&gt;&lt;br&gt;
    
&lt;form action=&quot;book&quot; method=&quot;post&quot;&gt;
	书名:&lt;input type=&quot;text&quot; name=&quot;bookName&quot;/&gt;&lt;br&gt;
	作者:&lt;input type=&quot;text&quot; name=&quot;author&quot;/&gt;&lt;br&gt;
	价格:&lt;input type=&quot;text&quot; name=&quot;price&quot;/&gt;&lt;br&gt;
	库存:&lt;input type=&quot;text&quot; name=&quot;stock&quot;/&gt;&lt;br&gt;
	销量:&lt;input type=&quot;text&quot; name=&quot;salse&quot;/&gt;&lt;br&gt;
	&lt;hr&gt;
	省：&lt;input type=&quot;text&quot; name=&quot;address.province&quot;/&gt;
	市：&lt;input type=&quot;text&quot; name=&quot;address.city&quot;/&gt;
	街道:&lt;input type=&quot;text&quot; name=&quot;address.street&quot;/&gt;&lt;br&gt;
	&lt;input type=&quot;submit&quot;/&gt;
&lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
***************************************************************
===============================================================
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;成功了，66666666666666&lt;/h1&gt;
请求：${reqParam }&lt;br&gt;
session:${sessionScope.sessionParam}
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<hr>
<h1 id="五数据输出">五、数据输出</h1>
<h2 id="1总体架构image-20201203084619687httpsilolinet202012033lkca2mucdlywevpng">1、总体架构<img src="https://i.loli.net/2020/12/03/3LkcA2MuCDlYwEV.png" alt="image-20201203084619687"></h2>
<h2 id="2webxml-1">2、web.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span> <span class="na">id=</span><span class="s">&#34;WebApp_ID&#34;</span> <span class="na">version=</span><span class="s">&#34;3.1&#34;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;display-name&gt;</span>5.SpringMVC_output<span class="nt">&lt;/display-name&gt;</span>
  <span class="nt">&lt;welcome-file-list&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.html<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.htm<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.jsp<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>default.html<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>default.htm<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>default.jsp<span class="nt">&lt;/welcome-file&gt;</span>
  <span class="nt">&lt;/welcome-file-list&gt;</span>
  
  <span class="c">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span>
	<span class="nt">&lt;servlet&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springDispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
		
		<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
	<span class="nt">&lt;/servlet&gt;</span>

	<span class="c">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span>
	<span class="nt">&lt;servlet-mapping&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springDispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/servlet-mapping&gt;</span>
	
	<span class="c">&lt;!-- 字符编码过滤器 --&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
			<span class="nt">&lt;init-param&gt;</span>
				<span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
				<span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
			<span class="nt">&lt;/init-param&gt;</span>
			<span class="nt">&lt;init-param&gt;</span>
				<span class="nt">&lt;param-name&gt;</span>forceRequestEncoding<span class="nt">&lt;/param-name&gt;</span>
				<span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
			<span class="nt">&lt;/init-param&gt;</span>
			<span class="nt">&lt;init-param&gt;</span>
				<span class="nt">&lt;param-name&gt;</span>forceResponseEncoding<span class="nt">&lt;/param-name&gt;</span>
				<span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
			<span class="nt">&lt;/init-param&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>
	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</code></pre></div><hr>
<h2 id="3springdispatcherservlet-servletxml">3、springDispatcherServlet-servlet.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
	<span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
	<span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd&#34;</span><span class="nt">&gt;</span>

	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.lql&#34;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/pages/&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>

</code></pre></div><hr>
<h2 id="4controller类">4、Controller类</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.ModelMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.SessionAttributes</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * SpringMVC除过在方法上传入原生request和session外还能怎么样把数据带给页面:
</span><span class="cm"> * 
</span><span class="cm"> * 1）、可以在方法处传入Map或者Model或者ModelMap；
</span><span class="cm"> * 		给这些参数里面保存的所有数据都会放在请求域中，可以在页面获取
</span><span class="cm"> * 	关系：
</span><span class="cm"> * 		Map、Model、ModelMap：最终都是BindingAwareModelMap在工作；
</span><span class="cm"> * 		相当于给BindingAwareModelMap中保存的东西都会放在请求域中；
</span><span class="cm"> * 
</span><span class="cm"> * 		Map(interface(jdk))		Model(interface(spring))
</span><span class="cm"> * 			||						 //
</span><span class="cm"> * 			||						//	
</span><span class="cm"> * 			\/					   //
</span><span class="cm"> * 		ModelMap(class)			  //
</span><span class="cm"> * 					\\			 //
</span><span class="cm"> * 					 \\			//
</span><span class="cm"> * 					ExtendedModelMap
</span><span class="cm"> * 					   ||
</span><span class="cm"> * 					   \/	
</span><span class="cm"> * 					BindingAwareModelMap
</span><span class="cm"> * 
</span><span class="cm"> * 2）、方法的返回值可以变为ModelAndView类型：
</span><span class="cm"> * 		既包含视图信息（页面地址）也包含模型数据（给页面带的数据）；
</span><span class="cm"> * 		而且数据是放在请求域中；
</span><span class="cm"> * 		request  session  application			
</span><span class="cm"> *
</span><span class="cm"> * 3）、SpringMVC提供了一种可以临时给Session域中保存数据的方式：
</span><span class="cm"> * 	使用一个注解	@SessionAttributes(只能标在类上)
</span><span class="cm"> * 	@SessionAttributes(value=&#34;msg&#34;):
</span><span class="cm"> * 给BindingAwareModelMap中保存的数据，或者ModelAndView中的数据，
</span><span class="cm"> * 同时给session放一份；
</span><span class="cm"> * value指定保存数据时要给session中放的数据的key；
</span><span class="cm"> * 
</span><span class="cm"> * value={&#34;haha&#34;,&#34;msg&#34;}：只要保存的是这种key的数据，给Session中放一份
</span><span class="cm"> * types={String.class}：只要保存的是这种类型的数据，给Session中也放一份
</span><span class="cm"> * 
</span><span class="cm"> * 后来推荐@SessionAttributes就别用了，可能会引发异常；
</span><span class="cm"> * 		给session中放数据请使用原生API;
</span><span class="cm"> * 
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="nd">@SessionAttributes</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="s">&#34;haha&#34;</span><span class="o">,</span><span class="s">&#34;msg&#34;</span><span class="o">},</span><span class="n">types</span><span class="o">={</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OutputController</span> <span class="o">{</span>
	<span class="c1">// args:如何确定目标方法每一个参数的值，最难？
</span><span class="c1"></span>	<span class="c1">// method.invoke(this,)
</span><span class="c1"></span>	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle01&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle01</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span><span class="s">&#34;你好&#34;</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;hahaha&#34;</span><span class="o">,</span> <span class="s">&#34;哈哈哈&#34;</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;map的类型：&#34;</span><span class="o">+</span><span class="n">map</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * Model：一个接口
</span><span class="cm">	 * @param model
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle02&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle03</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;你好坏！&#34;</span><span class="o">);</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;haha&#34;</span><span class="o">,</span><span class="n">18</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;model的类型：&#34;</span><span class="o">+</span><span class="n">model</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle03&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle03</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">modelMap</span><span class="o">){</span>
		<span class="n">modelMap</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;你好棒！&#34;</span><span class="o">);</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;modelMap的类型：&#34;</span><span class="o">+</span><span class="n">modelMap</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 返回值是ModelAndView；可以为页面携带数据
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle04&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">ModelAndView</span> <span class="nf">handle04</span><span class="o">(){</span>
		<span class="c1">//之前的返回值我们就叫视图名；视图名视图解析器是会帮我们最终拼串得到页面的真实地址；
</span><span class="c1"></span>		<span class="c1">//ModelAndView modelAndView = new ModelAndView(&#34;success&#34;);
</span><span class="c1"></span>		<span class="n">ModelAndView</span> <span class="n">modelAndView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ModelAndView</span><span class="o">();</span>
		<span class="n">modelAndView</span><span class="o">.</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&#34;success&#34;</span><span class="o">);</span>
		<span class="n">modelAndView</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span> <span class="s">&#34;你好哦！&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">modelAndView</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div><hr>
<h2 id="5indexjsp">5、index.jsp</h2>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;a href=&quot;hello&quot;&gt;hello&lt;/a&gt;&lt;br&gt;
&lt;!-- SpringMVC如何给页面携带数据过来 --&gt;
&lt;a href=&quot;handle01&quot;&gt;handle01&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;handle02&quot;&gt;handle02&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;handle03&quot;&gt;handle03&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;handle04&quot;&gt;handle04&lt;/a&gt;&lt;br&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h2 id="6successjsp">6、success.jsp</h2>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;hello&lt;/h1&gt;
pageContext：${pageScope.msg }&lt;br&gt;
request：${requestScope.msg }&lt;br&gt;
session：${sessionScope.msg }--${sessionScope.haha }--${sessionScope.hahaha }&lt;br&gt;
application：${applicationScope.msg }&lt;br&gt;
&lt;%System.out.println(&quot;来到页面了....&quot;); %&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><h2 id="7modelattribute原理">7、ModelAttribute原理：</h2>
<hr>
<p><img src="https://i.loli.net/2020/11/27/pmuhKICe2ETQxFY.png" alt="image-20201127150034858"></p>
<hr>
<h1 id="六springmvc源码">六、SpringMVC源码</h1>
<h2 id="1前端控制器">1、前端控制器</h2>
<hr>
<p><img src="https://i.loli.net/2020/11/27/ZqcsXQfrv5RKbmM.png" alt="image-20201127154346326"></p>
<hr>
<h2 id="2dodispatch详细细节">2、doDispatch()详细细节：</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doDispatch</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="n">HttpServletRequest</span> <span class="n">processedRequest</span> <span class="o">=</span> <span class="n">request</span><span class="o">;</span>
		<span class="n">HandlerExecutionChain</span> <span class="n">mappedHandler</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
		<span class="kt">boolean</span> <span class="n">multipartRequestParsed</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

		<span class="n">WebAsyncManager</span> <span class="n">asyncManager</span> <span class="o">=</span> <span class="n">WebAsyncUtils</span><span class="o">.</span><span class="na">getAsyncManager</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>

		<span class="k">try</span> <span class="o">{</span>
			<span class="n">ModelAndView</span> <span class="n">mv</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
			<span class="n">Exception</span> <span class="n">dispatchException</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

			<span class="k">try</span> <span class="o">{</span>
                <span class="c1">//1、检查是否文件上传请求
</span><span class="c1"></span>				<span class="n">processedRequest</span> <span class="o">=</span> <span class="n">checkMultipart</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
				<span class="n">multipartRequestParsed</span> <span class="o">=</span> <span class="o">(</span><span class="n">processedRequest</span> <span class="o">!=</span> <span class="n">request</span><span class="o">);</span>

				<span class="c1">// Determine handler for the current request.
</span><span class="c1"></span>                <span class="c1">//2、根据当前的请求地址找到哪个类能来处理；
</span><span class="c1"></span>				<span class="n">mappedHandler</span> <span class="o">=</span> <span class="n">getHandler</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">);</span>
                
                <span class="c1">//3、如果没有找到哪个处理器（控制器）能处理这个请求就404，或者抛异常
</span><span class="c1"></span>				<span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">noHandlerFound</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
					<span class="k">return</span><span class="o">;</span>
				<span class="o">}</span>

				<span class="c1">// Determine handler adapter for the current request.
</span><span class="c1"></span>                <span class="c1">//4、拿到能执行这个类的所有方法的适配器（反射工具RequestMappingHandlerAdapter）；
</span><span class="c1"></span>				<span class="n">HandlerAdapter</span> <span class="n">ha</span> <span class="o">=</span> <span class="n">getHandlerAdapter</span><span class="o">(</span><span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>

				<span class="c1">// Process last-modified header, if supported by the handler.
</span><span class="c1"></span>				<span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">();</span>
				<span class="kt">boolean</span> <span class="n">isGet</span> <span class="o">=</span> <span class="s">&#34;GET&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">isGet</span> <span class="o">||</span> <span class="s">&#34;HEAD&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">))</span> <span class="o">{</span>
					<span class="kt">long</span> <span class="n">lastModified</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="na">getLastModified</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>
					<span class="k">if</span> <span class="o">(</span><span class="k">new</span> <span class="n">ServletWebRequest</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">).</span><span class="na">checkNotModified</span><span class="o">(</span><span class="n">lastModified</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">isGet</span><span class="o">)</span> <span class="o">{</span>
						<span class="k">return</span><span class="o">;</span>
					<span class="o">}</span>
				<span class="o">}</span>

				<span class="k">if</span> <span class="o">(!</span><span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyPreHandle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">))</span> <span class="o">{</span>
					<span class="k">return</span><span class="o">;</span>
				<span class="o">}</span>

				<span class="c1">// Actually invoke the handler.处理（控制）器的方法被调用
</span><span class="c1"></span>                <span class="c1">//控制器（Controller），处理器（Handler）
</span><span class="c1"></span>                <span class="c1">//5、适配器来执行目标方法；将目标方法执行完成后的返回值作为视图名，设置保存到ModelAndView中
</span><span class="c1"></span>                <span class="c1">//目标方法无论怎么写，最终适配器执行完成以后都会将执行后的信息封装成ModelAndView
</span><span class="c1"></span>				<span class="n">mv</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>

				<span class="k">if</span> <span class="o">(</span><span class="n">asyncManager</span><span class="o">.</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
					<span class="k">return</span><span class="o">;</span>
				<span class="o">}</span>

				<span class="n">applyDefaultViewName</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span> <span class="c1">//如果没有视图名设置一个默认的视图名
</span><span class="c1"></span>				<span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyPostHandle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">dispatchException</span> <span class="o">=</span> <span class="n">ex</span><span class="o">;</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">err</span><span class="o">)</span> <span class="o">{</span>
				<span class="c1">// As of 4.3, we&#39;re processing Errors thrown from handler methods as well,
</span><span class="c1"></span>				<span class="c1">// making them available for @ExceptionHandler methods and other scenarios.
</span><span class="c1"></span>				<span class="n">dispatchException</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NestedServletException</span><span class="o">(</span><span class="s">&#34;Handler dispatch failed&#34;</span><span class="o">,</span> <span class="n">err</span><span class="o">);</span>
			<span class="o">}</span>
            <span class="c1">//转发到目标页面
</span><span class="c1"></span>            <span class="c1">//6、根据方法最终执行完成后封装的ModelAndView；转发到对应页面，而且ModelAndView中的数据可以从请求域中获取
</span><span class="c1"></span>			<span class="n">processDispatchResult</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="n">mv</span><span class="o">,</span> <span class="n">dispatchException</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">triggerAfterCompletion</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">err</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">triggerAfterCompletion</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span>
					<span class="k">new</span> <span class="n">NestedServletException</span><span class="o">(</span><span class="s">&#34;Handler processing failed&#34;</span><span class="o">,</span> <span class="n">err</span><span class="o">));</span>
		<span class="o">}</span>
		<span class="k">finally</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">asyncManager</span><span class="o">.</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
				<span class="c1">// Instead of postHandle and afterCompletion
</span><span class="c1"></span>				<span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyAfterConcurrentHandlingStarted</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="c1">// Clean up any resources used by a multipart request.
</span><span class="c1"></span>				<span class="k">if</span> <span class="o">(</span><span class="n">multipartRequestParsed</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">cleanupMultipart</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>

</code></pre></div><blockquote>
<hr>
<ol>
<li>
<p>所有请求过来<strong>DispatcherServlet</strong>收到请求</p>
</li>
<li>
<p>调用**doDispatch()**方法进行处理</p>
<ol>
<li><strong>getHandler()</strong>：根据当前请求地址找到能处理这个请求的目标处理器类（处理器）
<ul>
<li>根据当前请求在<strong>HandlerMapping</strong>中找到这个请求的映射信息，获取到目标处理器类</li>
</ul>
</li>
<li>==<strong>getHandlerAdapter()</strong>：根据当前处理器类获取到能执行这个处理器方法的适配器==
<ul>
<li>根据当前处理器类找到当前类的<strong>HanderAdapter</strong>（适配器）</li>
</ul>
</li>
<li>==使用刚才获取到的适配器（<strong>RequestMappingHandlerAdapter</strong>）执行目标方法==</li>
<li>==目标方法执行后会返回一个<strong>ModelAndView</strong>对象==</li>
<li>==根据<strong>ModelAndView</strong>的信息转发到具体的页面，并可以在请求域中取出<strong>ModelAndView</strong>中的模型数据==</li>
</ol>
<hr>
</li>
</ol>
</blockquote>
<h2 id="3gethandler细节">3、getHandler()细节：</h2>
<h3 id="1怎么根据当前请求就能找到哪个类能来处理">1.怎么根据当前请求就能找到哪个类能来处理</h3>
<ul>
<li>**getHandler()**会返回目标处理器类的执行链</li>
</ul>
<p><img src="https://i.loli.net/2020/12/01/3GTpkmazXEBHLQn.png" alt="image-20201201093226318"></p>
<ul>
<li><strong>handerMap</strong>：<strong>ioc</strong>容器创建<strong>Controller</strong>对象时扫描每个处理器都能处理什么请求。</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="n">HandlerExecutionChain</span> <span class="nf">getHandler</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">handlerMappings</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">for</span> <span class="o">(</span><span class="n">HandlerMapping</span> <span class="n">mapping</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">handlerMappings</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">HandlerExecutionChain</span> <span class="n">handler</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="na">getHandler</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">handler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
					<span class="k">return</span> <span class="n">handler</span><span class="o">;</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
	<span class="o">}</span>
</code></pre></div><hr>
<h3 id="2如何找到目标处理器类的适配器">2.如何找到目标处理器类的适配器？</h3>
<ul>
<li>要拿适配器才去执行目标方法。</li>
</ul>
<p><img src="https://i.loli.net/2020/12/01/tCx4sWpr2HDQFbq.png" alt="image-20201201131225895"></p>
<ul>
<li>RequestMappingHandlerAdapter：是HandlerAdapter的一个具体实现，主要用于将某个请求适配给<code>@RequestMapping</code>类型的Handler处理。</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="n">HandlerAdapter</span> <span class="nf">getHandlerAdapter</span><span class="o">(</span><span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">handlerAdapters</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">for</span> <span class="o">(</span><span class="n">HandlerAdapter</span> <span class="n">adapter</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">handlerAdapters</span><span class="o">)</span> <span class="o">{</span>
				<span class="k">if</span> <span class="o">(</span><span class="n">adapter</span><span class="o">.</span><span class="na">supports</span><span class="o">(</span><span class="n">handler</span><span class="o">))</span> <span class="o">{</span>
					<span class="k">return</span> <span class="n">adapter</span><span class="o">;</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">throw</span> <span class="k">new</span> <span class="n">ServletException</span><span class="o">(</span><span class="s">&#34;No adapter for handler [&#34;</span> <span class="o">+</span> <span class="n">handler</span> <span class="o">+</span>
				<span class="s">&#34;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&#34;</span><span class="o">);</span>
	<span class="o">}</span>
</code></pre></div><hr>
<hr>
<p><strong>DispatcherServlet中有几种引用类型的属性：</strong></p>
<h2 id="4springmvc九大组件">4、SpringMVC九大组件：</h2>
<p>SpringMVC在工作的时候，关键位置都是由这些组件完成的：</p>
<p><strong>公共点</strong>：九大组件全部都是接口：<strong>接口</strong>就是<strong>规范</strong></p>
<h3 id="1springmvc的九大组件工作原理">1.SpringMVC的九大组件工作原理：</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/** 文件上传解析器 */</span>
<span class="nd">@Nullable</span>
<span class="kd">private</span> <span class="n">MultipartResolver</span> <span class="n">multipartResolver</span><span class="o">;</span>

<span class="cm">/** 区域信息解析器，和国际化有关 */</span>
<span class="nd">@Nullable</span>
<span class="kd">private</span> <span class="n">LocaleResolver</span> <span class="n">localeResolver</span><span class="o">;</span>

<span class="cm">/** 主题解析器：强大的主题效果解析器 */</span>
<span class="nd">@Nullable</span>
<span class="kd">private</span> <span class="n">ThemeResolver</span> <span class="n">themeResolver</span><span class="o">;</span>

<span class="cm">/** Handler映射信息：HandlerMapping */</span>
<span class="nd">@Nullable</span>
<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerMapping</span><span class="o">&gt;</span> <span class="n">handlerMappings</span><span class="o">;</span>

<span class="cm">/** Handler的适配器 */</span>
<span class="nd">@Nullable</span>
<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerAdapter</span><span class="o">&gt;</span> <span class="n">handlerAdapters</span><span class="o">;</span>

<span class="cm">/** SpringMVC强大的异常解析功能：异常解析器 */</span>
<span class="nd">@Nullable</span>
<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">HandlerExceptionResolver</span><span class="o">&gt;</span> <span class="n">handlerExceptionResolvers</span><span class="o">;</span>

<span class="cm">/** RequestToViewNameTranslator used by this servlet. */</span>
<span class="nd">@Nullable</span>
<span class="kd">private</span> <span class="n">RequestToViewNameTranslator</span> <span class="n">viewNameTranslator</span><span class="o">;</span>

<span class="cm">/** FlashMap+Manager：SpringMVC中允许重定向携带数据的功能 */</span>
<span class="nd">@Nullable</span>
<span class="kd">private</span> <span class="n">FlashMapManager</span> <span class="n">flashMapManager</span><span class="o">;</span>

<span class="cm">/** 视图解析器 */</span>
<span class="nd">@Nullable</span>
<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ViewResolver</span><span class="o">&gt;</span> <span class="n">viewResolvers</span><span class="o">;</span>

</code></pre></div><hr>
<h3 id="2dispatcherservlet中九大组件初始化的地方">2.DispatcherServlet中九大组件初始化的地方：</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initStrategies</span><span class="o">(</span><span class="n">ApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">initMultipartResolver</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="n">initLocaleResolver</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="n">initThemeResolver</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="n">initHandlerMappings</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="n">initHandlerAdapters</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="n">initHandlerExceptionResolvers</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="n">initRequestToViewNameTranslator</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="n">initViewResolvers</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="n">initFlashMapManager</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
	<span class="o">}</span>
</code></pre></div><hr>
<p><del>可以在web.xml中修改DispatcherServlet某些属性的默认配置</del>(不需要改)：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;init-param&gt;</span>
    <span class="nt">&lt;param-name&gt;</span>detectAllHandlerMappings<span class="nt">&lt;/param-name&gt;</span>
    <span class="nt">&lt;param-value&gt;</span>false<span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/init-param&gt;</span>
</code></pre></div><h3 id="3初始化handlermapping">3.初始化HandlerMapping：</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">initHandlerMappings</span><span class="o">(</span><span class="n">ApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">handlerMappings</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">detectAllHandlerMappings</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// Find all HandlerMappings in the ApplicationContext, including ancestor contexts.
</span><span class="c1"></span>			<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">HandlerMapping</span><span class="o">&gt;</span> <span class="n">matchingBeans</span> <span class="o">=</span>
					<span class="n">BeanFactoryUtils</span><span class="o">.</span><span class="na">beansOfTypeIncludingAncestors</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">HandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(!</span><span class="n">matchingBeans</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
				<span class="k">this</span><span class="o">.</span><span class="na">handlerMappings</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">matchingBeans</span><span class="o">.</span><span class="na">values</span><span class="o">());</span>
				<span class="c1">// We keep HandlerMappings in sorted order.
</span><span class="c1"></span>				<span class="n">AnnotationAwareOrderComparator</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">handlerMappings</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="o">{</span>
			<span class="k">try</span> <span class="o">{</span>
				<span class="n">HandlerMapping</span> <span class="n">hm</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">HANDLER_MAPPING_BEAN_NAME</span><span class="o">,</span> <span class="n">HandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
				<span class="k">this</span><span class="o">.</span><span class="na">handlerMappings</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="n">hm</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchBeanDefinitionException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
				<span class="c1">// Ignore, we&#39;ll add a default HandlerMapping later.
</span><span class="c1"></span>			<span class="o">}</span>
		<span class="o">}</span>

		<span class="c1">// Ensure we have at least one HandlerMapping, by registering
</span><span class="c1"></span>		<span class="c1">// a default HandlerMapping if no other mappings are found.
</span><span class="c1"></span>		<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">handlerMappings</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">this</span><span class="o">.</span><span class="na">handlerMappings</span> <span class="o">=</span> <span class="n">getDefaultStrategies</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">HandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;No HandlerMappings declared for servlet &#39;&#34;</span> <span class="o">+</span> <span class="n">getServletName</span><span class="o">()</span> <span class="o">+</span>
						<span class="s">&#34;&#39;: using default strategies from DispatcherServlet.properties&#34;</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>

</code></pre></div><h3 id="4组件的初始化">4.组件的初始化：</h3>
<p>​	有些组件在容器中是使用类型找的，有些组件是使用id找的；</p>
<p>​	去容器中找这个组件，如果没有找到就用默认的配置；</p>
<h3 id="5未完待续版本不一致">5.未完待续(版本不一致)</h3>
<p><code>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</code>	执行目标方法的细节；</p>
<p>​			||</p>
<p>​		 	/</p>
<p><code>mav = invokeHandlerMethod(request, response, handlerMethod);</code></p>
<p>​			||</p>
<p>​		 	/</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Nullable</span>
<span class="kd">protected</span> <span class="n">ModelAndView</span> <span class="nf">invokeHandlerMethod</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                                           <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">HandlerMethod</span> <span class="n">handlerMethod</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="n">ServletWebRequest</span> <span class="n">webRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServletWebRequest</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">WebDataBinderFactory</span> <span class="n">binderFactory</span> <span class="o">=</span> <span class="n">getDataBinderFactory</span><span class="o">(</span><span class="n">handlerMethod</span><span class="o">);</span>
        <span class="n">ModelFactory</span> <span class="n">modelFactory</span> <span class="o">=</span> <span class="n">getModelFactory</span><span class="o">(</span><span class="n">handlerMethod</span><span class="o">,</span> <span class="n">binderFactory</span><span class="o">);</span>

        <span class="n">ServletInvocableHandlerMethod</span> <span class="n">invocableMethod</span> <span class="o">=</span> <span class="n">createInvocableHandlerMethod</span><span class="o">(</span><span class="n">handlerMethod</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">argumentResolvers</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">invocableMethod</span><span class="o">.</span><span class="na">setHandlerMethodArgumentResolvers</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">argumentResolvers</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">returnValueHandlers</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">invocableMethod</span><span class="o">.</span><span class="na">setHandlerMethodReturnValueHandlers</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">returnValueHandlers</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">invocableMethod</span><span class="o">.</span><span class="na">setDataBinderFactory</span><span class="o">(</span><span class="n">binderFactory</span><span class="o">);</span>
        <span class="n">invocableMethod</span><span class="o">.</span><span class="na">setParameterNameDiscoverer</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">parameterNameDiscoverer</span><span class="o">);</span>

        <span class="n">ModelAndViewContainer</span> <span class="n">mavContainer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ModelAndViewContainer</span><span class="o">();</span>
        <span class="n">mavContainer</span><span class="o">.</span><span class="na">addAllAttributes</span><span class="o">(</span><span class="n">RequestContextUtils</span><span class="o">.</span><span class="na">getInputFlashMap</span><span class="o">(</span><span class="n">request</span><span class="o">));</span>
        <span class="n">modelFactory</span><span class="o">.</span><span class="na">initModel</span><span class="o">(</span><span class="n">webRequest</span><span class="o">,</span> <span class="n">mavContainer</span><span class="o">,</span> <span class="n">invocableMethod</span><span class="o">);</span>
        <span class="n">mavContainer</span><span class="o">.</span><span class="na">setIgnoreDefaultModelOnRedirect</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">ignoreDefaultModelOnRedirect</span><span class="o">);</span>

        <span class="n">AsyncWebRequest</span> <span class="n">asyncWebRequest</span> <span class="o">=</span> <span class="n">WebAsyncUtils</span><span class="o">.</span><span class="na">createAsyncWebRequest</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
        <span class="n">asyncWebRequest</span><span class="o">.</span><span class="na">setTimeout</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">asyncRequestTimeout</span><span class="o">);</span>

        <span class="n">WebAsyncManager</span> <span class="n">asyncManager</span> <span class="o">=</span> <span class="n">WebAsyncUtils</span><span class="o">.</span><span class="na">getAsyncManager</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="n">asyncManager</span><span class="o">.</span><span class="na">setTaskExecutor</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">taskExecutor</span><span class="o">);</span>
        <span class="n">asyncManager</span><span class="o">.</span><span class="na">setAsyncWebRequest</span><span class="o">(</span><span class="n">asyncWebRequest</span><span class="o">);</span>
        <span class="n">asyncManager</span><span class="o">.</span><span class="na">registerCallableInterceptors</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">callableInterceptors</span><span class="o">);</span>
        <span class="n">asyncManager</span><span class="o">.</span><span class="na">registerDeferredResultInterceptors</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">deferredResultInterceptors</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">asyncManager</span><span class="o">.</span><span class="na">hasConcurrentResult</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">asyncManager</span><span class="o">.</span><span class="na">getConcurrentResult</span><span class="o">();</span>
            <span class="n">mavContainer</span> <span class="o">=</span> <span class="o">(</span><span class="n">ModelAndViewContainer</span><span class="o">)</span> <span class="n">asyncManager</span><span class="o">.</span><span class="na">getConcurrentResultContext</span><span class="o">()[</span><span class="n">0</span><span class="o">];</span>
            <span class="n">asyncManager</span><span class="o">.</span><span class="na">clearConcurrentResult</span><span class="o">();</span>
            <span class="n">LogFormatUtils</span><span class="o">.</span><span class="na">traceDebug</span><span class="o">(</span><span class="n">logger</span><span class="o">,</span> <span class="n">traceOn</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">formatted</span> <span class="o">=</span> <span class="n">LogFormatUtils</span><span class="o">.</span><span class="na">formatValue</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="o">!</span><span class="n">traceOn</span><span class="o">);</span>
                <span class="k">return</span> <span class="s">&#34;Resume with async result [&#34;</span> <span class="o">+</span> <span class="n">formatted</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
            <span class="o">});</span>
            <span class="n">invocableMethod</span> <span class="o">=</span> <span class="n">invocableMethod</span><span class="o">.</span><span class="na">wrapConcurrentResult</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">invocableMethod</span><span class="o">.</span><span class="na">invokeAndHandle</span><span class="o">(</span><span class="n">webRequest</span><span class="o">,</span> <span class="n">mavContainer</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">asyncManager</span><span class="o">.</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">getModelAndView</span><span class="o">(</span><span class="n">mavContainer</span><span class="o">,</span> <span class="n">modelFactory</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">finally</span> <span class="o">{</span>
        <span class="n">webRequest</span><span class="o">.</span><span class="na">requestCompleted</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><hr>
<blockquote>
<p>com.lql.controller.HelloController#handle02(String, String, String)</p>
<hr>
</blockquote>
<hr>
<h4 id="springmvc确定pojo值的三步">SpringMVC确定<strong>POJO</strong>值的三步：</h4>
<p>1、先看隐含模型中有没有这个key（标了ModelAttribute注解就是注解指定的value，没标就是参数类型的首字母小写）指定的值；如果有将这个值赋值给<strong>bindObject</strong>。</p>
<p>2、如果是<strong>SessionAttribute</strong>标注的属性，就从<strong>session</strong>中拿；</p>
<p>3、如果都不是就利用反射创建对象（<strong>null</strong>）；</p>
<hr>
<h4 id="总结两件事">总结两件事：</h4>
<h5 id="1运行流程简单版">1、运行流程简单版</h5>
<h5 id="2确定方法每个参数的值">2、确定方法每个参数的值</h5>
<h5 id="-----过时">&mdash;&ndash;》过时</h5>
<h6 id="1标注解">1）、标注解：</h6>
<p>保存注解的信息，最终得到这个注解应该对应解析的值；</p>
<h6 id="2没标注解">2）、没标注解：</h6>
<ol>
<li>
<p>看是否是原生API;</p>
</li>
<li>
<p>看是否是Model或者Map，xxx；</p>
</li>
<li>
<p>都不是，看是否是简单类型；paramName；</p>
</li>
<li>
<p>给attrName赋值；attrName（参数标了@ModelAttribute(&quot;&quot;)就是指定的，没标就是&quot;&quot;）</p>
<p><strong>==确定自定义类型参数==：</strong></p>
<p>1）attrName使用参数的类型首字母小写；或者使用之前<code>@ModelAttribute(&quot;&quot;)</code>的值</p>
<p>2）先看隐含模型中有没有这个attrName作为key对应的值；如果有就从隐含模型中获取并赋值；</p>
<p>3）看是否是<code>@SessionAttributes(value=&quot;&quot;)</code>标注的属性，如果是从<strong>session</strong>中拿，如果拿不到就会抛异常；</p>
<p>4）不是**@SessionAttributes**标注的，利用反射创建一个对象；</p>
</li>
<li>
<p>拿到之前创建好的对象，使用数据绑定器（<strong>WebDataBinder</strong>）将请求中的每个数据绑定到这个对象中；</p>
</li>
</ol>
<h5 id="-----现在">&mdash;&ndash;》现在</h5>
<ul>
<li>用解析器</li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/l3DFMGqjaV4QBCX.png" alt="image-20201211150327502"></p>
<hr>
<h3 id="6sessionattributesvaluehaha">6.<code>@SessionAttributes(value=&quot;haha&quot;)</code></h3>
<p>==最好不要使用==（为了避免可能引发的异常）</p>
<p>使用保证两点：</p>
<ul>
<li>要么隐含模型中有**@SessionAttributes**标注的属性</li>
<li>如果隐含模型中有，<strong>session</strong>还说有就一定要有，否则抛异常</li>
</ul>
<h1 id="七视图解析">七、视图解析</h1>
<p><strong>1、方法执行后的返回值会作为页面地址参考，转发或者重定向到页面</strong></p>
<p><strong>2、视图解析器可能会进行页面地址的拼串</strong></p>
<hr>
<h2 id="1源码">1、源码</h2>
<h3 id="1modelandview">1.ModelAndView</h3>
<ul>
<li>任何方法的返回值，最终都会被包装成<strong>ModelAndView</strong>对象</li>
</ul>
<p><img src="https://i.loli.net/2020/12/10/tSbIj95Dkx4yGnL.png" alt="image-20201210133136207"></p>
<hr>
<h3 id="2来到页面的方法">2.来到页面的方法</h3>
<p><code>processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</code></p>
<ul>
<li><strong>视图渲染</strong>流程：将域中的数据在页面展示；页面就是用来渲染模型数据的。</li>
</ul>
<h3 id="3渲染页面">3.渲染页面</h3>
<ul>
<li>调用<code>render(mv, request, response);</code>渲染页面。</li>
</ul>
<h3 id="4view与viewresolver">4.View与ViewResolver</h3>
<ul>
<li><strong>ViewResolver</strong>的作用是根据视图名（方法的返回值）得到<strong>View</strong>对象：</li>
</ul>
<hr>
<p><img src="https://i.loli.net/2020/12/10/JMl9Z8p7tV6oD4m.png" alt="image-20201210134607798"></p>
<hr>
<h3 id="5怎么能根据方法的返回值视图名得到view对象">5.怎么能根据方法的返回值（视图名）得到View对象？</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Nullable</span>
<span class="kd">protected</span> <span class="n">View</span> <span class="nf">resolveViewName</span><span class="o">(</span><span class="n">String</span> <span class="n">viewName</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span>
                               <span class="n">Locale</span> <span class="n">locale</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">viewResolvers</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//遍历所有的ViewResolver
</span><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="n">ViewResolver</span> <span class="n">viewResolver</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">viewResolvers</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//viewResolver视图解析器，根据方法的返回值得到View对象
</span><span class="c1"></span>            <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="n">viewResolver</span><span class="o">.</span><span class="na">resolveViewName</span><span class="o">(</span><span class="n">viewName</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><hr>
<h3 id="6resolveviewname实现">6.resolveViewName实现：</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="nd">@Nullable</span>
<span class="kd">public</span> <span class="n">View</span> <span class="nf">resolveViewName</span><span class="o">(</span><span class="n">String</span> <span class="n">viewName</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="n">isCache</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">createView</span><span class="o">(</span><span class="n">viewName</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
        <span class="n">Object</span> <span class="n">cacheKey</span> <span class="o">=</span> <span class="n">getCacheKey</span><span class="o">(</span><span class="n">viewName</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
        <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">viewAccessCache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cacheKey</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">viewCreationCache</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">view</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">viewCreationCache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cacheKey</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// Ask the subclass to create the View object.
</span><span class="c1"></span>                    <span class="c1">//根据方法的返回值创建出视图view对象
</span><span class="c1"></span>                    <span class="n">view</span> <span class="o">=</span> <span class="n">createView</span><span class="o">(</span><span class="n">viewName</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">cacheUnresolved</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">view</span> <span class="o">=</span> <span class="n">UNRESOLVED_VIEW</span><span class="o">;</span>
                    <span class="o">}</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">view</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">.</span><span class="na">cacheFilter</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">viewName</span><span class="o">,</span> <span class="n">locale</span><span class="o">))</span> <span class="o">{</span>
                        <span class="k">this</span><span class="o">.</span><span class="na">viewAccessCache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">cacheKey</span><span class="o">,</span> <span class="n">view</span><span class="o">);</span>
                        <span class="k">this</span><span class="o">.</span><span class="na">viewCreationCache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">cacheKey</span><span class="o">,</span> <span class="n">view</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="n">formatKey</span><span class="o">(</span><span class="n">cacheKey</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;served from cache&#34;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">view</span> <span class="o">!=</span> <span class="n">UNRESOLVED_VIEW</span> <span class="o">?</span> <span class="n">view</span> <span class="o">:</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><hr>
<h3 id="7创建view对象">7.创建view对象</h3>
<hr>
<p><img src="https://i.loli.net/2020/12/10/SwAs5VNTgkHixc8.png" alt="image-20201210140942524"></p>
<hr>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="n">View</span> <span class="nf">createView</span><span class="o">(</span><span class="n">String</span> <span class="n">viewName</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="c1">// If this resolver is not supposed to handle the given view,
</span><span class="c1"></span>    <span class="c1">// return null to pass on to the next resolver in the chain.
</span><span class="c1"></span>    <span class="k">if</span> <span class="o">(!</span><span class="n">canHandle</span><span class="o">(</span><span class="n">viewName</span><span class="o">,</span> <span class="n">locale</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Check for special &#34;redirect:&#34; prefix.
</span><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">viewName</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="n">REDIRECT_URL_PREFIX</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">redirectUrl</span> <span class="o">=</span> <span class="n">viewName</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">REDIRECT_URL_PREFIX</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
        <span class="n">RedirectView</span> <span class="n">view</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedirectView</span><span class="o">(</span><span class="n">redirectUrl</span><span class="o">,</span>
                                             <span class="n">isRedirectContextRelative</span><span class="o">(),</span> <span class="n">isRedirectHttp10Compatible</span><span class="o">());</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">hosts</span> <span class="o">=</span> <span class="n">getRedirectHosts</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">hosts</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">view</span><span class="o">.</span><span class="na">setHosts</span><span class="o">(</span><span class="n">hosts</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">applyLifecycleMethods</span><span class="o">(</span><span class="n">REDIRECT_URL_PREFIX</span><span class="o">,</span> <span class="n">view</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// Check for special &#34;forward:&#34; prefix.
</span><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">viewName</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="n">FORWARD_URL_PREFIX</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">forwardUrl</span> <span class="o">=</span> <span class="n">viewName</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">FORWARD_URL_PREFIX</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
        <span class="n">InternalResourceView</span> <span class="n">view</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InternalResourceView</span><span class="o">(</span><span class="n">forwardUrl</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">applyLifecycleMethods</span><span class="o">(</span><span class="n">FORWARD_URL_PREFIX</span><span class="o">,</span> <span class="n">view</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// Else fall back to superclass implementation: calling loadView.
</span><span class="c1"></span>    <span class="c1">//如果没有前缀就使用父类默认创建一个View；
</span><span class="c1"></span>    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">createView</span><span class="o">(</span><span class="n">viewName</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><hr>
<p>项目中使用<strong>JSTL</strong>（导包或配置），SpringMVC会把视图由InternalView转换为JstlView。</p>
<p><img src="https://i.loli.net/2020/12/10/MmRCeaPJnoftI6G.png" alt="image-20201210145152972"></p>
<hr>
<h3 id="8视图接口">8.视图接口</h3>
<p><img src="https://i.loli.net/2020/12/10/5SnIvNa8TVKZ4fi.png" alt="image-20201210145747944"></p>
<hr>
<h3 id="9返回view对象">9.返回View对象</h3>
<h4 id="1视图解析器得到view对象的流程">1）、视图解析器得到View对象的流程</h4>
<ul>
<li>所有配置的视图解析器都来尝试根据视图名（返回值）得到<strong>View</strong>对象；如果能得到就返回，得不到就换下一个视图解析器</li>
</ul>
<h4 id="2view对象的render方法">2）、View对象的render方法</h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                   <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;View &#34;</span> <span class="o">+</span> <span class="n">formatViewName</span><span class="o">()</span> <span class="o">+</span>
                     <span class="s">&#34;, model &#34;</span> <span class="o">+</span> <span class="o">(</span><span class="n">model</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">model</span> <span class="o">:</span> <span class="n">Collections</span><span class="o">.</span><span class="na">emptyMap</span><span class="o">())</span> <span class="o">+</span>
                     <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">staticAttributes</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">?</span> <span class="s">&#34;&#34;</span> <span class="o">:</span> <span class="s">&#34;, static attributes &#34;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">staticAttributes</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">mergedModel</span> <span class="o">=</span> <span class="n">createMergedOutputModel</span><span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="n">prepareResponse</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="c1">//渲染要给页面输出的所有数据
</span><span class="c1"></span>    <span class="n">renderMergedOutputModel</span><span class="o">(</span><span class="n">mergedModel</span><span class="o">,</span> <span class="n">getRequestToExpose</span><span class="o">(</span><span class="n">request</span><span class="o">),</span> <span class="n">response</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div><hr>
<h4 id="3rendermergedoutputmodel">3）、renderMergedOutputModel</h4>
<ul>
<li><strong>InternalResourceView</strong>有这个方法<strong>renderMergedOutputModel</strong>：</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">renderMergedOutputModel</span><span class="o">(</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="c1">// Expose the model object as request attributes.
</span><span class="c1"></span>    <span class="c1">//将模型中的数据放在请求域中
</span><span class="c1"></span>    <span class="n">exposeModelAsRequestAttributes</span><span class="o">(</span><span class="n">model</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>

    <span class="c1">// Expose helpers as request attributes, if any.
</span><span class="c1"></span>    <span class="n">exposeHelpers</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>

    <span class="c1">// Determine the path for the request dispatcher.
</span><span class="c1"></span>    <span class="n">String</span> <span class="n">dispatcherPath</span> <span class="o">=</span> <span class="n">prepareForRendering</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>

    <span class="c1">// Obtain a RequestDispatcher for the target resource (typically a JSP).
</span><span class="c1"></span>    <span class="n">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">getRequestDispatcher</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">dispatcherPath</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">rd</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">ServletException</span><span class="o">(</span><span class="s">&#34;Could not get RequestDispatcher for [&#34;</span> <span class="o">+</span> <span class="n">getUrl</span><span class="o">()</span> <span class="o">+</span>
                                   <span class="s">&#34;]: Check that the corresponding file exists within your web application archive!&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// If already included or response already committed, perform include, else forward.
</span><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">useInclude</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">getContentType</span><span class="o">());</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;Including [&#34;</span> <span class="o">+</span> <span class="n">getUrl</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">rd</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// Note: The forwarded resource is supposed to determine the content type itself.
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;Forwarding to [&#34;</span> <span class="o">+</span> <span class="n">getUrl</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">rd</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><hr>
<h4 id="4将模型中的所有数据取出来全放在request域中">4）、将模型中的所有数据取出来全放在request域中</h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">exposeModelAsRequestAttributes</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">model</span><span class="o">,</span>
			<span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

		<span class="n">model</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="n">request</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">});</span>
	<span class="o">}</span>
</code></pre></div><hr>
<hr>
<h2 id="2总结">2、总结：</h2>
<ul>
<li>视图解析器只是为了得到<strong>视图对象</strong>；视图对象才能真正的==转发（将模型数据全部放在请求域中）或者重定向到页面==，视图对象才能真正的==<strong>渲染视图</strong>==</li>
</ul>
<h3 id="1viewresolver接口">1.ViewResolver接口</h3>
<p><img src="https://i.loli.net/2020/12/01/8M9emtj3QrhE56f.png" alt=""></p>
<hr>
<h3 id="2视图">2.视图</h3>
<ul>
<li><strong>视图的作用是渲染模型数据，将模型里的数据以某种形式呈现给用户，视图对象由视图解析器负责实例化；由于视图是无状态的，所以他们不会有线程安全的问题。</strong></li>
</ul>
<h2 id="3国际化">3、国际化</h2>
<ul>
<li>导包导入了jstl的时候会自动创建为一个jstlView，可以快速方便的支持国际化功能</li>
</ul>
<h3 id="1javaweb国际化步骤">1.javaWeb国际化步骤</h3>
<ol>
<li>
<p>得得到一个Locale对象</p>
</li>
<li>
<p>使用<strong>ResourceBundle</strong>绑定国际化资源文件</p>
</li>
<li>
<p>使用<code>ResourceBundle.getstring(&quot;key&quot;);</code>获取到国际化配置文件中的值</p>
</li>
<li>
<p>web页面的国际化，fmt标签库来做：</p>
<p>​			<code>&lt;fmt:setLocale&gt;   &lt;fmt:setBundle&gt;   &lt;fmt:message&gt;</code></p>
</li>
</ol>
<h3 id="2jstlview">2.Jstlview</h3>
<ol>
<li>
<p>让Spring管理国际化资源</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- 让SpringMVC管理国际化资源文件：配置一个资源文件管理器 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;messageSource&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.context.support.ResourceBundleMessageSource&#34;</span><span class="nt">&gt;</span>
 <span class="c">&lt;!-- basename-指定基础名 --&gt;</span>
 <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;basename&#34;</span> <span class="na">value=</span><span class="s">&#34;i18n&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></li>
<li>
<p>直接去页面使用 <code>&lt;fmt:message&gt;</code></p>
</li>
</ol>
<pre><code class="language-jsp" data-lang="jsp">&lt;h1&gt;
&lt;fmt:message key=&quot;welcomeinfo&quot;/&gt;
&lt;/h1&gt;
&lt;form action=&quot;&quot;&gt;
	&lt;fmt:message key=&quot;username&quot;/&gt;：&lt;input/&gt;&lt;br&gt;
	&lt;fmt:message key=&quot;password&quot;/&gt;：&lt;input/&gt;&lt;br&gt;
	&lt;input type=&quot;submit&quot; value=&quot;&lt;fmt:message key=&quot;loginBtn&quot;/&gt;&quot;/&gt;
&lt;/form&gt;
</code></pre><hr>
<h3 id="3注意">3.注意</h3>
<ul>
<li>一定要过<strong>SpringMVC</strong>的视图解析流程，人家会创建一个<strong>jstlView</strong>帮你快速国际化</li>
<li>也不能写<strong>forward</strong>（转发），（会执行<code>InternalResourceView view = new InternalResourceView(forwardUrl);</code>创建view对象）</li>
</ul>
<hr>
<h3 id="4扩展">4.扩展</h3>
<ul>
<li>视图解析器根据方法的返回值得到视图对象</li>
<li>多个视图解析器都会尝试能否得到视图对象</li>
<li>视图对象不同就可以具有不同功能</li>
</ul>
<blockquote>
<p>for (ViewResolver viewResolver : this.viewResolvers) {
//viewResolver视图解析器，根据方法的返回值得到View对象
View view = viewResolver.resolveViewName(viewName, locale);
if (view != null) {
return view;
}
}</p>
</blockquote>
<hr>
<h3 id="5自定义视图和视图解析器">5.自定义视图和视图解析器</h3>
<ol>
<li>让我们的视图解析器工作</li>
<li>得到我们的视图对象</li>
<li>我们的视图对象自定义渲染逻辑</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&#34;哈哈&lt;h1&gt;即将展现精彩内容&lt;h1&gt;&#34;</span><span class="o">);</span>
</code></pre></div><p><img src="https://i.loli.net/2020/12/01/6SaxHvLtrKQqWwo.png" alt="image-20201201232137442"></p>
<h4 id="步骤">步骤</h4>
<ol>
<li>编写自定义的视图解析器和视图实现类</li>
<li>视图解析器必须放在ioc容器中</li>
</ol>
<hr>
<h2 id="4总体架构image-20201203141147863httpsilolinet20201203sckz1spvuge9ncdpng">4、总体架构：<img src="https://i.loli.net/2020/12/03/SCKZ1sPVUge9ncd.png" alt="image-20201203141147863"></h2>
<h2 id="5webxml同上">5、web.xml(同上)</h2>
<h2 id="6springdispatcherservlet-servletxml">6、springDispatcherServlet-servlet.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
	<span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
	<span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
	<span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd
</span><span class="s">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd&#34;</span><span class="nt">&gt;</span>

	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.lql&#34;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>
	
	<span class="c">&lt;!-- 可以导入JSTL包；fmt:message 
</span><span class="c">	InternalResourceViewResolver：优先级是最低的--&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/pages/&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="c">&lt;!-- &lt;property name=&#34;viewClass&#34; value=&#34;org.springframework.web.servlet.view.JstlView&#34;&gt;&lt;/property&gt; --&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	<span class="c">&lt;!-- 自定义的视图解析器 value=&#34;1&#34;数字越小优先级越高 --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.lql.view.MyMeiNvViewResolver&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;order&#34;</span> <span class="na">value=</span><span class="s">&#34;1&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
	<span class="c">&lt;!-- 让SpringMVC管理国际化资源文件：配置一个资源文件管理器;id是必须叫messageSource --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;messageSource&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.context.support.ResourceBundleMessageSource&#34;</span><span class="nt">&gt;</span>
	<span class="c">&lt;!-- basename-指定基础名 --&gt;</span>
	<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;basename&#34;</span> <span class="na">value=</span><span class="s">&#34;i18n&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
	<span class="c">&lt;!-- 发送一个请求(toLoginPage)：直接来到web-inf下的login页面；mvc名称空间下有一个请求映射标签 --&gt;</span>
	<span class="c">&lt;!-- path=&#34;&#34;：指定哪个请求
</span><span class="c">		 view-name：指定映射给哪个视图
</span><span class="c">		 走了SpringMVC的整个流程，视图解析等等。。帮忙国际化。
</span><span class="c">		 其他的请求就不好使了？
</span><span class="c">	 --&gt;</span>
	<span class="nt">&lt;mvc:view-controller</span> <span class="na">path=</span><span class="s">&#34;/toLoginPage&#34;</span> <span class="na">view-name=</span><span class="s">&#34;login&#34;</span><span class="nt">/&gt;</span>
	<span class="c">&lt;!-- 开启mvc注解驱动模式：开启了mvc的开挂模式 --&gt;</span>
	<span class="nt">&lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt;</span>
	
<span class="nt">&lt;/beans&gt;</span>

</code></pre></div><hr>
<h2 id="7jsp">7、jsp</h2>
<pre><code class="language-jsp" data-lang="jsp">#############index.jsp#######################################

&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;a href=&quot;hello&quot;&gt;hello&lt;/a&gt;
&lt;a href=&quot;handle01&quot;&gt;handle01-来到hello页面&lt;/a&gt;
&lt;a href=&quot;handle03&quot;&gt;handle03-重定向到hello.jsp页面&lt;/a&gt;

&lt;a href=&quot;toLoginPage&quot;&gt;去登录页面&lt;/a&gt;&lt;br&gt;&lt;br&gt;

&lt;a href=&quot;handleplus&quot;&gt;下载美女资源--你就会看见各种高清-无码图&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;

#############login.jsp#######################################

&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@ taglib prefix=&quot;fmt&quot; uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;
&lt;fmt:message key=&quot;welcomeinfo&quot;/&gt;
&lt;/h1&gt;
&lt;form action=&quot;&quot;&gt;
	&lt;fmt:message key=&quot;username&quot;/&gt;：&lt;input/&gt;&lt;br&gt;
	&lt;fmt:message key=&quot;password&quot;/&gt;：&lt;input/&gt;&lt;br&gt;
	&lt;input type=&quot;submit&quot; value=&quot;&lt;fmt:message key=&quot;loginBtn&quot;/&gt;&quot;/&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h2 id="8conf国际化properties">8、conf(国际化properties)</h2>
<pre><code class="language-properties" data-lang="properties">###########i18n_en_US.properties#################

welcomeinfo=WELCOME TO CODEWORLD
username=USERNAME
password=PASSWORD
loginBtn=LOGIN

################i18n_en_US.properties################

welcomeinfo=\u6B22\u8FCE\u6765\u5230\u4EE3\u7801\u4E16\u754C
username=\u7528\u6237\u540D
password=\u5BC6\u7801
loginBtn=\u767B\u5F55
</code></pre><hr>
<h2 id="9view自定义视图">9、view(自定义视图)</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.view</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.core.Ordered</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.View</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ViewResolver</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyMeiNvViewResolver</span> <span class="kd">implements</span> <span class="n">ViewResolver</span><span class="o">,</span><span class="n">Ordered</span><span class="o">{</span>

	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">order</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">View</span> <span class="nf">resolveViewName</span><span class="o">(</span><span class="n">String</span> <span class="n">viewName</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>		<span class="c1">//根据视图名返回视图对象
</span><span class="c1"></span>		<span class="c1">//meinv:/gaoqing	meinv:/dama
</span><span class="c1"></span>		<span class="c1">//forward:/login.jsp
</span><span class="c1"></span>		<span class="k">if</span><span class="o">(</span><span class="n">viewName</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">&#34;meinv:&#34;</span><span class="o">)){</span>
			<span class="k">return</span> <span class="k">new</span> <span class="n">MyView</span><span class="o">();</span>
		<span class="o">}</span><span class="k">else</span><span class="o">{</span>
			<span class="c1">//如果不能处理返回null即可
</span><span class="c1"></span>			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
		<span class="o">}</span>
		
	<span class="o">}</span>

	
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getOrder</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>		<span class="k">return</span> <span class="n">order</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="c1">//改变视图解析器的优先级
</span><span class="c1"></span>	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrder</span><span class="o">(</span><span class="n">Integer</span> <span class="n">order</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">order</span> <span class="o">=</span> <span class="n">order</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span>

<span class="o">**************************************************************</span>
    
<span class="kn">package</span> <span class="nn">com.lql.view</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.PrintWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.View</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 返回的数据的内容类型
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyView</span> <span class="kd">implements</span> <span class="n">View</span><span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">render</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">model</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;之前保存的数据：&#34;</span><span class="o">+</span><span class="n">model</span><span class="o">);</span>
		<span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">&#34;text/html&#34;</span><span class="o">);</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">vn</span> <span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span> <span class="n">model</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;video&#34;</span><span class="o">);</span>
		
		<span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&#34;哈哈&lt;h1&gt;即将展现精彩内容&lt;h1&gt;&#34;</span><span class="o">);</span>
		<span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">string</span> <span class="o">:</span> <span class="n">vn</span><span class="o">){</span>
			<span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&#34;&lt;a&gt;下载&#34;</span><span class="o">+</span><span class="n">string</span><span class="o">+</span><span class="s">&#34;.avi&lt;/a&gt;&lt;br/&gt;&#34;</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">vn</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">length</span><span class="o">()-</span><span class="n">7</span><span class="o">;</span>
		<span class="c1">//request.setAttribute(&#34;msg&#34;, num);
</span><span class="c1"></span>		
		<span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&#34;&#34;</span>
				<span class="o">+</span> <span class="s">&#34;&lt;script language=&#39;javascript&#39;&gt;&#34;</span>
				<span class="o">+</span> <span class="s">&#34;var aEle = document.getElementsByTagName(&#39;a&#39;);&#34;</span>
				<span class="o">+</span> <span class="s">&#34;var n=2;&#34;</span>
				<span class="o">+</span> <span class="s">&#34;alert(n);&#34;</span>
				<span class="o">+</span> <span class="s">&#34;for(let i=0;i&lt;n;i++){&#34;</span>
				<span class="o">+</span> <span class="s">&#34;aEle[i].onclick=function(){&#34;</span>
				<span class="o">+</span> <span class="s">&#34;alert(&#39;想下载吗？交学费&#39;);&#34;</span>
				<span class="o">+</span> <span class="s">&#34;}}&#34;</span>
				<span class="o">+</span> <span class="s">&#34;&lt;/script&gt;&#34;</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div><hr>
<h2 id="10controller类">10、Controller类</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(){</span>
		<span class="c1">//		/WEB-INF/pages/hello.jsp	/hello.jsp
</span><span class="c1"></span>		<span class="c1">//相对路径
</span><span class="c1"></span>		<span class="k">return</span> <span class="s">&#34;../../hello&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="cm">/**
</span><span class="cm">	 *  forward:转发到一个页面
</span><span class="cm">	 *  /hello.jsp：转发当前项目下的hello；
</span><span class="cm">	 *  
</span><span class="cm">	 *  一定加上/，如果不加/就是相对路径，容易出问题；
</span><span class="cm">	 *  forward:/hello.jsp
</span><span class="cm">	 *  forward:前缀的转发，不会由我们配置的视图解析器拼串
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle01&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle01</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;handle01&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;forward:/hello.jsp&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle02&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle02</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;handle02&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;forward:/handle01&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 重定向到hello.jsp页面
</span><span class="cm">	 * 有前缀的转发和重定向操作，配置的视图解析器就不会进行拼串；
</span><span class="cm">	 * 
</span><span class="cm">	 * 转发	forward：转发的路径
</span><span class="cm">	 * 重定向	redirect：重定向的路径
</span><span class="cm">	 * 		/hello.jsp:代表就是从当前项目下开始：SpringMVC会为路径自动的拼接上项目名
</span><span class="cm">	 * 		原生的Servlet重定向/路径需要加上项目名才能成功
</span><span class="cm">	 * 		response.sendRedirect(&#34;/hello.jsp&#34;)
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle03&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle03</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;handle03....&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;redirect:hello.jsp&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handle04&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handle04</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;handle04....&#34;</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;redirect:handle03&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/*@RequestMapping(&#34;/toLoginPage&#34;)
</span><span class="cm">	public String toLogin(){
</span><span class="cm">		return &#34;login&#34;;
</span><span class="cm">	}*/</span>

<span class="o">}</span>

<span class="o">***************************************************************</span>
    
<span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 自定义视图解析器和视图对象
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyViewResolverController</span> <span class="o">{</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/handleplus&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">handleplus</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
		<span class="c1">//meinv:/gaoqing	meinv:/dama
</span><span class="c1"></span>		<span class="c1">//forward:/login.jsp
</span><span class="c1"></span>		<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">vname</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">imgname</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
		<span class="n">vname</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;佟老师&#34;</span><span class="o">);</span>
		<span class="n">vname</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;飞哥&#34;</span><span class="o">);</span>
		
		<span class="n">imgname</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;萌萌&#34;</span><span class="o">);</span>
		
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;video&#34;</span><span class="o">,</span> <span class="n">vname</span><span class="o">);</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;imgs&#34;</span><span class="o">,</span> <span class="n">imgname</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;meinv:/gaoqing&#34;</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div><hr>
<hr>
<h1 id="八springmvc-restfulcrud">八、SpringMVC-RestfulCRUD</h1>
<h2 id="1需求">1、需求</h2>
<p>利用SpringMVC做一个<strong>CRUD</strong>（增删改查）符合<strong>Rest</strong>风格的；</p>
<p><strong>C</strong>：Creat：创建</p>
<p><strong>R</strong>：Retrieve：查询</p>
<p><strong>U</strong>：Update：更新</p>
<p><strong>D</strong>：Delete：删除</p>
<p>==使用Map，List代替数据库保存数据==</p>
<hr>
<h3 id="1员工列表">1.员工列表</h3>
<hr>
<p><img src="https://i.loli.net/2020/12/02/zNPUZtclMpwDJB7.png" alt="image-20201202105041647"></p>
<hr>
<h3 id="2员工添加">2.员工添加</h3>
<hr>
<p><img src="https://i.loli.net/2020/12/02/UQCkldKT73412ez.png" alt="image-20201202105243380"></p>
<hr>
<h3 id="3员工修改">3.员工修改</h3>
<hr>
<p><img src="https://i.loli.net/2020/12/02/shGHU3LWq1SAmMt.png" alt="image-20201202105425049"></p>
<hr>
<h3 id="4员工删除-点击完成删除来到列表页面">4.员工删除-点击完成删除来到列表页面</h3>
<hr>
<p>增删改查的URL地址	/资源名/资源标识</p>
<table>
<thead>
<tr>
<th>/资源名/资源标识</th>
<th>请求</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>/emp/1</td>
<td>GET</td>
<td>查询id为1的员工</td>
</tr>
<tr>
<td>/emp/1</td>
<td>PUT</td>
<td>更新id为1的员工</td>
</tr>
<tr>
<td>/emp/1</td>
<td>DELETE</td>
<td>删除id为1的员工</td>
</tr>
<tr>
<td>/emp</td>
<td>POST</td>
<td>新增员工</td>
</tr>
<tr>
<td>/emps</td>
<td>GET</td>
<td>查询所有员工</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="2逻辑">2、逻辑</h2>
<ul>
<li>
<p>员工列表展示：访问index.jsp&ndash;直接发送/emps&ndash;控制器查询所有员工&ndash;放在请求域中&ndash;转发到list页面展示</p>
</li>
<li>
<p>员工添加：</p>
<ul>
<li>在list页面点击“员工添加”&mdash;-（查询出所有部门信息要展示在页面）&mdash;&ndash;来到添加页面（add.jsp）&mdash;-输入员工数据&mdash;-点击保存（/emp）&mdash;-处理器收到员工保存请求（保存员工）&mdash;-保存完成以后还是来到列表页面</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>通过 SpringMVC 的<strong>表单标签</strong>可以实现将模型数据中的属性和 HTML 表单元素相绑定，以实现表单数据<strong>更便捷编辑和表单值的回显</strong></li>
</ul>
<hr>
<p>==<strong>==用了表单标签的页面可能会报错（请求域中没有一个</strong>command**类型的对象）</p>
<hr>
<p><img src="https://i.loli.net/2020/12/02/HkXTt547WlDexgM.png" alt="image-20201202144125026"></p>
<hr>
<hr>
<p><strong>解决（具体看后面源码）</strong>：</p>
<hr>
<p><img src="https://i.loli.net/2020/12/03/3adE2Lcl7ISyUmQ.png" alt="image-20201203155819023"></p>
<hr>
<h2 id="3总体架构image-20201203160818936httpsilolinet20201203nd8giwzv2klibe3png">3、总体架构：<img src="https://i.loli.net/2020/12/03/nd8gIwzV2KlibE3.png" alt="image-20201203160818936"></h2>
<h2 id="4webxml-1">4、web.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span> <span class="na">id=</span><span class="s">&#34;WebApp_ID&#34;</span> <span class="na">version=</span><span class="s">&#34;3.1&#34;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;display-name&gt;</span>7.SpringMVC_crud<span class="nt">&lt;/display-name&gt;</span>
  <span class="nt">&lt;welcome-file-list&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.html<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.htm<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.jsp<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>default.html<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>default.htm<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>default.jsp<span class="nt">&lt;/welcome-file&gt;</span>
  <span class="nt">&lt;/welcome-file-list&gt;</span>
  
  <span class="c">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span>
	<span class="nt">&lt;servlet&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springDispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>classpath:springmvc.xml<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
	<span class="nt">&lt;/servlet&gt;</span>

	<span class="c">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span>
	<span class="nt">&lt;servlet-mapping&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springDispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/servlet-mapping&gt;</span>
	
	<span class="c">&lt;!-- 字符编码Filter --&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>forceRequestEncoding<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>forceResponseEncoding<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>
	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
	
	<span class="c">&lt;!-- 支持Rest风格转换的Filter --&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="nt">&lt;/filter-class&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>
	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</code></pre></div><hr>
<h2 id="5springmvcxml">5、springmvc.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
	<span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
	<span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
	<span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd
</span><span class="s">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd&#34;</span><span class="nt">&gt;</span>

	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.lql&#34;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>
	
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/pages/&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
	<span class="c">&lt;!-- 默认前端控制器是拦截所有资源（除过jsp），js文件就404了；要js文件的请求是交给tomcat处理的
</span><span class="c">	http://localhost:8080/7.SpringMVC_crud/scripts/jquery-1.9.1.min.js --&gt;</span>
	<span class="c">&lt;!-- 告诉SpringMVC，自己映射的请求就自己处理，不能处理的请求直接交给tomcat --&gt;</span>
	<span class="c">&lt;!-- 静态资源能访问，动态映射的请求就不行 --&gt;</span>
	<span class="nt">&lt;mvc:default-servlet-handler/&gt;</span>
	<span class="c">&lt;!-- SprigMVC可以保证动态请求和静态请求都能访问 --&gt;</span>
	<span class="nt">&lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt;</span>
<span class="nt">&lt;/beans&gt;</span>

</code></pre></div><hr>
<h2 id="6jsp页面">6、jsp页面</h2>
<pre><code class="language-jsp" data-lang="jsp">****************index.jsp*************************************

&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!-- 访问项目就要展示员工列表页面 --&gt;
&lt;jsp:forward page=&quot;/emps&quot;&gt;&lt;/jsp:forward&gt;


****************list.jsp*************************************

&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;%
	pageContext.setAttribute(&quot;ctp&quot;, request.getContextPath());
%&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;员工列表页面&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;员工列表&lt;/h1&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;${ctp }/scripts/jquery-1.9.1.min.js&quot;&gt;&lt;/script&gt;
&lt;table border=&quot;1&quot; cellpadding=&quot;5&quot; cellspacing=&quot;0&quot;&gt;
	&lt;tr&gt;
		&lt;th&gt;ID&lt;/th&gt;
		&lt;th&gt;LastName&lt;/th&gt;
		&lt;th&gt;Email&lt;/th&gt;
		&lt;th&gt;Gender&lt;/th&gt;
		&lt;th&gt;Department&lt;/th&gt;
		&lt;th&gt;EDIT&lt;/th&gt;
		&lt;th&gt;DELETE&lt;/th&gt;
	&lt;/tr&gt;
	&lt;c:forEach items=&quot;${emps }&quot; var=&quot;emp&quot;&gt;
		&lt;tr&gt;
			&lt;td&gt;${emp.id}&lt;/td&gt;
			&lt;td&gt;${emp.lastName}&lt;/td&gt;
			&lt;td&gt;${emp.email}&lt;/td&gt;
			&lt;td&gt;${emp.gender==0?&quot;女&quot;:&quot;男&quot;}&lt;/td&gt;
			&lt;td&gt;${emp.department.departmentName}&lt;/td&gt;
			&lt;td&gt;
				&lt;a href=&quot;${ctp }/emp/${emp.id}&quot;&gt;edit&lt;/a&gt;
			&lt;/td&gt;
			&lt;td&gt;
				&lt;a href=&quot;${ctp }/emp/${emp.id}&quot; class=&quot;delBtn&quot;&gt;delete&lt;/a&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
	&lt;/c:forEach&gt;
	&lt;a href=&quot;${ctp }/toaddpage&quot;&gt;添加员工&lt;/a&gt; 
&lt;/table&gt;
	&lt;form action=&quot;${ctp }/emp/${emp.id}&quot; method=&quot;post&quot; id=&quot;deleteForm&quot;&gt;
		&lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;DELETE&quot;/&gt;
	&lt;/form&gt;
	&lt;script type=&quot;text/javascript&quot;&gt;
		$(function(){
			$(&quot;.delBtn&quot;).click(function(){
				//0、确认删除？
				if(confirm(&quot;确认要删除吗？&quot;)){
				//1、改变表单的action指向
				$(&quot;#deleteForm&quot;).attr(&quot;action&quot;,this.href);
				//2、提交表单
				$(&quot;#deleteForm&quot;).submit();
				return false;}else{
					return false;
				}
				
			});
		});
	&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;


****************add.jsp*************************************

&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;%@taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot; %&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;员工添加&lt;/h1&gt;
&lt;!-- 表单标签：
		通过 SpringMVC 的表单标签可以实现将模型数据中的属性和 HTML 表单元素相绑定，
		以实现表单数据更便捷编辑和表单值的回显
		1)、SpringMVC认为，表单数据中的每一项最终都是要回显的；
		path指定的是一个属性，这个属性是从隐含模型（请求域中取出的某个对象中的属性）
		path指定的每一个属性，请求域中必须有一个对象拥有这个属性；
				这个对象就是请求域中的command；
		modelAttribute=&quot;&quot;：
		1）、以前我们表单标签会从请求域中获取一个command对象；把这个对象中的每一个属性对应的显示出来
		2）、可以告诉SpringMVC不要去取command的值了，我放了一个modelAttribute指定的值，
			取对象用的key就用我modelAttribute指定的；
 --&gt;
 &lt;%
 	pageContext.setAttribute(&quot;ctp&quot;, request.getContextPath());
 %&gt;
 &lt;form:form action=&quot;${ctp }/emp&quot; modelAttribute=&quot;employee&quot; method=&quot;POST&quot;&gt;
 	&lt;!-- path就是原来html-input的name项；需要写
 		path：
 			1）、当作原生的name项
 			2）、自动回显隐含模型中某个对象对应的这个属性的值
 	 --&gt;
 	lastName:&lt;form:input path=&quot;lastName&quot;/&gt;&lt;br&gt;
 	eamil:&lt;form:input path=&quot;email&quot;/&gt;&lt;br&gt;
 	gender:&lt;br&gt;
 		男：&lt;form:radiobutton path=&quot;gender&quot; value=&quot;1&quot;/&gt;&lt;br&gt;
 		女：&lt;form:radiobutton path=&quot;gender&quot; value=&quot;0&quot;/&gt;&lt;br&gt;
 	dept:
 	&lt;!-- items=&quot;&quot;：指定要遍历的集合，自动遍历；遍历出的每一个元素是一个department对象
 		 itemLabel=&quot;属性名&quot;：指定遍历出的这个对象的哪个属性是作为option标签体的值
 		 itemValue=&quot;属性名&quot;：指定刚才遍历出来的这个对象的哪个属性是作为要提交的value值
 	 --&gt;
 		&lt;form:select path=&quot;department.id&quot; 
 		items=&quot;${depts}&quot; 
 		itemLabel=&quot;departmentName&quot; 
 		itemValue=&quot;id&quot;&gt;&lt;/form:select&gt;&lt;br&gt;
 	&lt;input type=&quot;submit&quot; value=&quot;保存&quot;/&gt;
 &lt;/form:form&gt;
 
&lt;!-- (Employee) --&gt;
&lt;%-- &lt;form action=&quot;&quot;&gt;
	lastName：&lt;input type=&quot;text&quot; name=&quot;lastName&quot;/&gt;&lt;br&gt;
	email：&lt;input type=&quot;text&quot; name=&quot;email&quot;/&gt;&lt;br&gt;
	gender：&lt;br&gt;
		男：&lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;1&quot;/&gt;&lt;br&gt;
		女：&lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;0&quot;/&gt;&lt;br&gt;
	dept：
		&lt;select name=&quot;department.id&quot;&gt;
			&lt;c:forEach items=&quot;${depts }&quot; var=&quot;deptItem&quot;&gt;
				&lt;!-- 标签中的是在页面 的提示选项信息，value才是真正提交的值--&gt;
				&lt;option value=&quot;${deptItem.id}&quot;&gt;${deptItem.departmentName}&lt;/option&gt;
			&lt;/c:forEach&gt;
		&lt;/select&gt;	
	&lt;input type=&quot;submit&quot; value=&quot;提交&quot;/&gt;
&lt;/form&gt; --%&gt;
&lt;/body&gt;
&lt;/html&gt;


****************edit.jsp*************************************

&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot; %&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;%
	pageContext.setAttribute(&quot;ctp&quot;, request.getContextPath());
%&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;员工修改页面&lt;/h1&gt;
&lt;!-- modelAttribute：这个表单的所有内容显示绑定的是绑定的是请求域中employee的值 --&gt;
&lt;form:form action=&quot;${ctp }/emp/${employee.id }&quot; 
	modelAttribute=&quot;employee&quot; method=&quot;post&quot;&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;put&quot;/&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;${employee.id }&quot;/&gt;
	email:&lt;form:input path=&quot;email&quot;/&gt;&lt;br&gt;
	gender:&amp;nbsp;&amp;nbsp;&amp;nbsp;
		男:&lt;form:radiobutton path=&quot;gender&quot; value=&quot;1&quot;/&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;
		女:&lt;form:radiobutton path=&quot;gender&quot; value=&quot;0&quot;/&gt;&lt;br&gt;
	dept:&lt;form:select path=&quot;department.id&quot; items=&quot;${depts }&quot;
			itemLabel=&quot;departmentName&quot; itemValue=&quot;id&quot;&gt;&lt;/form:select&gt;
	&lt;input type=&quot;submit&quot; value=&quot;修改&quot; /&gt;
&lt;/form:form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h2 id="7bean">7、bean</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.bean</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Department</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">departmentName</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Department</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="nf">Department</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="n">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">departmentName</span> <span class="o">=</span> <span class="n">string</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getDepartmentName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">departmentName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDepartmentName</span><span class="o">(</span><span class="n">String</span> <span class="n">departmentName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">departmentName</span> <span class="o">=</span> <span class="n">departmentName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">&#34;Department [id=&#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;, departmentName=&#34;</span> <span class="o">+</span> <span class="n">departmentName</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
<span class="o">}</span>


<span class="o">**************************************************************</span>
    
<span class="kn">package</span> <span class="nn">com.lql.bean</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
	<span class="c1">//1 male, 0 female
</span><span class="c1"></span>	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">gender</span><span class="o">;</span>
	
	<span class="kd">private</span> <span class="n">Department</span> <span class="n">department</span><span class="o">;</span>
	
	<span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getLastName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">lastName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLastName</span><span class="o">(</span><span class="n">String</span> <span class="n">lastName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmail</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">email</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getGender</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">gender</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setGender</span><span class="o">(</span><span class="n">Integer</span> <span class="n">gender</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">gender</span> <span class="o">=</span> <span class="n">gender</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Department</span> <span class="nf">getDepartment</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">department</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDepartment</span><span class="o">(</span><span class="n">Department</span> <span class="n">department</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">department</span> <span class="o">=</span> <span class="n">department</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Employee</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">lastName</span><span class="o">,</span> <span class="n">String</span> <span class="n">email</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">gender</span><span class="o">,</span>
			<span class="n">Department</span> <span class="n">department</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">gender</span> <span class="o">=</span> <span class="n">gender</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">department</span> <span class="o">=</span> <span class="n">department</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Employee</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">&#34;Employee [id=&#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;, lastName=&#34;</span> <span class="o">+</span> <span class="n">lastName</span> <span class="o">+</span> <span class="s">&#34;, email=&#34;</span>
				<span class="o">+</span> <span class="n">email</span> <span class="o">+</span> <span class="s">&#34;, gender=&#34;</span> <span class="o">+</span> <span class="n">gender</span> <span class="o">+</span> <span class="s">&#34;, department=&#34;</span> <span class="o">+</span> <span class="n">department</span>
				<span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	
<span class="o">}</span>

</code></pre></div><hr>
<h2 id="8dao">8、dao</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.lql.bean.Department</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 操作部门的dao
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DepartmentDao</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Department</span><span class="o">&gt;</span> <span class="n">departments</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	
	<span class="kd">static</span><span class="o">{</span>
		<span class="n">departments</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Department</span><span class="o">&gt;();</span>
		
		<span class="n">departments</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">101</span><span class="o">,</span> <span class="k">new</span> <span class="n">Department</span><span class="o">(</span><span class="n">101</span><span class="o">,</span> <span class="s">&#34;D-AA&#34;</span><span class="o">));</span>
		<span class="n">departments</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">102</span><span class="o">,</span> <span class="k">new</span> <span class="n">Department</span><span class="o">(</span><span class="n">102</span><span class="o">,</span> <span class="s">&#34;D-BB&#34;</span><span class="o">));</span>
		<span class="n">departments</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">103</span><span class="o">,</span> <span class="k">new</span> <span class="n">Department</span><span class="o">(</span><span class="n">103</span><span class="o">,</span> <span class="s">&#34;D-CC&#34;</span><span class="o">));</span>
		<span class="n">departments</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">104</span><span class="o">,</span> <span class="k">new</span> <span class="n">Department</span><span class="o">(</span><span class="n">104</span><span class="o">,</span> <span class="s">&#34;D-DD&#34;</span><span class="o">));</span>
		<span class="n">departments</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">105</span><span class="o">,</span> <span class="k">new</span> <span class="n">Department</span><span class="o">(</span><span class="n">105</span><span class="o">,</span> <span class="s">&#34;D-EE&#34;</span><span class="o">));</span>
	<span class="o">}</span>
	<span class="cm">/**
</span><span class="cm">	 * 返回所有的部门
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Department</span><span class="o">&gt;</span> <span class="nf">getDepartments</span><span class="o">(){</span>
		<span class="k">return</span> <span class="n">departments</span><span class="o">.</span><span class="na">values</span><span class="o">();</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 按照部门id查询部门
</span><span class="cm">	 * @param id
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="kd">public</span> <span class="n">Department</span> <span class="nf">getDepartment</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">){</span>
		<span class="k">return</span> <span class="n">departments</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
	<span class="o">}</span>
	
<span class="o">}</span>


<span class="o">**************************************************************</span>
    
<span class="kn">package</span> <span class="nn">com.lql.dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.lql.bean.Department</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.lql.bean.Employee</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * EmployeeDao：操作员工
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="nd">@Repository</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeDao</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Employee</span><span class="o">&gt;</span> <span class="n">employees</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	
	<span class="nd">@Autowired</span>
	<span class="kd">private</span> <span class="n">DepartmentDao</span> <span class="n">departmentDao</span><span class="o">;</span>
	
	<span class="kd">static</span><span class="o">{</span>
		<span class="n">employees</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Employee</span><span class="o">&gt;();</span>

		<span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1001</span><span class="o">,</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="n">1001</span><span class="o">,</span> <span class="s">&#34;E-AA&#34;</span><span class="o">,</span> <span class="s">&#34;aa@163.com&#34;</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">Department</span><span class="o">(</span><span class="n">101</span><span class="o">,</span> <span class="s">&#34;D-AA&#34;</span><span class="o">)));</span>
		<span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1002</span><span class="o">,</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="n">1002</span><span class="o">,</span> <span class="s">&#34;E-BB&#34;</span><span class="o">,</span> <span class="s">&#34;bb@163.com&#34;</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">Department</span><span class="o">(</span><span class="n">102</span><span class="o">,</span> <span class="s">&#34;D-BB&#34;</span><span class="o">)));</span>
		<span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1003</span><span class="o">,</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="n">1003</span><span class="o">,</span> <span class="s">&#34;E-CC&#34;</span><span class="o">,</span> <span class="s">&#34;cc@163.com&#34;</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="k">new</span> <span class="n">Department</span><span class="o">(</span><span class="n">103</span><span class="o">,</span> <span class="s">&#34;D-CC&#34;</span><span class="o">)));</span>
		<span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1004</span><span class="o">,</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="n">1004</span><span class="o">,</span> <span class="s">&#34;E-DD&#34;</span><span class="o">,</span> <span class="s">&#34;dd@163.com&#34;</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="k">new</span> <span class="n">Department</span><span class="o">(</span><span class="n">104</span><span class="o">,</span> <span class="s">&#34;D-DD&#34;</span><span class="o">)));</span>
		<span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1005</span><span class="o">,</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">(</span><span class="n">1005</span><span class="o">,</span> <span class="s">&#34;E-EE&#34;</span><span class="o">,</span> <span class="s">&#34;ee@163.com&#34;</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="k">new</span> <span class="n">Department</span><span class="o">(</span><span class="n">105</span><span class="o">,</span> <span class="s">&#34;D-EE&#34;</span><span class="o">)));</span>
	<span class="o">}</span>
	
	<span class="c1">//初始id
</span><span class="c1"></span>	<span class="kd">private</span> <span class="kd">static</span> <span class="n">Integer</span> <span class="n">initId</span> <span class="o">=</span> <span class="n">1006</span><span class="o">;</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 员工保存/更新二合一方法；
</span><span class="cm">	 * @param employee
</span><span class="cm">	 */</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Employee</span> <span class="n">employee</span><span class="o">){</span>
		<span class="k">if</span><span class="o">(</span><span class="n">employee</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
			<span class="n">employee</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">initId</span><span class="o">++);</span>
		<span class="o">}</span>
		
		<span class="c1">//根据部门id单独查出部门信息设置到员工对象中，页面提交时只需要提交部门的id
</span><span class="c1"></span>		<span class="n">employee</span><span class="o">.</span><span class="na">setDepartment</span><span class="o">(</span><span class="n">departmentDao</span><span class="o">.</span><span class="na">getDepartment</span><span class="o">(</span><span class="n">employee</span><span class="o">.</span><span class="na">getDepartment</span><span class="o">().</span><span class="na">getId</span><span class="o">()));</span>
		<span class="n">employees</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">employee</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">employee</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 查询所有员工
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="nf">getAll</span><span class="o">(){</span>
		<span class="k">return</span> <span class="n">employees</span><span class="o">.</span><span class="na">values</span><span class="o">();</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 按照id查询某个员工
</span><span class="cm">	 * @param id
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="kd">public</span> <span class="n">Employee</span> <span class="nf">get</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">){</span>
		<span class="k">return</span> <span class="n">employees</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 删除某个员工
</span><span class="cm">	 * @param id
</span><span class="cm">	 */</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">){</span>
		<span class="n">employees</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div><hr>
<h2 id="9controller">9、Controller</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.lql.bean.Department</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.lql.bean.Employee</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.lql.dao.DepartmentDao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.lql.dao.EmployeeDao</span><span class="o">;</span>


<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeController</span> <span class="o">{</span>

	<span class="nd">@Autowired</span>
	<span class="n">EmployeeDao</span> <span class="n">employeeDao</span><span class="o">;</span>
	
	<span class="nd">@Autowired</span>
	<span class="n">DepartmentDao</span> <span class="n">departmentDao</span><span class="o">;</span>
	
	
	<span class="cm">/**
</span><span class="cm">	 * 查询所有员工
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/emps&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmps</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">all</span> <span class="o">=</span> <span class="n">employeeDao</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;emps&#34;</span><span class="o">,</span> <span class="n">all</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;list&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/emp/{id}&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteEmp</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">employeeDao</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;redirect:/emps&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 查询员工，来到修改页面回显
</span><span class="cm">	 * @param id
</span><span class="cm">	 * @param model
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/emp/{id}&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmp</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">//1、查出员工信息
</span><span class="c1"></span>		<span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">employeeDao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
		<span class="c1">//2、放在请求域中
</span><span class="c1"></span>		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;employee&#34;</span><span class="o">,</span><span class="n">employee</span><span class="o">);</span>
		<span class="c1">//3、继续查出部门信息放在隐含模型中
</span><span class="c1"></span>		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Department</span><span class="o">&gt;</span> <span class="n">departments</span> <span class="o">=</span> <span class="n">departmentDao</span><span class="o">.</span><span class="na">getDepartments</span><span class="o">();</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;depts&#34;</span><span class="o">,</span> <span class="n">departments</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;edit&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="c1">//@ModelAttribute(&#34;employee&#34;)
</span><span class="c1"></span>	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/emp/{id}&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">PUT</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">updateEmp</span><span class="o">(</span><span class="n">Employee</span> <span class="n">employee</span><span class="cm">/*,@PathVariable(&#34;id&#34;)Integer id*/</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;要修改的员工：&#34;</span><span class="o">+</span><span class="n">employee</span><span class="o">);</span>
		<span class="c1">// xxxx更新修改二合一
</span><span class="c1"></span>		<span class="c1">//employeeDao.save(employee);
</span><span class="c1"></span>		<span class="k">return</span> <span class="s">&#34;redirect:/emps&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	
	<span class="nd">@ModelAttribute</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">myModelAttribute</span><span class="o">(</span>
			<span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">,</span><span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
		<span class="k">if</span><span class="o">(</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
			<span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">employeeDao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
			<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;employee&#34;</span><span class="o">,</span> <span class="n">employee</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;hahaha&#34;</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 保存员工
</span><span class="cm">	 * @param employee
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/emp&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">addEmp</span><span class="o">(</span><span class="n">Employee</span> <span class="n">employee</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;要添加的员工：&#34;</span><span class="o">+</span><span class="n">employee</span><span class="o">);</span>
		<span class="n">employeeDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">employee</span><span class="o">);</span>
		<span class="c1">//返回列表页面;重定向到查询所有员工的请求
</span><span class="c1"></span>		<span class="k">return</span> <span class="s">&#34;redirect:/emps&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 去员工添加页面，去页面之前需要查出所有部门信息，进行展示的
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/toaddpage&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toAddPage</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">//1、先查出所有部门
</span><span class="c1"></span>		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Department</span><span class="o">&gt;</span> <span class="n">departments</span> <span class="o">=</span> <span class="n">departmentDao</span><span class="o">.</span><span class="na">getDepartments</span><span class="o">();</span>
		<span class="c1">//2、放在请求域中
</span><span class="c1"></span>		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;depts&#34;</span><span class="o">,</span><span class="n">departments</span><span class="o">);</span>
		<span class="c1">//model.addAttribute(&#34;command&#34;,new Employee(null, &#34;张三&#34;, &#34;haha@gmail.com&#34;, 0, departmentDao.getDepartment(102)));
</span><span class="c1"></span>		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;employee&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">());</span>
		<span class="c1">//3、去添加页面
</span><span class="c1"></span>		<span class="k">return</span> <span class="s">&#34;add&#34;</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div><hr>
<hr>
<h1 id="九数据转换--数据格式化--数据校验">九、数据转换 &amp; 数据格式化 &amp; 数据校验</h1>
<ul>
<li>
<p>SpringMVC封装自定义类型对象，javaBean要和页面提交的数据进行一一绑定</p>
</li>
<li>
<p>页面提交的所有数据都是字符串</p>
<ul>
<li>
<blockquote>
<p>Integer age，Date birth，</p>
</blockquote>
</li>
<li>
<blockquote>
<p>employName=zhangsan&amp;age=18&amp;gender=1</p>
</blockquote>
</li>
<li>
<blockquote>
<p><code>String age=request.getParameter(&quot;age&quot;);</code></p>
<hr>
</blockquote>
</li>
</ul>
</li>
<li>
<p>数据绑定期间牵扯到以下操作：</p>
<hr>
</li>
</ul>
<ol>
<li>数据类型转化
<ul>
<li>String&ndash;Integer，String&ndash;Boolean，xxx</li>
</ul>
</li>
<li>数据格式化
<ul>
<li>birth=2020-12-02 &ndash;&gt;Date	2020/12/02	2020.12.02</li>
</ul>
</li>
<li>数据校验
<ul>
<li>我们提交的数据必须是合法的
<ul>
<li>前端校验：js+正则表达式（浏览器能禁用js，防君子不防小人）</li>
<li>后端校验：重要数据也是必须的</li>
</ul>
</li>
<li>校验成功&mdash;-&gt;数据合法</li>
<li>校验失败</li>
</ul>
</li>
</ol>
<hr>
<h2 id="1新的源码">1、新的源码</h2>
<h3 id="modelattributemethodprocessor">ModelAttributeMethodProcessor</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="nd">@Nullable</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="n">Object</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="n">MethodParameter</span> <span class="n">parameter</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span>
                                    <span class="n">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="n">Assert</span><span class="o">.</span><span class="na">state</span><span class="o">(</span><span class="n">mavContainer</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">,</span> <span class="s">&#34;ModelAttributeMethodProcessor requires ModelAndViewContainer&#34;</span><span class="o">);</span>
    <span class="n">Assert</span><span class="o">.</span><span class="na">state</span><span class="o">(</span><span class="n">binderFactory</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">,</span> <span class="s">&#34;ModelAttributeMethodProcessor requires WebDataBinderFactory&#34;</span><span class="o">);</span>

    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">ModelFactory</span><span class="o">.</span><span class="na">getNameForParameter</span><span class="o">(</span><span class="n">parameter</span><span class="o">);</span>
    <span class="n">ModelAttribute</span> <span class="n">ann</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="na">getParameterAnnotation</span><span class="o">(</span><span class="n">ModelAttribute</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ann</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">mavContainer</span><span class="o">.</span><span class="na">setBinding</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">ann</span><span class="o">.</span><span class="na">binding</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="n">Object</span> <span class="n">attribute</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">BindingResult</span> <span class="n">bindingResult</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">mavContainer</span><span class="o">.</span><span class="na">containsAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">attribute</span> <span class="o">=</span> <span class="n">mavContainer</span><span class="o">.</span><span class="na">getModel</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// Create attribute instance
</span><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">createAttribute</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">parameter</span><span class="o">,</span> <span class="n">binderFactory</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">catch</span> <span class="o">(</span><span class="n">BindException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">isBindExceptionRequired</span><span class="o">(</span><span class="n">parameter</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">// No BindingResult parameter -&gt; fail with BindException
</span><span class="c1"></span>                <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="c1">// Otherwise, expose null/empty value and associated BindingResult
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">parameter</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">()</span> <span class="o">==</span> <span class="n">Optional</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">attribute</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="n">bindingResult</span> <span class="o">=</span> <span class="n">ex</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">bindingResult</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Bean property binding and validation;
</span><span class="c1"></span>        <span class="c1">// skipped in case of binding failure on construction.
</span><span class="c1"></span>        <span class="n">WebDataBinder</span> <span class="n">binder</span> <span class="o">=</span> <span class="n">binderFactory</span><span class="o">.</span><span class="na">createBinder</span><span class="o">(</span><span class="n">webRequest</span><span class="o">,</span> <span class="n">attribute</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getTarget</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">mavContainer</span><span class="o">.</span><span class="na">isBindingDisabled</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
                <span class="c1">//将页面提交过来的数据封装到javaBean的属性中
</span><span class="c1"></span>                <span class="n">bindRequestParameters</span><span class="o">(</span><span class="n">binder</span><span class="o">,</span> <span class="n">webRequest</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">validateIfApplicable</span><span class="o">(</span><span class="n">binder</span><span class="o">,</span> <span class="n">parameter</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">().</span><span class="na">hasErrors</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">isBindExceptionRequired</span><span class="o">(</span><span class="n">binder</span><span class="o">,</span> <span class="n">parameter</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">BindException</span><span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">// Value type adaptation, also covering java.util.Optional
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">parameter</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">().</span><span class="na">isInstance</span><span class="o">(</span><span class="n">attribute</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="na">convertIfNecessary</span><span class="o">(</span><span class="n">binder</span><span class="o">.</span><span class="na">getTarget</span><span class="o">(),</span> <span class="n">parameter</span><span class="o">.</span><span class="na">getParameterType</span><span class="o">(),</span> <span class="n">parameter</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">bindingResult</span> <span class="o">=</span> <span class="n">binder</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></div><hr>
<h2 id="2webdatabinder数据绑定器">2、WebDataBinder（数据绑定器）</h2>
<ul>
<li>负责数据绑定工作
<ul>
<li>数据绑定期间产生的类型转换、格式化、数据校验等问题</li>
</ul>
</li>
</ul>
<hr>
<p><img src="https://i.loli.net/2020/12/03/R8ZQJUGcvbzL5pu.png" alt="image-20201203202002630"></p>
<hr>
<h3 id="1conversionservice组件">1.ConversionService组件</h3>
<ul>
<li>负责数据类型的转换以及格式化功能
<ul>
<li><strong>ConversionService</strong>（接口）中有非常多的<strong>converter</strong>（转换器）</li>
<li>不同类型的转换和格式化用它自己的==<strong>converter</strong>==进行工作</li>
</ul>
</li>
</ul>
<p><img src="https://i.loli.net/2020/12/10/Z9fDPxkabTYUB78.png" alt="image-20201203212924877"></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">ConversionService</span> <span class="n">converters</span> <span class="o">=</span>
	<span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@2d79adce</span><span class="o">,</span><span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalDate</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalDate</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorPrinter</span><span class="nd">@4fab9160</span>
	<span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalDateTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalDateTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorPrinter</span><span class="nd">@538ef1eb</span>
	<span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorPrinter</span><span class="nd">@c5146f2</span>
	<span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">OffsetDateTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">OffsetDateTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorPrinter</span><span class="nd">@528ad79</span>
	<span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">OffsetTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">OffsetTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorPrinter</span><span class="nd">@647f303</span>
	<span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">ZonedDateTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">ZonedDateTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorPrinter</span><span class="nd">@bda4d4c</span>
	<span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Calendar</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@2d79adce</span>
	<span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Date</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@2d79adce</span>
	<span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Byte</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Double</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Float</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">math</span><span class="o">.</span><span class="na">BigDecimal</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">math</span><span class="o">.</span><span class="na">BigInteger</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToStringConverter</span><span class="nd">@2007b2cb</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">CharacterToNumberFactory</span><span class="nd">@77af216b</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToStringConverter</span><span class="nd">@275d923b</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">EnumToIntegerConverter</span><span class="nd">@20024e53</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">EnumToStringConverter</span><span class="nd">@572a9f05</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">IntegerToEnumConverterFactory</span><span class="nd">@3d8e32c3</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">Instant</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">DateTimeConverters$LongToInstantConverter</span><span class="nd">@6a88519c</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Calendar</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">DateFormatterRegistrar$LongToCalendarConverter</span><span class="nd">@184331e8</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Calendar</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">DateFormatterRegistrar$LongToCalendarConverter</span><span class="nd">@5726b340</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Date</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">DateFormatterRegistrar$LongToDateConverter</span><span class="nd">@20fac40c</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Date</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">DateFormatterRegistrar$LongToDateConverter</span><span class="nd">@35ed78d5</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">NumberToCharacterConverter</span><span class="nd">@5235697d</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">NumberToNumberConverterFactory</span><span class="nd">@42238f9e</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToStringConverter</span><span class="nd">@359205bd</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@2d79adce</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalDate</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalDate</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorParser</span><span class="nd">@67872db8</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalDateTime</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalDateTime</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorParser</span><span class="nd">@d3aeccf</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalTime</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">LocalTime</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorParser</span><span class="nd">@40bd580d</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">OffsetDateTime</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">OffsetDateTime</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorParser</span><span class="nd">@5f2e7587</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">OffsetTime</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">OffsetTime</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorParser</span><span class="nd">@4f8b2790</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">ZonedDateTime</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">Jsr310DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@1f5a6f4a</span><span class="o">,</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">ZonedDateTime</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">standard</span><span class="o">.</span><span class="na">TemporalAccessorParser</span><span class="nd">@218d010a</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Calendar</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@2d79adce</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Date</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">datetime</span><span class="o">.</span><span class="na">DateTimeFormatAnnotationFormatterFactory</span><span class="nd">@2d79adce</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Byte</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Double</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Float</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Short</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">math</span><span class="o">.</span><span class="na">BigDecimal</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="nd">@org.springframework.format.annotation.NumberFormat</span> <span class="n">java</span><span class="o">.</span><span class="na">math</span><span class="o">.</span><span class="na">BigInteger</span><span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">format</span><span class="o">.</span><span class="na">number</span><span class="o">.</span><span class="na">NumberFormatAnnotationFormatterFactory</span><span class="nd">@4aa56e0e</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToBooleanConverter</span><span class="nd">@6b0029da</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToCharacterConverter</span><span class="nd">@79dcade1</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToEnumConverterFactory</span><span class="nd">@59004937</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToNumberConverterFactory</span><span class="nd">@2d4b1acf</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">nio</span><span class="o">.</span><span class="na">charset</span><span class="o">.</span><span class="na">Charset</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToCharsetConverter</span><span class="nd">@3415b...</span>
</code></pre></div><hr>
<hr>
<h3 id="2validators">2.validators</h3>
<ul>
<li>负责校验工作</li>
</ul>
<hr>
<p><img src="https://i.loli.net/2020/12/03/IpoQPAxXywm7vUJ.png" alt="image-20201203203154936"></p>
<hr>
<h3 id="3bindresult">3.bindResult</h3>
<ul>
<li>负责保存以及解析数据绑定期间数据校验产生的错误</li>
</ul>
<hr>
<p><img src="https://i.loli.net/2020/12/03/96tesloGfP327Uq.png" alt="image-20201203203558867"></p>
<hr>
<h2 id="3数据绑定流程">3、数据绑定流程</h2>
<p><img src="https://i.loli.net/2020/12/03/JUcBY2zrPRQXmyw.png" alt="image-20201203204355880"></p>
<hr>
<h2 id="4自定义类型转换">4、自定义类型转换</h2>
<h3 id="1步骤">1.步骤</h3>
<ol>
<li>
<p>实现<strong>Converter</strong>接口，写一个自定义类型的转换器</p>
<p><img src="https://i.loli.net/2020/12/11/defCunUGQ8S7zE1.png" alt="image-20201211105900102"></p>
<hr>
</li>
<li>
<p>你的<strong>Converter</strong>得放进<strong>ConversionService</strong>中（<strong>Converter</strong>是<strong>ConversionService</strong>中的组件）</p>
</li>
<li>
<p>将<strong>WebDataBinder</strong>中的<strong>ConversionService</strong>设置成我们这个加了自定义类型转换器的ConversionService</p>
</li>
<li>
<p>配置出<strong>ConversionService</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- 告诉SpringMVC别用默认的ConversionService，
</span><span class="c">  而用我自定义的ConversionService，可能有我们自定义的Converter --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;conversionService&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.context.support.ConversionServiceFactoryBean&#34;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- converters转换器中添加我们自定义的类型转换器 --&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;converters&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;set&gt;</span>
            <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.lql.component.MyStringToEmployeeConverter&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
        <span class="nt">&lt;/set&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></li>
<li>
<p>让<strong>SpringMVC</strong>用我们的<strong>ConversionService</strong></p>
</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- conversion-service=&#34;conversionService&#34;：使用我们自己配置的类型转换组件 --&gt;</span>
<span class="nt">&lt;mvc:annotation-driven</span> <span class="na">conversion-service=</span><span class="s">&#34;conversionService&#34;</span><span class="nt">&gt;&lt;/mvc:annotation-driven&gt;</span>
</code></pre></div><hr>
<h3 id="2总结三步换一种说法">2.总结三步（换一种说法）</h3>
<ol>
<li>实现<strong>Converter</strong>接口，做一个自定义类型的转换器</li>
<li>将这个<strong>Converter</strong>配置在<strong>ConversionService</strong>中</li>
<li>告诉<strong>SpringMVC</strong>使用这个<strong>ConversionService</strong></li>
</ol>
<hr>
<ul>
<li>源码上<strong>WebDataBinder</strong>上的<strong>ConversionService</strong>组件替换了</li>
</ul>
<p><img src="https://i.loli.net/2020/12/03/vUWTha7uzsFDiGJ.png" alt="image-20201203222227484"></p>
<hr>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">ConversionService</span> <span class="n">converters</span> <span class="o">=</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToStringConverter</span><span class="nd">@26baea68</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">CharacterToNumberFactory</span><span class="nd">@7ddf5356</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToStringConverter</span><span class="nd">@5b786b72</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">EnumToIntegerConverter</span><span class="nd">@7a709d66</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">EnumToStringConverter</span><span class="nd">@3cf7cd5b</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Integer</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">IntegerToEnumConverterFactory</span><span class="nd">@b68cfc9</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">NumberToCharacterConverter</span><span class="nd">@245728b7</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">NumberToNumberConverterFactory</span><span class="nd">@28ca2efb</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToStringConverter</span><span class="nd">@616716d5</span>
<span class="o">********************************************************************************</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">com</span><span class="o">.</span><span class="na">lql</span><span class="o">.</span><span class="na">bean</span><span class="o">.</span><span class="na">Employee</span> <span class="o">:</span> <span class="n">com</span><span class="o">.</span><span class="na">lql</span><span class="o">.</span><span class="na">component</span><span class="o">.</span><span class="na">MyStringToEmployeeConverter</span><span class="nd">@30e6e7dd</span>
<span class="o">********************************************************************************</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Boolean</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToBooleanConverter</span><span class="nd">@3e012521</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Character</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToCharacterConverter</span><span class="nd">@223c3438</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToEnumConverterFactory</span><span class="nd">@3bb56c98</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Number</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToNumberConverterFactory</span><span class="nd">@77910832</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">nio</span><span class="o">.</span><span class="na">charset</span><span class="o">.</span><span class="na">Charset</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToCharsetConverter</span><span class="nd">@25f5e65f</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Currency</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToCurrencyConverter</span><span class="nd">@3ebc894b</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Locale</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToLocaleConverter</span><span class="nd">@6a31ef1c</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Properties</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToPropertiesConverter</span><span class="nd">@2f9477b8</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">TimeZone</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToTimeZoneConverter</span><span class="nd">@d0ce4bb</span>
	<span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">UUID</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToUUIDConverter</span><span class="nd">@28d46e31</span>
	<span class="n">java</span><span class="o">.</span><span class="na">nio</span><span class="o">.</span><span class="na">charset</span><span class="o">.</span><span class="na">Charset</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToStringConverter</span><span class="nd">@5b90c42a</span>
	<span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">ZoneId</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">TimeZone</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ZoneIdToTimeZoneConverter</span><span class="nd">@708c3b21</span>
	<span class="n">java</span><span class="o">.</span><span class="na">time</span><span class="o">.</span><span class="na">ZonedDateTime</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Calendar</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ZonedDateTimeToCalendarConverter</span><span class="nd">@4e57a21</span>
	<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Currency</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToStringConverter</span><span class="nd">@2559aa52</span>
	<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Locale</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToStringConverter</span><span class="nd">@682e7a14</span>
	<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Properties</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">PropertiesToStringConverter</span><span class="nd">@72f857f4</span>
	<span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">UUID</span> <span class="o">-&gt;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="o">:</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToStringConverter</span><span class="nd">@40375a43</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ArrayToArrayConverter</span><span class="nd">@77cb2990</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ArrayToCollectionConverter</span><span class="nd">@4c92dc4a</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ArrayToObjectConverter</span><span class="nd">@7b53dd9</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ArrayToStringConverter</span><span class="nd">@62019d</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ByteBufferConverter</span><span class="nd">@f20cfaa</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ByteBufferConverter</span><span class="nd">@f20cfaa</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ByteBufferConverter</span><span class="nd">@f20cfaa</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ByteBufferConverter</span><span class="nd">@f20cfaa</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">CollectionToArrayConverter</span><span class="nd">@7ce565db</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">CollectionToCollectionConverter</span><span class="nd">@d549068</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">CollectionToObjectConverter</span><span class="nd">@6acd0c71</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">CollectionToStringConverter</span><span class="nd">@3379e562</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">FallbackObjectToStringConverter</span><span class="nd">@7636d645</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">IdToEntityConverter</span><span class="nd">@db1b888</span><span class="o">,</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToObjectConverter</span><span class="nd">@6772acb9</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">MapToMapConverter</span><span class="nd">@57fe7d04</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToArrayConverter</span><span class="nd">@23076676</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToCollectionConverter</span><span class="nd">@72e1f388</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToOptionalConverter</span><span class="nd">@592d8ed0</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToOptionalConverter</span><span class="nd">@592d8ed0</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">ObjectToOptionalConverter</span><span class="nd">@592d8ed0</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StreamConverter</span><span class="nd">@e4f4a43</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StreamConverter</span><span class="nd">@e4f4a43</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StreamConverter</span><span class="nd">@e4f4a43</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StreamConverter</span><span class="nd">@e4f4a43</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToArrayConverter</span><span class="nd">@2e4b2fa8</span>
	<span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">StringToCollectionConverter</span><span class="nd">@44b8baca</span>

</code></pre></div><hr>
<h2 id="5mvcannotation-driven">5、<code>&lt;mvc:annotation-driven/&gt;</code></h2>
<p><img src="https://i.loli.net/2020/12/03/SvD2b6xR4CdlPZw.png" alt="image-20201203224414349"></p>
<hr>
<h3 id="1springmvc解析mvcannotation-driven标签">1.SpringMVC解析<code>&lt;mvc:annotation-driven/&gt;</code>标签</h3>
<ul>
<li>添加了好多东西：</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">AnnotationDrivenBeanDefinitionParser</span> <span class="kd">implements</span> <span class="n">BeanDefinitionParser</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">HANDLER_MAPPING_BEAN_NAME</span> <span class="o">=</span> <span class="n">RequestMappingHandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">HANDLER_ADAPTER_BEAN_NAME</span> <span class="o">=</span> <span class="n">RequestMappingHandlerAdapter</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CONTENT_NEGOTIATION_MANAGER_BEAN_NAME</span> <span class="o">=</span> <span class="s">&#34;mvcContentNegotiationManager&#34;</span><span class="o">;</span>


	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">javaxValidationPresent</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="n">romePresent</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">jaxb2Present</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">jackson2Present</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">jackson2XmlPresent</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">jackson2SmilePresent</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">jackson2CborPresent</span><span class="o">;</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">gsonPresent</span><span class="o">;</span>

	<span class="kd">static</span> <span class="o">{</span>
		<span class="n">ClassLoader</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="n">AnnotationDrivenBeanDefinitionParser</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">();</span>
		<span class="n">javaxValidationPresent</span> <span class="o">=</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPresent</span><span class="o">(</span><span class="s">&#34;javax.validation.Validator&#34;</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">);</span>
		<span class="n">romePresent</span> <span class="o">=</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPresent</span><span class="o">(</span><span class="s">&#34;com.rometools.rome.feed.WireFeed&#34;</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">);</span>
		<span class="n">jaxb2Present</span> <span class="o">=</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPresent</span><span class="o">(</span><span class="s">&#34;javax.xml.bind.Binder&#34;</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">);</span>
		<span class="n">jackson2Present</span> <span class="o">=</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPresent</span><span class="o">(</span><span class="s">&#34;com.fasterxml.jackson.databind.ObjectMapper&#34;</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
						<span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPresent</span><span class="o">(</span><span class="s">&#34;com.fasterxml.jackson.core.JsonGenerator&#34;</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">);</span>
		<span class="n">jackson2XmlPresent</span> <span class="o">=</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPresent</span><span class="o">(</span><span class="s">&#34;com.fasterxml.jackson.dataformat.xml.XmlMapper&#34;</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">);</span>
		<span class="n">jackson2SmilePresent</span> <span class="o">=</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPresent</span><span class="o">(</span><span class="s">&#34;com.fasterxml.jackson.dataformat.smile.SmileFactory&#34;</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">);</span>
		<span class="n">jackson2CborPresent</span> <span class="o">=</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPresent</span><span class="o">(</span><span class="s">&#34;com.fasterxml.jackson.dataformat.cbor.CBORFactory&#34;</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">);</span>
		<span class="n">gsonPresent</span> <span class="o">=</span> <span class="n">ClassUtils</span><span class="o">.</span><span class="na">isPresent</span><span class="o">(</span><span class="s">&#34;com.google.gson.Gson&#34;</span><span class="o">,</span> <span class="n">classLoader</span><span class="o">);</span>
	<span class="o">}</span>


	<span class="nd">@Override</span>
	<span class="nd">@Nullable</span>
	<span class="kd">public</span> <span class="n">BeanDefinition</span> <span class="nf">parse</span><span class="o">(</span><span class="n">Element</span> <span class="n">element</span><span class="o">,</span> <span class="n">ParserContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">Object</span> <span class="n">source</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">extractSource</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
		<span class="n">XmlReaderContext</span> <span class="n">readerContext</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getReaderContext</span><span class="o">();</span>

		<span class="n">CompositeComponentDefinition</span> <span class="n">compDefinition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CompositeComponentDefinition</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getTagName</span><span class="o">(),</span> <span class="n">source</span><span class="o">);</span>
		<span class="n">context</span><span class="o">.</span><span class="na">pushContainingComponent</span><span class="o">(</span><span class="n">compDefinition</span><span class="o">);</span>

		<span class="n">RuntimeBeanReference</span> <span class="n">contentNegotiationManager</span> <span class="o">=</span> <span class="n">getContentNegotiationManager</span><span class="o">(</span><span class="n">element</span><span class="o">,</span> <span class="n">source</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>

		<span class="n">RootBeanDefinition</span> <span class="n">handlerMappingDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootBeanDefinition</span><span class="o">(</span><span class="n">RequestMappingHandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">handlerMappingDef</span><span class="o">.</span><span class="na">setSource</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
		<span class="n">handlerMappingDef</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="n">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">);</span>
		<span class="n">handlerMappingDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;order&#34;</span><span class="o">,</span> <span class="n">0</span><span class="o">);</span>
		<span class="n">handlerMappingDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;contentNegotiationManager&#34;</span><span class="o">,</span> <span class="n">contentNegotiationManager</span><span class="o">);</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">hasAttribute</span><span class="o">(</span><span class="s">&#34;enable-matrix-variables&#34;</span><span class="o">))</span> <span class="o">{</span>
			<span class="n">Boolean</span> <span class="n">enableMatrixVariables</span> <span class="o">=</span> <span class="n">Boolean</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;enable-matrix-variables&#34;</span><span class="o">));</span>
			<span class="n">handlerMappingDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;removeSemicolonContent&#34;</span><span class="o">,</span> <span class="o">!</span><span class="n">enableMatrixVariables</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="n">configurePathMatchingProperties</span><span class="o">(</span><span class="n">handlerMappingDef</span><span class="o">,</span> <span class="n">element</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
		<span class="n">readerContext</span><span class="o">.</span><span class="na">getRegistry</span><span class="o">().</span><span class="na">registerBeanDefinition</span><span class="o">(</span><span class="n">HANDLER_MAPPING_BEAN_NAME</span><span class="o">,</span> <span class="n">handlerMappingDef</span><span class="o">);</span>

		<span class="n">RuntimeBeanReference</span> <span class="n">corsRef</span> <span class="o">=</span> <span class="n">MvcNamespaceUtils</span><span class="o">.</span><span class="na">registerCorsConfigurations</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="n">source</span><span class="o">);</span>
		<span class="n">handlerMappingDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;corsConfigurations&#34;</span><span class="o">,</span> <span class="n">corsRef</span><span class="o">);</span>

		<span class="n">RuntimeBeanReference</span> <span class="n">conversionService</span> <span class="o">=</span> <span class="n">getConversionService</span><span class="o">(</span><span class="n">element</span><span class="o">,</span> <span class="n">source</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
		<span class="n">RuntimeBeanReference</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">getValidator</span><span class="o">(</span><span class="n">element</span><span class="o">,</span> <span class="n">source</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
		<span class="n">RuntimeBeanReference</span> <span class="n">messageCodesResolver</span> <span class="o">=</span> <span class="n">getMessageCodesResolver</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>

		<span class="n">RootBeanDefinition</span> <span class="n">bindingDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootBeanDefinition</span><span class="o">(</span><span class="n">ConfigurableWebBindingInitializer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">bindingDef</span><span class="o">.</span><span class="na">setSource</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
		<span class="n">bindingDef</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="n">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">);</span>
		<span class="n">bindingDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;conversionService&#34;</span><span class="o">,</span> <span class="n">conversionService</span><span class="o">);</span>
		<span class="n">bindingDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;validator&#34;</span><span class="o">,</span> <span class="n">validator</span><span class="o">);</span>
		<span class="n">bindingDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;messageCodesResolver&#34;</span><span class="o">,</span> <span class="n">messageCodesResolver</span><span class="o">);</span>

		<span class="n">ManagedList</span><span class="o">&lt;?&gt;</span> <span class="n">messageConverters</span> <span class="o">=</span> <span class="n">getMessageConverters</span><span class="o">(</span><span class="n">element</span><span class="o">,</span> <span class="n">source</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
		<span class="n">ManagedList</span><span class="o">&lt;?&gt;</span> <span class="n">argumentResolvers</span> <span class="o">=</span> <span class="n">getArgumentResolvers</span><span class="o">(</span><span class="n">element</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
		<span class="n">ManagedList</span><span class="o">&lt;?&gt;</span> <span class="n">returnValueHandlers</span> <span class="o">=</span> <span class="n">getReturnValueHandlers</span><span class="o">(</span><span class="n">element</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">asyncTimeout</span> <span class="o">=</span> <span class="n">getAsyncTimeout</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
		<span class="n">RuntimeBeanReference</span> <span class="n">asyncExecutor</span> <span class="o">=</span> <span class="n">getAsyncExecutor</span><span class="o">(</span><span class="n">element</span><span class="o">);</span>
		<span class="n">ManagedList</span><span class="o">&lt;?&gt;</span> <span class="n">callableInterceptors</span> <span class="o">=</span> <span class="n">getInterceptors</span><span class="o">(</span><span class="n">element</span><span class="o">,</span> <span class="n">source</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="s">&#34;callable-interceptors&#34;</span><span class="o">);</span>
		<span class="n">ManagedList</span><span class="o">&lt;?&gt;</span> <span class="n">deferredResultInterceptors</span> <span class="o">=</span> <span class="n">getInterceptors</span><span class="o">(</span><span class="n">element</span><span class="o">,</span> <span class="n">source</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="s">&#34;deferred-result-interceptors&#34;</span><span class="o">);</span>

		<span class="n">RootBeanDefinition</span> <span class="n">handlerAdapterDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootBeanDefinition</span><span class="o">(</span><span class="n">RequestMappingHandlerAdapter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">setSource</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
		<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="n">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">);</span>
		<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;contentNegotiationManager&#34;</span><span class="o">,</span> <span class="n">contentNegotiationManager</span><span class="o">);</span>
		<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;webBindingInitializer&#34;</span><span class="o">,</span> <span class="n">bindingDef</span><span class="o">);</span>
		<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;messageConverters&#34;</span><span class="o">,</span> <span class="n">messageConverters</span><span class="o">);</span>
		<span class="n">addRequestBodyAdvice</span><span class="o">(</span><span class="n">handlerAdapterDef</span><span class="o">);</span>
		<span class="n">addResponseBodyAdvice</span><span class="o">(</span><span class="n">handlerAdapterDef</span><span class="o">);</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">hasAttribute</span><span class="o">(</span><span class="s">&#34;ignore-default-model-on-redirect&#34;</span><span class="o">))</span> <span class="o">{</span>
			<span class="n">Boolean</span> <span class="n">ignoreDefaultModel</span> <span class="o">=</span> <span class="n">Boolean</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ignore-default-model-on-redirect&#34;</span><span class="o">));</span>
			<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;ignoreDefaultModelOnRedirect&#34;</span><span class="o">,</span> <span class="n">ignoreDefaultModel</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">argumentResolvers</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;customArgumentResolvers&#34;</span><span class="o">,</span> <span class="n">argumentResolvers</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">returnValueHandlers</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;customReturnValueHandlers&#34;</span><span class="o">,</span> <span class="n">returnValueHandlers</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">asyncTimeout</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;asyncRequestTimeout&#34;</span><span class="o">,</span> <span class="n">asyncTimeout</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">asyncExecutor</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;taskExecutor&#34;</span><span class="o">,</span> <span class="n">asyncExecutor</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;callableInterceptors&#34;</span><span class="o">,</span> <span class="n">callableInterceptors</span><span class="o">);</span>
		<span class="n">handlerAdapterDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;deferredResultInterceptors&#34;</span><span class="o">,</span> <span class="n">deferredResultInterceptors</span><span class="o">);</span>
		<span class="n">readerContext</span><span class="o">.</span><span class="na">getRegistry</span><span class="o">().</span><span class="na">registerBeanDefinition</span><span class="o">(</span><span class="n">HANDLER_ADAPTER_BEAN_NAME</span><span class="o">,</span> <span class="n">handlerAdapterDef</span><span class="o">);</span>

		<span class="n">RootBeanDefinition</span> <span class="n">uriContributorDef</span> <span class="o">=</span>
				<span class="k">new</span> <span class="n">RootBeanDefinition</span><span class="o">(</span><span class="n">CompositeUriComponentsContributorFactoryBean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">uriContributorDef</span><span class="o">.</span><span class="na">setSource</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
		<span class="n">uriContributorDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">addPropertyValue</span><span class="o">(</span><span class="s">&#34;handlerAdapter&#34;</span><span class="o">,</span> <span class="n">handlerAdapterDef</span><span class="o">);</span>
		<span class="n">uriContributorDef</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">addPropertyValue</span><span class="o">(</span><span class="s">&#34;conversionService&#34;</span><span class="o">,</span> <span class="n">conversionService</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">uriContributorName</span> <span class="o">=</span> <span class="n">MvcUriComponentsBuilder</span><span class="o">.</span><span class="na">MVC_URI_COMPONENTS_CONTRIBUTOR_BEAN_NAME</span><span class="o">;</span>
		<span class="n">readerContext</span><span class="o">.</span><span class="na">getRegistry</span><span class="o">().</span><span class="na">registerBeanDefinition</span><span class="o">(</span><span class="n">uriContributorName</span><span class="o">,</span> <span class="n">uriContributorDef</span><span class="o">);</span>

		<span class="n">RootBeanDefinition</span> <span class="n">csInterceptorDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootBeanDefinition</span><span class="o">(</span><span class="n">ConversionServiceExposingInterceptor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">csInterceptorDef</span><span class="o">.</span><span class="na">setSource</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
		<span class="n">csInterceptorDef</span><span class="o">.</span><span class="na">getConstructorArgumentValues</span><span class="o">().</span><span class="na">addIndexedArgumentValue</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">conversionService</span><span class="o">);</span>
		<span class="n">RootBeanDefinition</span> <span class="n">mappedInterceptorDef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootBeanDefinition</span><span class="o">(</span><span class="n">MappedInterceptor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">mappedInterceptorDef</span><span class="o">.</span><span class="na">setSource</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
		<span class="n">mappedInterceptorDef</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="n">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">);</span>
		<span class="n">mappedInterceptorDef</span><span class="o">.</span><span class="na">getConstructorArgumentValues</span><span class="o">().</span><span class="na">addIndexedArgumentValue</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="o">(</span><span class="n">Object</span><span class="o">)</span> <span class="kc">null</span><span class="o">);</span>
		<span class="n">mappedInterceptorDef</span><span class="o">.</span><span class="na">getConstructorArgumentValues</span><span class="o">().</span><span class="na">addIndexedArgumentValue</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">csInterceptorDef</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">mappedInterceptorName</span> <span class="o">=</span> <span class="n">readerContext</span><span class="o">.</span><span class="na">registerWithGeneratedName</span><span class="o">(</span><span class="n">mappedInterceptorDef</span><span class="o">);</span>

		<span class="n">RootBeanDefinition</span> <span class="n">methodExceptionResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootBeanDefinition</span><span class="o">(</span><span class="n">ExceptionHandlerExceptionResolver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">methodExceptionResolver</span><span class="o">.</span><span class="na">setSource</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
		<span class="n">methodExceptionResolver</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="n">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">);</span>
		<span class="n">methodExceptionResolver</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;contentNegotiationManager&#34;</span><span class="o">,</span> <span class="n">contentNegotiationManager</span><span class="o">);</span>
		<span class="n">methodExceptionResolver</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;messageConverters&#34;</span><span class="o">,</span> <span class="n">messageConverters</span><span class="o">);</span>
		<span class="n">methodExceptionResolver</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;order&#34;</span><span class="o">,</span> <span class="n">0</span><span class="o">);</span>
		<span class="n">addResponseBodyAdvice</span><span class="o">(</span><span class="n">methodExceptionResolver</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">argumentResolvers</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">methodExceptionResolver</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;customArgumentResolvers&#34;</span><span class="o">,</span> <span class="n">argumentResolvers</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">returnValueHandlers</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">methodExceptionResolver</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;customReturnValueHandlers&#34;</span><span class="o">,</span> <span class="n">returnValueHandlers</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="n">String</span> <span class="n">methodExResolverName</span> <span class="o">=</span> <span class="n">readerContext</span><span class="o">.</span><span class="na">registerWithGeneratedName</span><span class="o">(</span><span class="n">methodExceptionResolver</span><span class="o">);</span>

		<span class="n">RootBeanDefinition</span> <span class="n">statusExceptionResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootBeanDefinition</span><span class="o">(</span><span class="n">ResponseStatusExceptionResolver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">statusExceptionResolver</span><span class="o">.</span><span class="na">setSource</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
		<span class="n">statusExceptionResolver</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="n">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">);</span>
		<span class="n">statusExceptionResolver</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;order&#34;</span><span class="o">,</span> <span class="n">1</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">statusExResolverName</span> <span class="o">=</span> <span class="n">readerContext</span><span class="o">.</span><span class="na">registerWithGeneratedName</span><span class="o">(</span><span class="n">statusExceptionResolver</span><span class="o">);</span>

		<span class="n">RootBeanDefinition</span> <span class="n">defaultExceptionResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RootBeanDefinition</span><span class="o">(</span><span class="n">DefaultHandlerExceptionResolver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
		<span class="n">defaultExceptionResolver</span><span class="o">.</span><span class="na">setSource</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
		<span class="n">defaultExceptionResolver</span><span class="o">.</span><span class="na">setRole</span><span class="o">(</span><span class="n">BeanDefinition</span><span class="o">.</span><span class="na">ROLE_INFRASTRUCTURE</span><span class="o">);</span>
		<span class="n">defaultExceptionResolver</span><span class="o">.</span><span class="na">getPropertyValues</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;order&#34;</span><span class="o">,</span> <span class="n">2</span><span class="o">);</span>
		<span class="n">String</span> <span class="n">defaultExResolverName</span> <span class="o">=</span> <span class="n">readerContext</span><span class="o">.</span><span class="na">registerWithGeneratedName</span><span class="o">(</span><span class="n">defaultExceptionResolver</span><span class="o">);</span>

		<span class="n">context</span><span class="o">.</span><span class="na">registerComponent</span><span class="o">(</span><span class="k">new</span> <span class="n">BeanComponentDefinition</span><span class="o">(</span><span class="n">handlerMappingDef</span><span class="o">,</span> <span class="n">HANDLER_MAPPING_BEAN_NAME</span><span class="o">));</span>
		<span class="n">context</span><span class="o">.</span><span class="na">registerComponent</span><span class="o">(</span><span class="k">new</span> <span class="n">BeanComponentDefinition</span><span class="o">(</span><span class="n">handlerAdapterDef</span><span class="o">,</span> <span class="n">HANDLER_ADAPTER_BEAN_NAME</span><span class="o">));</span>
		<span class="n">context</span><span class="o">.</span><span class="na">registerComponent</span><span class="o">(</span><span class="k">new</span> <span class="n">BeanComponentDefinition</span><span class="o">(</span><span class="n">uriContributorDef</span><span class="o">,</span> <span class="n">uriContributorName</span><span class="o">));</span>
		<span class="n">context</span><span class="o">.</span><span class="na">registerComponent</span><span class="o">(</span><span class="k">new</span> <span class="n">BeanComponentDefinition</span><span class="o">(</span><span class="n">mappedInterceptorDef</span><span class="o">,</span> <span class="n">mappedInterceptorName</span><span class="o">));</span>
		<span class="n">context</span><span class="o">.</span><span class="na">registerComponent</span><span class="o">(</span><span class="k">new</span> <span class="n">BeanComponentDefinition</span><span class="o">(</span><span class="n">methodExceptionResolver</span><span class="o">,</span> <span class="n">methodExResolverName</span><span class="o">));</span>
		<span class="n">context</span><span class="o">.</span><span class="na">registerComponent</span><span class="o">(</span><span class="k">new</span> <span class="n">BeanComponentDefinition</span><span class="o">(</span><span class="n">statusExceptionResolver</span><span class="o">,</span> <span class="n">statusExResolverName</span><span class="o">));</span>
		<span class="n">context</span><span class="o">.</span><span class="na">registerComponent</span><span class="o">(</span><span class="k">new</span> <span class="n">BeanComponentDefinition</span><span class="o">(</span><span class="n">defaultExceptionResolver</span><span class="o">,</span> <span class="n">defaultExResolverName</span><span class="o">));</span>

		<span class="c1">// Ensure BeanNameUrlHandlerMapping (SPR-8289) and default HandlerAdapters are not &#34;turned off&#34;
</span><span class="c1"></span>		<span class="n">MvcNamespaceUtils</span><span class="o">.</span><span class="na">registerDefaultComponents</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">source</span><span class="o">);</span>

		<span class="n">context</span><span class="o">.</span><span class="na">popAndRegisterContainingComponent</span><span class="o">();</span>

		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
	<span class="o">}</span>
</code></pre></div><hr>
<h3 id="2mvcdefault-servlet-handler和mvcannotation-driven">2.<code>&lt;mvc:default-servlet-handler/&gt;</code>和	<code>mvc:annotation-driven</code></h3>
<ol>
<li>
<p>均不配置</p>
<ul>
<li>动态资源（@RequestMapping映射的资源）能访问，静态资源（.html、.js、.img）不行</li>
<li><strong>HandlerMapping</strong></li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/7BmWxod2JvFYOEC.png" alt="image-20201211134234440"></p>
<ul>
<li><strong>RequestMappingHandlerMapping</strong>中的<strong>mappingLookup</strong>中保存了每一个资源的映射信息，而<strong>没有</strong>保存静态资源映射的请求。==故动态资源能访问，静态不能==。</li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/VX15zht2YEKknwA.png" alt="image-20201211135253416"></p>
<ul>
<li><strong>HandlerAdapter</strong>（方法执行的适配器）</li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/tKjAYbk14HJfpG8.png" alt="image-20201211140501553"></p>
<ul>
<li>
<p><strong>RequestMappingHandlerAdapter</strong>帮我们执行目标方法</p>
<hr>
</li>
</ul>
</li>
<li>
<p>配前者不配后者</p>
<ul>
<li>静态资源🆗，动态资源完蛋</li>
<li><strong>HandlerMapping</strong></li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/bF8lUZVnxa7i4cQ.png" alt="image-20201211142832851"></p>
<ul>
<li><strong>SimpleUrlHandlerMapping</strong>替换了<strong>RequestMappingHandlerMapping</strong>，而<strong>前者</strong>能把所有请求映射给<strong>tomcat</strong>，==故静态资源能访问，而动态不能。==</li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/VAifba61Xwtc4NQ.png" alt="Snipaste_2020-12-11_14-22-45"></p>
<ul>
<li><strong>HandlerAdapter</strong>（方法执行的适配器）</li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/ZTPnjet4Fh3kDVw.png" alt="image-20201211150856448"></p>
<ul>
<li><strong>RequestMappingHandlerAdapter</strong>都没了，方法都不能执行</li>
</ul>
<hr>
</li>
<li>
<p>配后者不配前者</p>
<ul>
<li>动态资源🆗，静态资源完蛋</li>
</ul>
</li>
<li>
<p>均配置</p>
<ul>
<li>动、静态资源都能访问</li>
<li><strong>HandlerMapping</strong></li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/vSOb2UgkHXhxwdt.png" alt="image-20201211144133469"></p>
</li>
</ol>
<hr>
<h2 id="6格式化">6、格式化</h2>
<h3 id="1需求-1">1.需求</h3>
<ul>
<li>日期格式：2020-12-07</li>
<li>页面提交的数据格式如果不正确，就是404</li>
</ul>
<h3 id="2解决">2.解决</h3>
<ul>
<li>对日期类型的属性使用 <strong>@DateTimeFormat</strong> 注解</li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/fVOak9H3hrZNJ4o.png" alt="image-20201211153612380"></p>
<ul>
<li>
<p>==注意：如果要使用自定义类型转换==（不用自定义类型转换也是可以的）</p>
<ul>
<li><strong>ConversionServiceFactoryBean</strong>创建的<strong>ConversionService</strong>组件是没有格式化器存在的</li>
<li>而实现<strong>ConversionService</strong>接口的 <strong>FormattingConversionService</strong>既具有<strong>类型转换</strong>的功能，又具有<strong>格式化</strong>的功能</li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/z95ENLtRFrlDdMe.png" alt="image-20201211154300742"></p>
</li>
</ul>
<hr>
<h2 id="7数据校验">7、数据校验</h2>
<ul>
<li>
<p>只做前端校验是不安全的</p>
</li>
<li>
<p>在重要数据一定要加上后端验证</p>
</li>
</ul>
<ol>
<li><del>可以写程序将我们每一个数据取出进行校验，如果失败直接来到添加页面，提示其重新填写</del></li>
<li>SpringMVC：可以JSR303来做数据校验
<ul>
<li>JDBC：规范&mdash;》实现（各个厂商的驱动包）</li>
<li>JSR303：规范&mdash;-》Hibernate Validator（第三方校验框架）</li>
</ul>
</li>
</ol>
<hr>
<h3 id="1jsr-303">1.JSR 303</h3>
<ul>
<li>
<p><strong>JSR 303</strong> 是 Java 为 Bean 数据合法性校验提供的标准框架，它已经包含在 JavaEE 6.0 中</p>
</li>
<li>
<p>JSR 303 通过<strong>在</strong> <strong>Bean</strong> <strong>属性上标注</strong>类似于 <strong>@NotNull</strong>、<strong>@Max</strong> 等标准的注解指定校验规则，并通过标准的验证接口对 Bean 进行验证</p>
</li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/4Jkf37FI6rugxpv.png" alt="image-20201211154939287"></p>
<hr>
<h3 id="2如何快速的进行后端校验">2.如何快速的进行后端校验</h3>
<ol>
<li>
<p>导入校验框架的jar包</p>
<ul>
<li>有几个带el的jar包不导入，tomcat中有（tomcat7.0以上el表达式比较强大）；如果tomcat的版本是7.0以下将带el的几个jar包放在tomcat的lib文件夹下</li>
</ul>
<blockquote>
<p>hibernate-validator-5.0.0.CR2.jar
hibernate-validator-annotation-processor-5.0.0.CR2.jar</p>
<p>classmate-0.8.0.jar
jboss-logging-3.1.1.GA.jar
validation-api-1.1.0.CR1.jar</p>
<hr>
</blockquote>
</li>
<li>
<p>只需要给<strong>javaBean</strong>的属性添加上校验注解</p>
<p><img src="https://i.loli.net/2020/12/07/vnc4yHTaXtL3JjM.png" alt="image-20201207095302847"></p>
<hr>
</li>
<li>
<p>在SpringMVC封装对象的时候，告诉SpringMVC这个javaBean需要校验</p>
<p><code>public String addEmp(@Valid Employee employee) {</code></p>
</li>
<li>
<p>如何知道校验结果</p>
<ul>
<li>给需要校验的javaBean后面紧跟一个BindingResult。这个BindingResult就是封装前一个bean的校验结果</li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/tCYb7PldvzorXpw.png" alt="image-20201211161004089"></p>
</li>
<li>
<p>根据不同的校验结果决定怎么办</p>
<p><img src="https://i.loli.net/2020/12/11/QraRXm7eyPfbGtJ.png" alt="image-20201211161511861"></p>
<hr>
</li>
<li>
<p>来到页面使用<code>&lt;form:errors path=&quot;&quot;/&gt;</code>取出错误信息</p>
<p><img src="https://i.loli.net/2020/12/07/cPjkOoQFC9B15UA.png" alt="image-20201207110119920"></p>
<p><img src="https://i.loli.net/2020/12/11/IWYPcrZAdKhkwOf.png" alt="image-20201211161953405"></p>
</li>
</ol>
<hr>
<h3 id="3原生的表单怎么办">3.原生的表单怎么办？</h3>
<ul>
<li>
<p>将错误放在请求域中</p>
<p><img src="https://i.loli.net/2020/12/11/lEQPgGLWmVUMYo8.png" alt="image-20201211163021099"></p>
</li>
<li>
<p>用el表达式获取错误信息</p>
<p><img src="https://i.loli.net/2020/12/11/HguCLVcidleE62M.png" alt="image-20201211163209961"></p>
</li>
</ul>
<hr>
<h3 id="4国际化定制自己的错误消息显示">4.国际化定制自己的错误消息显示</h3>
<h4 id="1编写国际化的文件">1、编写国际化的文件</h4>
<ul>
<li><strong>errors_zh_CN.properties</strong></li>
<li><strong>errors_en_US.properties</strong></li>
</ul>
<p><img src="https://i.loli.net/2020/12/11/ND6RV1yTw8ZGBUs.png" alt="image-20201211163909473"></p>
<p><img src="https://i.loli.net/2020/12/11/DOuFjAPxSMQt98m.png" alt="image-20201211163949823"></p>
<hr>
<ul>
<li>==注意==
<ul>
<li>格式：key=lastname betweenn 6 and 18</li>
<li>key有规定
<ul>
<li>校验错误信息</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Field</span> <span class="n">error</span> <span class="n">in</span> <span class="n">object</span> <span class="err">&#39;</span><span class="n">employee</span><span class="err">&#39;</span> <span class="n">on</span> <span class="n">field</span> <span class="err">&#39;</span><span class="n">birth</span><span class="err">&#39;</span><span class="o">:</span> <span class="n">rejected</span> <span class="n">value</span> <span class="o">[</span><span class="n">aaA</span><span class="o">];</span> <span class="n">codes</span> <span class="o">[</span><span class="n">typeMismatch</span><span class="o">.</span><span class="na">employee</span><span class="o">.</span><span class="na">birth</span><span class="o">,</span><span class="n">typeMismatch</span><span class="o">.</span><span class="na">birth</span><span class="o">,</span><span class="n">typeMismatch</span><span class="o">.</span><span class="na">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Date</span><span class="o">,</span><span class="n">typeMismatch</span><span class="o">];</span> <span class="n">arguments</span> <span class="o">[</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">DefaultMessageSourceResolvable</span><span class="o">:</span> <span class="n">codes</span> <span class="o">[</span><span class="n">employee</span><span class="o">.</span><span class="na">birth</span><span class="o">,</span><span class="n">birth</span><span class="o">];</span> <span class="n">arguments</span> <span class="o">[];</span> <span class="k">default</span> <span class="n">message</span> <span class="o">[</span><span class="n">birth</span><span class="o">]];</span> <span class="k">default</span> <span class="n">message</span> <span class="o">[</span><span class="n">Failed</span> <span class="n">to</span> <span class="n">convert</span> <span class="n">property</span> <span class="n">value</span> <span class="n">of</span> <span class="n">type</span> <span class="err">&#39;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="err">&#39;</span> <span class="n">to</span> <span class="n">required</span> <span class="n">type</span> <span class="err">&#39;</span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Date</span><span class="err">&#39;</span> <span class="k">for</span> <span class="n">property</span> <span class="err">&#39;</span><span class="n">birth</span><span class="err">&#39;</span><span class="o">;</span> <span class="n">nested</span> <span class="n">exception</span> <span class="n">is</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">convert</span><span class="o">.</span><span class="na">ConversionFailedException</span><span class="o">:</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">convert</span> <span class="n">from</span> <span class="n">type</span> <span class="o">[</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">]</span> <span class="n">to</span> <span class="n">type</span> <span class="o">[</span><span class="nd">@org.springframework.format.annotation.DateTimeFormat</span> <span class="nd">@javax.validation.constraints.Past</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Date</span><span class="o">]</span> <span class="k">for</span> <span class="n">value</span> <span class="err">&#39;</span><span class="n">aaA</span><span class="err">&#39;</span><span class="o">;</span> <span class="n">nested</span> <span class="n">exception</span> <span class="n">is</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">IllegalArgumentException</span><span class="o">:</span> <span class="n">Parse</span> <span class="n">attempt</span> <span class="n">failed</span> <span class="k">for</span> <span class="n">value</span> <span class="o">[</span><span class="n">aaA</span><span class="o">]]</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Field</span> <span class="n">error</span> <span class="n">in</span> <span class="n">object</span> <span class="err">&#39;</span><span class="n">employee</span><span class="err">&#39;</span> <span class="n">on</span> <span class="n">field</span> <span class="err">&#39;</span><span class="n">email</span><span class="err">&#39;</span><span class="o">:</span> <span class="n">rejected</span> <span class="n">value</span> <span class="o">[</span><span class="n">a</span><span class="o">];</span> <span class="n">codes</span> <span class="o">[</span><span class="n">Email</span><span class="o">.</span><span class="na">employee</span><span class="o">.</span><span class="na">email</span><span class="o">,</span><span class="n">Email</span><span class="o">.</span><span class="na">email</span><span class="o">,</span><span class="n">Email</span><span class="o">.</span><span class="na">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">,</span><span class="n">Email</span><span class="o">];</span> <span class="n">arguments</span> <span class="o">[</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">support</span><span class="o">.</span><span class="na">DefaultMessageSourceResolvable</span><span class="o">:</span> <span class="n">codes</span> <span class="o">[</span><span class="n">employee</span><span class="o">.</span><span class="na">email</span><span class="o">,</span><span class="n">email</span><span class="o">];</span> <span class="n">arguments</span> <span class="o">[];</span> <span class="k">default</span> <span class="n">message</span> <span class="o">[</span><span class="n">email</span><span class="o">],[</span><span class="n">Ljavax</span><span class="o">.</span><span class="na">validation</span><span class="o">.</span><span class="na">constraints</span><span class="o">.</span><span class="na">Pattern$Flag</span><span class="o">;</span><span class="nd">@36575bc1</span><span class="o">,.*];</span> <span class="k">default</span> <span class="n">message</span> <span class="o">[</span><span class="n">not</span> <span class="n">a</span> <span class="n">well</span><span class="o">-</span><span class="n">formed</span> <span class="n">email</span> <span class="n">address</span><span class="o">]</span>
</code></pre></div><hr>
<p>每一个字段发生错误以后，都会有自己的错误代码；国际化文件中错误消息的key必须对应一个错误代码：</p>
<blockquote>
<hr>
<p><strong>==codes==</strong></p>
<p>​	[</p>
<p>​		Email.employee.email,		校验规则.隐含模型中这个对象的key.对象的属性</p>
<p>​		Email.email,							校验规则.属性名</p>
<p>​		Email.java.lang.String,			校验规则.属性类型</p>
<p>​		Email</p>
<p>​	];</p>
</blockquote>
<hr>
<table>
<thead>
<tr>
<th>codes</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>Email.employee.email</td>
<td>隐含模型中employee对象的email字段发生了**@Email**校验错误</td>
</tr>
<tr>
<td>Email.email</td>
<td>所有的email属性只要发生了**@Email**错误</td>
</tr>
<tr>
<td>Email.java.lang.String</td>
<td>只要是String类型发生了**@Email**错误</td>
</tr>
<tr>
<td>Email</td>
<td>只要发生了**@Email**校验错误</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="2让springmvc管理国际化资源文件">2、让SpringMVC管理国际化资源文件</h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;!--</span> <span class="n">管理国际化资源文件</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">bean</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;org.springframework.context.support.ResourceBundleMessageSource&#34;</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;basename&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;errors&#34;</span><span class="o">&gt;&lt;/</span><span class="n">property</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</code></pre></div><hr>
<h4 id="3来到页面取值">3、来到页面取值</h4>
<ul>
<li>用<code>&lt;form:errors path=&quot;&quot;/&gt;</code>（见上面<strong>快速后端校验</strong>）</li>
</ul>
<h4 id="4高级国际化">4、高级国际化</h4>
<ul>
<li>动态传入消息参数</li>
</ul>
<pre><code class="language-properties" data-lang="properties">Length.java.lang.String=length incorrect {0} {1} {2}
</code></pre><ul>
<li>
<p>{0}：永远都是当前属性名；</p>
</li>
<li>
<p>{1}、{2}：匹配注解参数</p>
</li>
</ul>
<hr>
<h3 id="5简单错误消息显示不能国际化">5.简单错误消息显示（不能国际化）</h3>
<p><img src="https://i.loli.net/2020/12/11/U31hIKC4jWPmcBG.png" alt="image-20201211171346226"></p>
<h2 id="8ajax">8、ajax</h2>
<h3 id="1springmvc快速的完成ajax功能">1.SpringMVC快速的完成ajax功能</h3>
<h4 id="1要求">1、要求</h4>
<ul>
<li>返回数据是json就🆗
<ul>
<li>页面发<code>$.ajax();</code>请求</li>
</ul>
</li>
</ul>
<hr>
<h4 id="2原生javaweb">2、原生javaWeb</h4>
<ol>
<li>导入GSON</li>
<li>返回的数据用GSON转成json</li>
<li>写出去</li>
</ol>
<hr>
<h4 id="3springmvc-ajax">3、SpringMVC-ajax</h4>
<ol>
<li>
<p>导包</p>
<blockquote>
<p>jackson-annotations-2.1.5.jar
jackson-core-2.1.5.jar
jackson-databind-2.1.5.jar</p>
</blockquote>
</li>
<li>
<p>写配置</p>
</li>
<li>
<p>测试</p>
</li>
</ol>
<hr>
<hr>
<p><strong>==文件上传下载等见源码==</strong></p>
<hr>
<h2 id="9总体架构image-20201211175931170httpsilolinet20201211jh75l6xtliaacuqpng">9、总体架构：<img src="https://i.loli.net/2020/12/11/jH75l6xTLiaACuq.png" alt="image-20201211175931170"></h2>
<hr>
<h2 id="10webxml">10、web.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&#34;</span> <span class="na">id=</span><span class="s">&#34;WebApp_ID&#34;</span> <span class="na">version=</span><span class="s">&#34;3.1&#34;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;display-name&gt;</span>7.SpringMVC_crud<span class="nt">&lt;/display-name&gt;</span>
  <span class="nt">&lt;welcome-file-list&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.html<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.htm<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>index.jsp<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>default.html<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>default.htm<span class="nt">&lt;/welcome-file&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>default.jsp<span class="nt">&lt;/welcome-file&gt;</span>
  <span class="nt">&lt;/welcome-file-list&gt;</span>
  
  <span class="c">&lt;!-- The front controller of this Spring Web application, responsible for handling all application requests --&gt;</span>
	<span class="nt">&lt;servlet&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springDispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>classpath:springmvc.xml<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
	<span class="nt">&lt;/servlet&gt;</span>

	<span class="c">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span>
	<span class="nt">&lt;servlet-mapping&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>springDispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/servlet-mapping&gt;</span>
	
	<span class="c">&lt;!-- 字符编码Filter --&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>forceRequestEncoding<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
		<span class="nt">&lt;init-param&gt;</span>
			<span class="nt">&lt;param-name&gt;</span>forceResponseEncoding<span class="nt">&lt;/param-name&gt;</span>
			<span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
		<span class="nt">&lt;/init-param&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>
	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>CharacterEncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
	
	<span class="c">&lt;!-- 支持Rest风格转换的Filter --&gt;</span>
	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="nt">&lt;/filter-class&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>
	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
	
<span class="nt">&lt;/web-app&gt;</span>
</code></pre></div><hr>
<h2 id="11springmvcxml">11、springmvc.xml</h2>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
	<span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
	<span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
	<span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd
</span><span class="s">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd&#34;</span><span class="nt">&gt;</span>

	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.lql&#34;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>
	
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/pages/&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
	<span class="c">&lt;!-- 默认前端控制器是拦截所有资源（除过jsp），js文件就404了；要js文件的请求是交给tomcat处理的
</span><span class="c">	http://localhost:8080/7.SpringMVC_crud/scripts/jquery-1.9.1.min.js --&gt;</span>
	<span class="c">&lt;!-- 告诉SpringMVC，自己映射的请求就自己处理，不能处理的请求直接交给tomcat --&gt;</span>
	<span class="c">&lt;!-- 静态资源能访问，动态映射的请求就不行 --&gt;</span>
    <span class="nt">&lt;mvc:default-servlet-handler/&gt;</span>  
	<span class="c">&lt;!-- SprigMVC可以保证动态请求和静态请求都能访问 --&gt;</span>
	
	<span class="c">&lt;!-- conversion-service=&#34;conversionService&#34;：使用我们自己配置的类型转换组件 --&gt;</span>
   <span class="nt">&lt;mvc:annotation-driven</span> <span class="na">conversion-service=</span><span class="s">&#34;conversionService&#34;</span><span class="nt">&gt;&lt;/mvc:annotation-driven&gt;</span>  
	
	<span class="c">&lt;!-- 告诉SpringMVC别用默认的ConversionService，
</span><span class="c">		而用我自定义的ConversionService，可能有我们自定义的Converter --&gt;</span>
		<span class="c">&lt;!-- 以后写自定义类型转换器的时候，就使用FormattingConversionServiceFactoryBean来注册，
</span><span class="c">		既具有类型转换还有格式化功能 --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;conversionService&#34;</span> 
	<span class="na">class=</span><span class="s">&#34;org.springframework.format.support.FormattingConversionServiceFactoryBean&#34;</span><span class="nt">&gt;</span>
		<span class="c">&lt;!-- converters转换器中添加我们自定义的类型转换器 --&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;converters&#34;</span><span class="nt">&gt;</span>
			<span class="nt">&lt;set&gt;</span>
				<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.lql.component.MyStringToEmployeeConverter&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
			<span class="nt">&lt;/set&gt;</span>
		<span class="nt">&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
	<span class="c">&lt;!-- 管理国际化资源文件 --&gt;</span>
	 <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;messageSource&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.context.support.ResourceBundleMessageSource&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;basename&#34;</span> <span class="na">value=</span><span class="s">&#34;errors&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span> 
<span class="nt">&lt;/beans&gt;</span>

</code></pre></div><hr>
<h2 id="12jsp页面">12、jsp页面</h2>
<pre><code class="language-jsp" data-lang="jsp">****************index.jsp****************************
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!-- 访问项目就要展示员工列表页面 --&gt;
&lt;jsp:forward page=&quot;/emps&quot;&gt;&lt;/jsp:forward&gt;

****************emps.jsp****************************
&lt;%@page import=&quot;java.util.Date&quot;%&gt;
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;% 
	pageContext.setAttribute(&quot;ctp&quot;, request.getContextPath());
%&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;scripts/jquery-1.9.1.min.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%=new Date() %&gt;
&lt;a href=&quot;${ctp}/getallajax&quot;&gt;ajax获取所有员工&lt;/a&gt;&lt;br&gt;
&lt;div&gt;

&lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
	$(&quot;a:first&quot;).click(function(){
		//1、发送ajax获取所有员工
		$.ajax({
			url:&quot;${ctp}/getallajax&quot;,
			type:&quot;GET&quot;,
			success:function(data){
				//console.log(data);
				$.each(data,function(){
					var empInfo = this.lastName+&quot;---&gt;&quot;+this.birth+&quot;---&gt;&quot;+this.gender;
					$(&quot;div&quot;).append(empInfo+&quot;&lt;br&gt;&quot;);
				});
			}
		});
		return false;
	});
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;

****************testOther.jsp************************
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
	pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;%
	pageContext.setAttribute(&quot;ctp&quot;, request.getContextPath());
%&gt;
&lt;/head&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;scripts/jquery-1.9.1.min.js&quot;&gt;&lt;/script&gt;
&lt;body&gt;

	&lt;form action=&quot;${ctp}/test02&quot; method=&quot;post&quot;
		enctype=&quot;multipart/form-data&quot;&gt;
		&lt;input name=&quot;username&quot; value=&quot;tomcat&quot; /&gt; &lt;input name=&quot;password&quot;
			value=&quot;123456&quot; /&gt; &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt; &lt;input
			type=&quot;submit&quot; /&gt;
	&lt;/form&gt;
	&lt;a href=&quot;${ctp}/testRequestBody&quot;&gt;ajax发送json数据&lt;/a&gt;
&lt;/body&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
	$(&quot;a:first&quot;).click(function() {
		//点击发送ajax请求，请求带的数据是json
		var emp = {
			lastName : &quot;张三&quot;,
			email : &quot;aaa@aa.com&quot;,
			gender : 0
		};
		//alert(typeof emp);
		//js对象
		var empStr = JSON.stringify(emp);
		//alert(typeof empStr);
		$.ajax({
			url : &quot;${ctp}/testRequestBody&quot;,
			type : &quot;POST&quot;,
			data : empStr,
			contentType : &quot;application/json&quot;,
			success : function(data) {
				alert(data);
			}
		});
		return false;
	});
&lt;/script&gt;
&lt;/html&gt;

****************list.jsp****************************
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;%
	pageContext.setAttribute(&quot;ctp&quot;, request.getContextPath());
%&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;员工列表页面&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;员工列表&lt;/h1&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;${ctp }/scripts/jquery-1.9.1.min.js&quot;&gt;&lt;/script&gt;
&lt;table border=&quot;1&quot; cellpadding=&quot;5&quot; cellspacing=&quot;0&quot;&gt;
	&lt;tr&gt;
		&lt;th&gt;ID&lt;/th&gt;
		&lt;th&gt;LastName&lt;/th&gt;
		&lt;th&gt;Email&lt;/th&gt;
		&lt;th&gt;Gender&lt;/th&gt;
		&lt;th&gt;Birth&lt;/th&gt;
		&lt;th&gt;Salary&lt;/th&gt;
		&lt;th&gt;Department&lt;/th&gt;
		&lt;th&gt;EDIT&lt;/th&gt;
		&lt;th&gt;DELETE&lt;/th&gt;
	&lt;/tr&gt;
	&lt;c:forEach items=&quot;${emps }&quot; var=&quot;emp&quot;&gt;
		&lt;tr&gt;
			&lt;td&gt;${emp.id}&lt;/td&gt;
			&lt;td&gt;${emp.lastName}&lt;/td&gt;
			&lt;td&gt;${emp.email}&lt;/td&gt;
			&lt;td&gt;${emp.gender==0?&quot;女&quot;:&quot;男&quot;}&lt;/td&gt;
			&lt;td&gt;${emp.birth}&lt;/td&gt;
			&lt;td&gt;${emp.salary}&lt;/td&gt;
			&lt;td&gt;${emp.department.departmentName}&lt;/td&gt;
			&lt;td&gt;
				&lt;a href=&quot;${ctp }/emp/${emp.id}&quot;&gt;edit&lt;/a&gt;
			&lt;/td&gt;
			&lt;td&gt;
				&lt;a href=&quot;${ctp }/emp/${emp.id}&quot; class=&quot;delBtn&quot;&gt;delete&lt;/a&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
	&lt;/c:forEach&gt;
	 
&lt;/table&gt;
&lt;a href=&quot;${ctp }/toaddpage&quot;&gt;添加员工&lt;/a&gt;
&lt;form action=&quot;${ctp }/quickadd&quot;&gt;
&lt;!-- 将员工的所有信息都写上，自动封装对象 --&gt;
	&lt;input name=&quot;empinfo&quot; value=&quot;empAdmin-admin@qq.com-1-101&quot;/&gt;
	&lt;input type=&quot;submit&quot; value=&quot;快速添加&quot;/&gt;
&lt;/form&gt;

	&lt;form action=&quot;${ctp }/emp/${emp.id}&quot; method=&quot;post&quot; id=&quot;deleteForm&quot;&gt;
		&lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;DELETE&quot;/&gt;
	&lt;/form&gt;
	&lt;script type=&quot;text/javascript&quot;&gt;
		$(function(){
			$(&quot;.delBtn&quot;).click(function(){
				//0、确认删除？
				if(confirm(&quot;确认要删除吗？&quot;)){
				//1、改变表单的action指向
				$(&quot;#deleteForm&quot;).attr(&quot;action&quot;,this.href);
				//2、提交表单
				$(&quot;#deleteForm&quot;).submit();
				return false;}else{
					return false;
				}
				
			});
		});
	&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;

****************add.jsp****************************
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;%@taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot; %&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;员工添加&lt;/h1&gt;
&lt;!-- 表单标签：
		通过 SpringMVC 的表单标签可以实现将模型数据中的属性和 HTML 表单元素相绑定，
		以实现表单数据更便捷编辑和表单值的回显
		1)、SpringMVC认为，表单数据中的每一项最终都是要回显的；
		path指定的是一个属性，这个属性是从隐含模型（请求域中取出的某个对象中的属性）
		path指定的每一个属性，请求域中必须有一个对象拥有这个属性；
				这个对象就是请求域中的command；
		modelAttribute=&quot;&quot;：
		1）、以前我们表单标签会从请求域中获取一个command对象；把这个对象中的每一个属性对应的显示出来
		2）、可以告诉SpringMVC不要去取command的值了，我放了一个modelAttribute指定的值，
			取对象用的key就用我modelAttribute指定的；
 --&gt;
 &lt;%
 	pageContext.setAttribute(&quot;ctp&quot;, request.getContextPath());
 %&gt;
 &lt;form:form action=&quot;${ctp }/emp&quot; modelAttribute=&quot;employee&quot; method=&quot;POST&quot;&gt;
 	&lt;!-- path就是原来html-input的name项；需要写
 		path：
 			1）、当作原生的name项
 			2）、自动回显隐含模型中某个对象对应的这个属性的值
 	 --&gt;
 	lastName:&lt;form:input path=&quot;lastName&quot;/&gt;
 		&lt;form:errors path=&quot;lastName&quot;/&gt;--&gt;${errorInfo.lastName}
 	&lt;br&gt;
 	eamil:&lt;form:input path=&quot;email&quot;/&gt;
 		&lt;form:errors path=&quot;email&quot;/&gt;--&gt;${errorInfo.email}
 	&lt;br&gt;
 	gender:&lt;br&gt;
 		男：&lt;form:radiobutton path=&quot;gender&quot; value=&quot;1&quot;/&gt;&lt;br&gt;
 		女：&lt;form:radiobutton path=&quot;gender&quot; value=&quot;0&quot;/&gt;&lt;br&gt;
 	birth:&lt;form:input path=&quot;birth&quot;/&gt;
 		&lt;form:errors path=&quot;birth&quot;/&gt;--&gt;${errorInfo.birth}
 	&lt;br/&gt;
 	salary:&lt;form:input path=&quot;salary&quot;/&gt;&lt;br/&gt;
 	dept:
 	&lt;!-- items=&quot;&quot;：指定要遍历的集合，自动遍历；遍历出的每一个元素是一个department对象
 		 itemLabel=&quot;属性名&quot;：指定遍历出的这个对象的哪个属性是作为option标签体的值
 		 itemValue=&quot;属性名&quot;：指定刚才遍历出来的这个对象的哪个属性是作为要提交的value值
 	 --&gt;
 		&lt;form:select path=&quot;department.id&quot; 
 		items=&quot;${depts}&quot; 
 		itemLabel=&quot;departmentName&quot; 
 		itemValue=&quot;id&quot;&gt;&lt;/form:select&gt;&lt;br&gt;
 	&lt;input type=&quot;submit&quot; value=&quot;保存&quot;/&gt;
 &lt;/form:form&gt;
 
&lt;!-- (Employee) --&gt;
&lt;%-- &lt;form action=&quot;&quot;&gt;
	lastName：&lt;input type=&quot;text&quot; name=&quot;lastName&quot;/&gt;&lt;br&gt;
	email：&lt;input type=&quot;text&quot; name=&quot;email&quot;/&gt;&lt;br&gt;
	gender：&lt;br&gt;
		男：&lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;1&quot;/&gt;&lt;br&gt;
		女：&lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;0&quot;/&gt;&lt;br&gt;
	dept：
		&lt;select name=&quot;department.id&quot;&gt;
			&lt;c:forEach items=&quot;${depts }&quot; var=&quot;deptItem&quot;&gt;
				&lt;!-- 标签中的是在页面 的提示选项信息，value才是真正提交的值--&gt;
				&lt;option value=&quot;${deptItem.id}&quot;&gt;${deptItem.departmentName}&lt;/option&gt;
			&lt;/c:forEach&gt;
		&lt;/select&gt;	
	&lt;input type=&quot;submit&quot; value=&quot;提交&quot;/&gt;
&lt;/form&gt; --%&gt;
&lt;/body&gt;
&lt;/html&gt;

****************edit.jsp****************************
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot; %&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;%
	pageContext.setAttribute(&quot;ctp&quot;, request.getContextPath());
%&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;员工修改页面&lt;/h1&gt;
&lt;!-- modelAttribute：这个表单的所有内容显示绑定的是绑定的是请求域中employee的值 --&gt;
&lt;form:form action=&quot;${ctp }/emp/${employee.id }&quot; 
	modelAttribute=&quot;employee&quot; method=&quot;post&quot;&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;put&quot;/&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;${employee.id }&quot;/&gt;
	email:&lt;form:input path=&quot;email&quot;/&gt;&lt;br&gt;
	gender:&amp;nbsp;&amp;nbsp;&amp;nbsp;
		男:&lt;form:radiobutton path=&quot;gender&quot; value=&quot;1&quot;/&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;
		女:&lt;form:radiobutton path=&quot;gender&quot; value=&quot;0&quot;/&gt;&lt;br&gt;
	dept:&lt;form:select path=&quot;department.id&quot; items=&quot;${depts }&quot;
			itemLabel=&quot;departmentName&quot; itemValue=&quot;id&quot;&gt;&lt;/form:select&gt;
	&lt;input type=&quot;submit&quot; value=&quot;修改&quot; /&gt;
&lt;/form:form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h2 id="13bean">13、bean</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.bean</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.Past</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.Email</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.Length</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.NotEmpty</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.format.annotation.DateTimeFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.format.annotation.NumberFormat</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnore</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
	
	<span class="nd">@NotEmpty</span><span class="o">(</span><span class="n">message</span><span class="o">=</span><span class="s">&#34;不能为空&#34;</span><span class="o">)</span>
	<span class="nd">@Length</span><span class="o">(</span><span class="n">min</span><span class="o">=</span><span class="n">6</span><span class="o">,</span><span class="n">max</span><span class="o">=</span><span class="n">18</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">lastName</span><span class="o">;</span>

	<span class="nd">@Email</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
	<span class="c1">//1 male, 0 female
</span><span class="c1"></span>	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">gender</span><span class="o">;</span>
	
	<span class="c1">//规定页面提交的日期格式
</span><span class="c1"></span>	<span class="c1">//@Past：必须是一个过去的时间
</span><span class="c1"></span>	<span class="c1">//@Future：必须是一个未来的时间
</span><span class="c1"></span>	<span class="nd">@DateTimeFormat</span><span class="o">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">&#34;yyyy-MM-dd&#34;</span><span class="o">)</span>
	<span class="nd">@Past</span>
	<span class="nd">@JsonFormat</span><span class="o">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">&#34;yyyy-MM-dd&#34;</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">Date</span> <span class="n">birth</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
	
	<span class="c1">//假设页面为了显示方便提交的工资是￥10,000.98
</span><span class="c1"></span>	<span class="nd">@NumberFormat</span><span class="o">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">&#34;#,###.##&#34;</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">Double</span> <span class="n">salary</span><span class="o">;</span>
	
	<span class="nd">@JsonIgnore</span>
	<span class="kd">private</span> <span class="n">Department</span> <span class="n">department</span><span class="o">;</span>
	
	
	
	<span class="kd">public</span> <span class="n">Double</span> <span class="nf">getSalary</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">salary</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSalary</span><span class="o">(</span><span class="n">Double</span> <span class="n">salary</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">salary</span> <span class="o">=</span> <span class="n">salary</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Date</span> <span class="nf">getBirth</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">birth</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBirth</span><span class="o">(</span><span class="n">Date</span> <span class="n">birth</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">birth</span> <span class="o">=</span> <span class="n">birth</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getLastName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">lastName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLastName</span><span class="o">(</span><span class="n">String</span> <span class="n">lastName</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmail</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">email</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getGender</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">gender</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setGender</span><span class="o">(</span><span class="n">Integer</span> <span class="n">gender</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">gender</span> <span class="o">=</span> <span class="n">gender</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="n">Department</span> <span class="nf">getDepartment</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">department</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDepartment</span><span class="o">(</span><span class="n">Department</span> <span class="n">department</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">department</span> <span class="o">=</span> <span class="n">department</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Employee</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">lastName</span><span class="o">,</span> <span class="n">String</span> <span class="n">email</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">gender</span><span class="o">,</span>
			<span class="n">Department</span> <span class="n">department</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">lastName</span> <span class="o">=</span> <span class="n">lastName</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">gender</span> <span class="o">=</span> <span class="n">gender</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">department</span> <span class="o">=</span> <span class="n">department</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nf">Employee</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="s">&#34;Employee [id=&#34;</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">&#34;, lastName=&#34;</span> <span class="o">+</span> <span class="n">lastName</span> <span class="o">+</span> <span class="s">&#34;, email=&#34;</span> <span class="o">+</span> <span class="n">email</span> <span class="o">+</span> <span class="s">&#34;, gender=&#34;</span> <span class="o">+</span> <span class="n">gender</span> <span class="o">+</span> <span class="s">&#34;, birth=&#34;</span>
				<span class="o">+</span> <span class="n">birth</span> <span class="o">+</span> <span class="s">&#34;, salary=&#34;</span> <span class="o">+</span> <span class="n">salary</span> <span class="o">+</span> <span class="s">&#34;, department=&#34;</span> <span class="o">+</span> <span class="n">department</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
<span class="o">}</span>

</code></pre></div><hr>
<h2 id="14component">14、component</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.convert.converter.Converter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.lql.bean.Employee</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.lql.dao.DepartmentDao</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * 两个泛型
</span><span class="cm"> * 
</span><span class="cm"> * S：Source
</span><span class="cm"> * T：Target
</span><span class="cm"> * 将S转为T
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> *
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyStringToEmployeeConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Employee</span><span class="o">&gt;{</span>

	<span class="nd">@Autowired</span>
	<span class="n">DepartmentDao</span> <span class="n">dapartmentDao</span><span class="o">;</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 自定义的转换规则
</span><span class="cm">	 */</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">Employee</span> <span class="nf">convert</span><span class="o">(</span><span class="n">String</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>		<span class="c1">//empAdmin-admin@qq.com-1-101
</span><span class="c1"></span>		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;页面提交的将要转换的字符串&#34;</span><span class="o">+</span><span class="n">source</span><span class="o">);</span>
		<span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">();</span>
		<span class="k">if</span><span class="o">(</span><span class="n">source</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;-&#34;</span><span class="o">)){</span>
			<span class="n">String</span><span class="o">[]</span> <span class="n">split</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&#34;-&#34;</span><span class="o">);</span>
			<span class="n">employee</span><span class="o">.</span><span class="na">setLastName</span><span class="o">(</span><span class="n">split</span><span class="o">[</span><span class="n">0</span><span class="o">]);</span>
			<span class="n">employee</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="n">split</span><span class="o">[</span><span class="n">1</span><span class="o">]);</span>
			<span class="n">employee</span><span class="o">.</span><span class="na">setGender</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">split</span><span class="o">[</span><span class="n">2</span><span class="o">]));</span>
			<span class="n">employee</span><span class="o">.</span><span class="na">setDepartment</span><span class="o">(</span><span class="n">dapartmentDao</span><span class="o">.</span><span class="na">getDepartment</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">split</span><span class="o">[</span><span class="n">3</span><span class="o">])));</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="n">employee</span><span class="o">;</span>
	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div><hr>
<h2 id="15controller">15、Controller</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.Valid</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.BindingResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.validation.FieldError</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ModelAttribute</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.lql.bean.Department</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.lql.bean.Employee</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.lql.dao.DepartmentDao</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.lql.dao.EmployeeDao</span><span class="o">;</span>


<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmployeeController</span> <span class="o">{</span>

	<span class="nd">@Autowired</span>
	<span class="n">EmployeeDao</span> <span class="n">employeeDao</span><span class="o">;</span>
	
	<span class="nd">@Autowired</span>
	<span class="n">DepartmentDao</span> <span class="n">departmentDao</span><span class="o">;</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 发送的请求是什么？
</span><span class="cm">	 * 
</span><span class="cm">	 * quickadd？empinfo=empAdmin-admin@qq.com-1-101
</span><span class="cm">	 * 
</span><span class="cm">	 * @RequestParam(&#34;empinfo&#34;)Employee employee：
</span><span class="cm">	 * 		=》Employee employee = request.getParameter(&#34;empinfo&#34;);
</span><span class="cm">	 * 
</span><span class="cm">	 * 可以通过写一个自定义类型转换器让其工作；
</span><span class="cm">	 * @param employee
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/quickadd&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">quickAdd</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;empinfo&#34;</span><span class="o">)</span><span class="n">Employee</span> <span class="n">employee</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;封装：&#34;</span><span class="o">+</span><span class="n">employee</span><span class="o">);</span>
		<span class="n">employeeDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">employee</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;redirect:/emps&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 查询所有员工
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/emps&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmps</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">all</span> <span class="o">=</span> <span class="n">employeeDao</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;emps&#34;</span><span class="o">,</span> <span class="n">all</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;list&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/emp/{id}&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">deleteEmp</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span><span class="n">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">employeeDao</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;redirect:/emps&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 查询员工，来到修改页面回显
</span><span class="cm">	 * @param id
</span><span class="cm">	 * @param model
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/emp/{id}&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmp</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">//1、查出员工信息
</span><span class="c1"></span>		<span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">employeeDao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
		<span class="c1">//2、放在请求域中
</span><span class="c1"></span>		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;employee&#34;</span><span class="o">,</span><span class="n">employee</span><span class="o">);</span>
		<span class="c1">//3、继续查出部门信息放在隐含模型中
</span><span class="c1"></span>		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Department</span><span class="o">&gt;</span> <span class="n">departments</span> <span class="o">=</span> <span class="n">departmentDao</span><span class="o">.</span><span class="na">getDepartments</span><span class="o">();</span>
		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;depts&#34;</span><span class="o">,</span> <span class="n">departments</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;edit&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="c1">//@ModelAttribute(&#34;employee&#34;)
</span><span class="c1"></span>	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/emp/{id}&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">PUT</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">updateEmp</span><span class="o">(</span><span class="n">Employee</span> <span class="n">employee</span><span class="cm">/*,@PathVariable(&#34;id&#34;)Integer id*/</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;要修改的员工：&#34;</span><span class="o">+</span><span class="n">employee</span><span class="o">);</span>
		<span class="c1">// xxxx更新修改二合一
</span><span class="c1"></span>		<span class="c1">//employeeDao.save(employee);
</span><span class="c1"></span>		<span class="k">return</span> <span class="s">&#34;redirect:/emps&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	
	<span class="nd">@ModelAttribute</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">myModelAttribute</span><span class="o">(</span>
			<span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;id&#34;</span><span class="o">,</span><span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span><span class="n">Integer</span> <span class="n">id</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
		<span class="k">if</span><span class="o">(</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
			<span class="n">Employee</span> <span class="n">employee</span> <span class="o">=</span> <span class="n">employeeDao</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
			<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;employee&#34;</span><span class="o">,</span> <span class="n">employee</span><span class="o">);</span>
		<span class="o">}</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;hahaha&#34;</span><span class="o">);</span>
		<span class="c1">//1、先查出所有部门
</span><span class="c1"></span>		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Department</span><span class="o">&gt;</span> <span class="n">departments</span> <span class="o">=</span> <span class="n">departmentDao</span><span class="o">.</span><span class="na">getDepartments</span><span class="o">();</span>
		<span class="c1">//2、放在请求域中
</span><span class="c1"></span>		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;depts&#34;</span><span class="o">,</span><span class="n">departments</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 保存员工
</span><span class="cm">	 * @param employee
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;/emp&#34;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">addEmp</span><span class="o">(</span><span class="nd">@Valid</span> <span class="n">Employee</span> <span class="n">employee</span><span class="o">,</span><span class="n">BindingResult</span> <span class="n">result</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;要添加的员工：&#34;</span><span class="o">+</span><span class="n">employee</span><span class="o">);</span>
		<span class="c1">//获取是否有校验错误
</span><span class="c1"></span>		<span class="kt">boolean</span> <span class="n">hasErrors</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">();</span>
		<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">errorsMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;();</span>
		<span class="k">if</span><span class="o">(</span><span class="n">hasErrors</span><span class="o">){</span>
			<span class="n">List</span><span class="o">&lt;</span><span class="n">FieldError</span><span class="o">&gt;</span> <span class="n">fieldErrors</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getFieldErrors</span><span class="o">();</span>
			<span class="k">for</span><span class="o">(</span><span class="n">FieldError</span> <span class="n">errors</span> <span class="o">:</span> <span class="n">fieldErrors</span><span class="o">){</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;错误消息提示：&#34;</span><span class="o">+</span><span class="n">errors</span><span class="o">.</span><span class="na">getDefaultMessage</span><span class="o">());</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;错误的字段是：&#34;</span><span class="o">+</span><span class="n">errors</span><span class="o">.</span><span class="na">getField</span><span class="o">());</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">errors</span><span class="o">);</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;-----------------&#34;</span><span class="o">);</span>
				<span class="n">errorsMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">getField</span><span class="o">(),</span> <span class="n">errors</span><span class="o">.</span><span class="na">getDefaultMessage</span><span class="o">());</span>
			<span class="o">}</span>
			<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;errorInfo&#34;</span><span class="o">,</span><span class="n">errorsMap</span><span class="o">);</span>
			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;有校验错误&#34;</span><span class="o">);</span>
			<span class="k">return</span> <span class="s">&#34;add&#34;</span><span class="o">;</span>
		<span class="o">}</span><span class="k">else</span> <span class="o">{</span>
			<span class="n">employeeDao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">employee</span><span class="o">);</span>
			<span class="c1">//返回列表页面;重定向到查询所有员工的请求
</span><span class="c1"></span>			<span class="k">return</span> <span class="s">&#34;redirect:/emps&#34;</span><span class="o">;</span>
		<span class="o">}</span>
		
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 去员工添加页面，去页面之前需要查出所有部门信息，进行展示的
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/toaddpage&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toAddPage</span><span class="o">(</span><span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
		<span class="cm">/*//1、先查出所有部门
</span><span class="cm">		Collection&lt;Department&gt; departments = departmentDao.getDepartments();
</span><span class="cm">		//2、放在请求域中
</span><span class="cm">		model.addAttribute(&#34;depts&#34;,departments);*/</span>
		<span class="c1">//model.addAttribute(&#34;command&#34;,new Employee(null, &#34;张三&#34;, &#34;haha@gmail.com&#34;, 0, departmentDao.getDepartment(102)));
</span><span class="c1"></span>		<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;employee&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">Employee</span><span class="o">());</span>
		<span class="c1">//3、去添加页面
</span><span class="c1"></span>		<span class="k">return</span> <span class="s">&#34;add&#34;</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>


<span class="o">=====================================================</span>
<span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpHeaders</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.MultiValueMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestBody</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.lql.bean.Employee</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.lql.dao.EmployeeDao</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AjaxTestController</span> <span class="o">{</span>

	
	<span class="nd">@Autowired</span>
	<span class="n">EmployeeDao</span> <span class="n">employeeDao</span><span class="o">;</span>
	
	<span class="cm">/**
</span><span class="cm">	 * SpringMVC文件下载
</span><span class="cm">	 * @param request
</span><span class="cm">	 * @return
</span><span class="cm">	 * @throws Exception
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/download&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="nf">download</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
		<span class="c1">//1、得到要下载的文件的流；
</span><span class="c1"></span>		<span class="c1">//找到要下载的文件的真实路径
</span><span class="c1"></span>		<span class="n">ServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
		<span class="n">String</span> <span class="n">realPath</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">&#34;/scripts/jquery-1.9.1.min.js&#34;</span><span class="o">);</span>
		<span class="n">FileInputStream</span> <span class="n">fileInputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">realPath</span><span class="o">);</span>
		<span class="kt">byte</span><span class="o">[]</span> <span class="n">tmp</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">fileInputStream</span><span class="o">.</span><span class="na">available</span><span class="o">()];</span>
		<span class="n">fileInputStream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">tmp</span><span class="o">);</span>
		<span class="n">fileInputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		
		<span class="c1">//2、将要下载的文件流返回
</span><span class="c1"></span>		<span class="n">HttpHeaders</span> <span class="n">httpHeaders</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpHeaders</span><span class="o">();</span>
		<span class="n">httpHeaders</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;Content-Disposition&#34;</span><span class="o">,</span> <span class="s">&#34;attachment;filename=&#34;</span><span class="o">+</span><span class="s">&#34;jquery-1.9.1.min.js&#34;</span><span class="o">);</span>
		
		
		<span class="k">return</span> <span class="k">new</span> <span class="n">ResponseEntity</span><span class="o">&lt;&gt;(</span><span class="n">tmp</span><span class="o">,</span> <span class="n">httpHeaders</span><span class="o">,</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * @ResponseBody:
</span><span class="cm">	 * 将返回数据放在响应体中
</span><span class="cm">	 * 
</span><span class="cm">	 * ResponseEntity&lt;String&gt;:响应体中内容的类型
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="c1">//@ResponseBody
</span><span class="c1"></span>	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/haha&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">hahah</span><span class="o">(){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;hahaha....&#34;</span><span class="o">);</span>
		<span class="n">HttpStatus</span> <span class="n">statusCode</span><span class="o">;</span>
		<span class="n">MultiValueMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpHeaders</span><span class="o">();</span>
		<span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="s">&#34;&lt;h1&gt;success&lt;/h1&gt;&#34;</span><span class="o">;</span>
		
		<span class="n">headers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;Set-Cookie&#34;</span><span class="o">,</span> <span class="s">&#34;username=hahahaha&#34;</span><span class="o">);</span>
		
		<span class="k">return</span> <span class="k">new</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">body</span><span class="o">,</span> <span class="n">headers</span><span class="o">,</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 如果参数位置写HttpEntity&lt;String&gt; str;
</span><span class="cm">	 * 比@RequestBody更强，可以拿到请求头；
</span><span class="cm">	 * 	@RequestHeader(&#34;&#34;)
</span><span class="cm">	 * 
</span><span class="cm">	 * @param str
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test02&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">test02</span><span class="o">(</span><span class="n">HttpEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">str</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test01&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">test01</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="n">String</span> <span class="n">str</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;请求体：&#34;</span><span class="o">+</span><span class="n">str</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * @RequestBody:请求体，获取一个请求的请求体
</span><span class="cm">	 * @RequestParam:
</span><span class="cm">	 * 
</span><span class="cm">	 * @Responsebody：可以把对象转为json数据，返回给浏览器
</span><span class="cm">	 * 
</span><span class="cm">	 * @RequsetBody：接收json数据，封装为对象
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/testRequestBody&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">testRequestBody</span><span class="o">(</span><span class="nd">@RequestBody</span><span class="o">(</span><span class="n">required</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span> <span class="n">Employee</span> <span class="n">employee</span><span class="o">){</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;请求体：&#34;</span><span class="o">+</span><span class="n">employee</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">&#34;success&#34;</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="cm">/**
</span><span class="cm">	 * @ResponseBody:
</span><span class="cm">	 * 将返回的数据放在响应体中；
</span><span class="cm">	 * 如果是对象，jackson自动将对象转为json格式
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@ResponseBody</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/getallajax&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="nf">ajaxGetAll</span><span class="o">(){</span>
		<span class="n">Collection</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">all</span> <span class="o">=</span> <span class="n">employeeDao</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
		<span class="k">return</span> <span class="n">all</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div><hr>
<h2 id="16文件上传">16、文件上传</h2>
<h3 id="1indexjsp">1.index.jsp</h3>
<pre><code class="language-jsp" data-lang="jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
    pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;
&lt;title&gt;Insert title here&lt;/title&gt;
&lt;%
pageContext.setAttribute(&quot;ctp&quot;, request.getContextPath());
%&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;!-- 
1)、文件上传：
	1、文件上传表单准备：enctype=&quot;multipart/form-data&quot;
	2、导入fileupload：
		commons-fileupload-1.4.jar
		commons-io-2.8.0.jar
	3、javaWeb：
		object = new FileItemDiskFactory();
		ServletFileUpload upload = new ServletFileUpload(object);

		upload&lt;FileItem&gt; items = upload.parseRequest(upload);
		for(FileItem item:items){
			if(item.isField()){
				//普通项
			}else{
				//文件项
				IOUtils.copy();//文件保存
			}
		}
	3、只需要在SpringMVC配置文件中，编写一个配置，配置文件上传解析器（MultipartResolver）；
	4、文件上传请求处理
		在处理器方法上写一个
			@RequestParam(&quot;headerimg&quot;)MultipartFile file,封装当前文件的信息，可以直接保存
 --&gt;
 ${msg }
 &lt;form action=&quot;${ctp}/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
 	用户头像：&lt;input type=&quot;file&quot; name=&quot;headerimg&quot;/&gt;&lt;br&gt;
 	用户头像：&lt;input type=&quot;file&quot; name=&quot;headerimg&quot;/&gt;&lt;br&gt;
 	用户头像：&lt;input type=&quot;file&quot; name=&quot;headerimg&quot;/&gt;&lt;br&gt;
 	用户头像：&lt;input type=&quot;file&quot; name=&quot;headerimg&quot;/&gt;&lt;br&gt;
 	用户名：&lt;input type=&quot;text&quot; name=&quot;username&quot;/&gt;&lt;br&gt;
 	&lt;input type=&quot;submit&quot;/&gt; &lt;/form&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;


&lt;a href=&quot;${ctp}/hello&quot;&gt;hello&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><hr>
<h3 id="2springmvcxml">2.springmvc.xml</h3>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&#34;http://www.springframework.org/schema/beans&#34;</span>
	<span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
	<span class="na">xmlns:context=</span><span class="s">&#34;http://www.springframework.org/schema/context&#34;</span>
	<span class="na">xmlns:mvc=</span><span class="s">&#34;http://www.springframework.org/schema/mvc&#34;</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd
</span><span class="s">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
</span><span class="s">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd&#34;</span><span class="nt">&gt;</span>

	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.lql&#34;</span><span class="nt">&gt;&lt;/context:component-scan&gt;</span>
	
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;prefix&#34;</span> <span class="na">value=</span><span class="s">&#34;/WEB-INF/pages/&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;suffix&#34;</span> <span class="na">value=</span><span class="s">&#34;.jsp&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
	<span class="nt">&lt;mvc:default-servlet-handler/&gt;</span>
	<span class="nt">&lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt;</span>

	<span class="c">&lt;!-- 配置文件上传解析器；id必须是multipartResolver --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;multipartResolver&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.multipart.commons.CommonsMultipartResolver&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;maxUploadSize&#34;</span> <span class="na">value=</span><span class="s">&#34;#{1024*1024*20}&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="c">&lt;!-- 设置默认的编码 --&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;defaultEncoding&#34;</span> <span class="na">value=</span><span class="s">&#34;utf-8&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
<span class="nt">&lt;/beans&gt;</span>

</code></pre></div><hr>
<h3 id="3uploadcontroller">3.UploadController</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.multipart.MultipartFile</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UploadController</span> <span class="o">{</span>
	
	<span class="cm">/**
</span><span class="cm">	 * 测试多文件上传
</span><span class="cm">	 * @param username
</span><span class="cm">	 * @param file
</span><span class="cm">	 * @param model
</span><span class="cm">	 * @return
</span><span class="cm">	 */</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/upload&#34;</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">upload</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;username&#34;</span><span class="o">,</span><span class="n">required</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span>
			<span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&#34;headerimg&#34;</span><span class="o">)</span><span class="n">MultipartFile</span><span class="o">[]</span> <span class="n">file</span><span class="o">,</span>
			<span class="n">Model</span> <span class="n">model</span><span class="o">){</span>
		
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;上传的文件的信息&#34;</span><span class="o">);</span>
		<span class="k">for</span><span class="o">(</span><span class="n">MultipartFile</span> <span class="n">multipartFile</span> <span class="o">:</span> <span class="n">file</span><span class="o">){</span>
			<span class="k">if</span><span class="o">(!</span><span class="n">multipartFile</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()){</span>
				<span class="c1">//文件保存
</span><span class="c1"></span>				<span class="k">try</span> <span class="o">{</span>
					<span class="n">multipartFile</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;E:\\upload\\&#34;</span><span class="o">+</span><span class="n">multipartFile</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">()));</span>
					<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span><span class="s">&#34;文件上传成功了！&#34;</span><span class="o">);</span>
				<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;msg&#34;</span><span class="o">,</span><span class="s">&#34;文件上传失败了！&#34;</span><span class="o">+</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
					<span class="o">}</span>
				
		<span class="o">}</span>
		
	<span class="o">}</span><span class="k">return</span> <span class="s">&#34;forward:/index.jsp&#34;</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="cm">/*@RequestMapping(&#34;/upload&#34;)
</span><span class="cm">	public String upload(@RequestParam(value=&#34;username&#34;,required=false)String username,
</span><span class="cm">			@RequestParam(&#34;headerimg&#34;)MultipartFile file,
</span><span class="cm">			Model model){
</span><span class="cm">		
</span><span class="cm">		System.out.println(&#34;上传的文件的信息&#34;);
</span><span class="cm">		System.out.println(&#34;文件项name：&#34;+file.getName());
</span><span class="cm">		System.out.println(&#34;文件的名字：&#34;+file.getOriginalFilename());
</span><span class="cm">		
</span><span class="cm">		//文件保存
</span><span class="cm">		try {
</span><span class="cm">			file.transferTo(new File(&#34;E:\\upload\\&#34;+file.getOriginalFilename()));
</span><span class="cm">			model.addAttribute(&#34;msg&#34;,&#34;文件上传成功了！&#34;);
</span><span class="cm">		} catch (Exception e) {
</span><span class="cm">			model.addAttribute(&#34;msg&#34;,&#34;文件上传失败了！&#34;+e.getMessage());
</span><span class="cm">		}
</span><span class="cm">		return &#34;forward:/index.jsp&#34;;
</span><span class="cm">	}*/</span>
<span class="o">}</span>

</code></pre></div><hr>
<hr>
<h1 id="十拦截器">十、拦截器</h1>
<h2 id="1介绍">1、介绍</h2>
<ul>
<li>SpringMVC提供了拦截器机制，允许运行目标方法之前进行一些拦截工作，或者目标方法运行之后进行一些其他处理</li>
<li><strong>Filter</strong>（javaWeb）</li>
<li><strong>HandlerInterceptor</strong>（SpringMVC）</li>
</ul>
<p><img src="https://i.loli.net/2020/12/08/iG8empvbERTfD2C.png" alt="image-20201208103751732"></p>
<hr>
<table>
<thead>
<tr>
<th>方法</th>
<th>时机</th>
</tr>
</thead>
<tbody>
<tr>
<td>preHandle</td>
<td>在目标方法之前调用，返回Boolean【return true：（chain.doFilter()）放行；return false：不放行】</td>
</tr>
<tr>
<td>postHandle</td>
<td>在目标方法运行之后调用（目标方法调用之后）</td>
</tr>
<tr>
<td>afterCompletion</td>
<td>在请求整个完成之后（来到目标页面之后）（chain.doFilter()放行）（资源响应之后）</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="2设置拦截器">2、设置拦截器</h2>
<ol>
<li>
<p>实现<strong>HandlerInterceptor</strong>接口（手动实现接口方法）</p>
<p><img src="https://i.loli.net/2020/12/11/OQchz1umg3tApqB.png" alt="Snipaste_2020-12-11_22-57-36"></p>
</li>
<li>
<p>配置拦截器</p>
<p><img src="https://i.loli.net/2020/12/11/9Is5O81KXn6BMlQ.png" alt="image-20201211230249249"></p>
</li>
</ol>
<hr>
<h2 id="3拦截器的运行流程">3、拦截器的运行流程</h2>
<h4 id="1单个拦截器">1.单个拦截器</h4>
<ul>
<li><strong>正常运行流程：</strong></li>
</ul>
<p>拦截器的preHandle&mdash;-》目标方法&mdash;-》拦截器postHandle&mdash;-》页面&mdash;-》拦截器的afterCompletion</p>
<ul>
<li>运行结果</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">MyFirstInterceptor</span><span class="o">...</span><span class="na">preHandle</span><span class="o">...</span>
<span class="n">test01</span><span class="o">....</span>
<span class="n">MyFirstInterceptor</span><span class="o">...</span><span class="na">postHandle</span><span class="o">...</span>
<span class="n">success</span><span class="o">.</span><span class="na">jsp</span><span class="o">....</span>
<span class="n">MyFirstInterceptor</span><span class="o">...</span><span class="na">afterCompletion</span>
</code></pre></div><ul>
<li><strong>其他流程：</strong>
<ul>
<li>只要<strong>preHandle</strong>不放行就没有以后的流程</li>
<li>只要放行了，<strong>afterCompletion</strong>都会执行</li>
</ul>
</li>
</ul>
<hr>
<h4 id="2多个拦截器">2.多个拦截器:</h4>
<ul>
<li><strong>正常流程：</strong></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">MyFirstInterceptor</span><span class="o">...</span><span class="na">preHandle</span><span class="o">...</span>
<span class="n">MySecondInterceptor</span><span class="o">...</span><span class="na">preHandle</span><span class="o">...</span>
<span class="n">test01</span><span class="o">....</span>
<span class="n">MySecondInterceptor</span><span class="o">...</span><span class="na">postHandle</span><span class="o">...</span>
<span class="n">MyFirstInterceptor</span><span class="o">...</span><span class="na">postHandle</span><span class="o">...</span>
<span class="n">success</span><span class="o">.</span><span class="na">jsp</span><span class="o">....</span>
<span class="n">MySecondInterceptor</span><span class="o">...</span><span class="na">afterCompletion</span>
<span class="n">MyFirstInterceptor</span><span class="o">...</span><span class="na">afterCompletion</span>
</code></pre></div><ul>
<li><strong>异常流程(不放行)</strong>
<ul>
<li>哪一块不放行从此以后都没有</li>
<li>==<strong>已经放行了的拦截器afterCompletion总会执行</strong>==</li>
</ul>
</li>
<li>例如：MySecondInterceptor不放行</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">MyFirstInterceptor</span><span class="o">...</span><span class="na">preHandle</span><span class="o">...</span>
<span class="n">MySecondInterceptor</span><span class="o">...</span><span class="na">preHandle</span><span class="o">...</span>
<span class="n">MyFirstInterceptor</span><span class="o">...</span><span class="na">afterCompletion</span>
</code></pre></div><hr>
<h4 id="3执行次序">3.执行次序</h4>
<table>
<thead>
<tr>
<th>拦截器</th>
<th>执行流程</th>
</tr>
</thead>
<tbody>
<tr>
<td>preHandle</td>
<td>顺序执行</td>
</tr>
<tr>
<td>postHandle</td>
<td>逆序执行</td>
</tr>
<tr>
<td>afterCompletion</td>
<td>逆序执行</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="4源码">4、源码</h2>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="k">try</span> <span class="o">{</span>
    <span class="n">ModelAndView</span> <span class="n">mv</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="n">Exception</span> <span class="n">dispatchException</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">processedRequest</span> <span class="o">=</span> <span class="n">checkMultipart</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="n">multipartRequestParsed</span> <span class="o">=</span> <span class="o">(</span><span class="n">processedRequest</span> <span class="o">!=</span> <span class="n">request</span><span class="o">);</span>

        <span class="c1">// Determine handler for the current request.拿到方法的执行链，包含拦截器
</span><span class="c1"></span>        <span class="n">mappedHandler</span> <span class="o">=</span> <span class="n">getHandler</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">noHandlerFound</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// Determine handler adapter for the current request.
</span><span class="c1"></span>        <span class="n">HandlerAdapter</span> <span class="n">ha</span> <span class="o">=</span> <span class="n">getHandlerAdapter</span><span class="o">(</span><span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>

        <span class="c1">// Process last-modified header, if supported by the handler.
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">isGet</span> <span class="o">=</span> <span class="s">&#34;GET&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isGet</span> <span class="o">||</span> <span class="s">&#34;HEAD&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">method</span><span class="o">))</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">lastModified</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="na">getLastModified</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">new</span> <span class="n">ServletWebRequest</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">).</span><span class="na">checkNotModified</span><span class="o">(</span><span class="n">lastModified</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">isGet</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
		
        <span class="c1">//拦截器preHandle执行位置；有一个拦截器返回false目标方法都不会执行；直接跳到afterCompletion
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyPreHandle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// Actually invoke the handler.适配器执行目标方法
</span><span class="c1"></span>        <span class="n">mv</span> <span class="o">=</span> <span class="n">ha</span><span class="o">.</span><span class="na">handle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">());</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">asyncManager</span><span class="o">.</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">applyDefaultViewName</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span>
        <span class="c1">//目标方法只要正常，就会走到postHandle；任何期间有异常
</span><span class="c1"></span>        <span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyPostHandle</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">dispatchException</span> <span class="o">=</span> <span class="n">ex</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">err</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// As of 4.3, we&#39;re processing Errors thrown from handler methods as well,
</span><span class="c1"></span>        <span class="c1">// making them available for @ExceptionHandler methods and other scenarios.
</span><span class="c1"></span>        <span class="n">dispatchException</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NestedServletException</span><span class="o">(</span><span class="s">&#34;Handler dispatch failed&#34;</span><span class="o">,</span> <span class="n">err</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">//页面渲染；如果完蛋也是直接跳到afterCompletion；
</span><span class="c1"></span>    <span class="n">processDispatchResult</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="n">mv</span><span class="o">,</span> <span class="n">dispatchException</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">triggerAfterCompletion</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">err</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">triggerAfterCompletion</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">mappedHandler</span><span class="o">,</span>
                           <span class="k">new</span> <span class="n">NestedServletException</span><span class="o">(</span><span class="s">&#34;Handler processing failed&#34;</span><span class="o">,</span> <span class="n">err</span><span class="o">));</span>
<span class="o">}</span>
<span class="k">finally</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">asyncManager</span><span class="o">.</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">// Instead of postHandle and afterCompletion
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">mappedHandler</span><span class="o">.</span><span class="na">applyAfterConcurrentHandlingStarted</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// Clean up any resources used by a multipart request.
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">multipartRequestParsed</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">cleanupMultipart</span><span class="o">(</span><span class="n">processedRequest</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="o">}</span>
</code></pre></div><hr>
<h3 id="1prehandler">1.preHandler</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">boolean</span> <span class="nf">applyPreHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
		<span class="n">HandlerInterceptor</span><span class="o">[]</span> <span class="n">interceptors</span> <span class="o">=</span> <span class="n">getInterceptors</span><span class="o">();</span>
		<span class="k">if</span> <span class="o">(!</span><span class="n">ObjectUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">interceptors</span><span class="o">))</span> <span class="o">{</span>
			<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">interceptors</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
				<span class="n">HandlerInterceptor</span> <span class="n">interceptor</span> <span class="o">=</span> <span class="n">interceptors</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="c1">//preHandle - true - false
</span><span class="c1"></span>				<span class="k">if</span> <span class="o">(!</span><span class="n">interceptor</span><span class="o">.</span><span class="na">preHandle</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">handler</span><span class="o">))</span> <span class="o">{</span>
					<span class="c1">//执行完afterCompletion();
</span><span class="c1"></span>                    <span class="n">triggerAfterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
					<span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
				<span class="o">}</span>
                <span class="c1">//记录一下索引
</span><span class="c1"></span>				<span class="k">this</span><span class="o">.</span><span class="na">interceptorIndex</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
	<span class="o">}</span>
</code></pre></div><hr>
<h3 id="2posthandle">2.postHandle</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">applyPostHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">ModelAndView</span> <span class="n">mv</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

		<span class="n">HandlerInterceptor</span><span class="o">[]</span> <span class="n">interceptors</span> <span class="o">=</span> <span class="n">getInterceptors</span><span class="o">();</span>
		<span class="k">if</span> <span class="o">(!</span><span class="n">ObjectUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">interceptors</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">//逆序执行每个拦截器的postHandle
</span><span class="c1"></span>			<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">interceptors</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
				<span class="n">HandlerInterceptor</span> <span class="n">interceptor</span> <span class="o">=</span> <span class="n">interceptors</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
				<span class="n">interceptor</span><span class="o">.</span><span class="na">postHandle</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">handler</span><span class="o">,</span> <span class="n">mv</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div><hr>
<h3 id="3页面渲染逻辑">3.页面渲染逻辑</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">processDispatchResult</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
			<span class="nd">@Nullable</span> <span class="n">HandlerExecutionChain</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">ModelAndView</span> <span class="n">mv</span><span class="o">,</span>
			<span class="nd">@Nullable</span> <span class="n">Exception</span> <span class="n">exception</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

		<span class="kt">boolean</span> <span class="n">errorView</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="n">ModelAndViewDefiningException</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;ModelAndViewDefiningException encountered&#34;</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
				<span class="n">mv</span> <span class="o">=</span> <span class="o">((</span><span class="n">ModelAndViewDefiningException</span><span class="o">)</span> <span class="n">exception</span><span class="o">).</span><span class="na">getModelAndView</span><span class="o">();</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>
				<span class="n">Object</span> <span class="n">handler</span> <span class="o">=</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">()</span> <span class="o">:</span> <span class="kc">null</span><span class="o">);</span>
				<span class="n">mv</span> <span class="o">=</span> <span class="n">processHandlerException</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
				<span class="n">errorView</span> <span class="o">=</span> <span class="o">(</span><span class="n">mv</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="c1">// Did the handler return a view to render?
</span><span class="c1"></span>		<span class="k">if</span> <span class="o">(</span><span class="n">mv</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mv</span><span class="o">.</span><span class="na">wasCleared</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">//页面渲染
</span><span class="c1"></span>			<span class="n">render</span><span class="o">(</span><span class="n">mv</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">errorView</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">WebUtils</span><span class="o">.</span><span class="na">clearErrorRequestAttributes</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;No view rendering, null ModelAndView returned.&#34;</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">WebAsyncUtils</span><span class="o">.</span><span class="na">getAsyncManager</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
			<span class="c1">// Concurrent handling started during a forward
</span><span class="c1"></span>			<span class="k">return</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// Exception (if any) is already handled..
</span><span class="c1"></span>            <span class="c1">//页面正常执行afterCompletion；即使没走到这，afterCompletion总会执行
</span><span class="c1"></span>			<span class="n">mappedHandler</span><span class="o">.</span><span class="na">triggerAfterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div><hr>
<h3 id="4aftercompletion">4.afterCompletion</h3>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">triggerAfterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

		<span class="n">HandlerInterceptor</span><span class="o">[]</span> <span class="n">interceptors</span> <span class="o">=</span> <span class="n">getInterceptors</span><span class="o">();</span>
		<span class="k">if</span> <span class="o">(!</span><span class="n">ObjectUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">interceptors</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">//有记录最后一个放行拦截器的索引（interceptorIndex），从他开始把之前所有的拦截器的afterCompletion都执行
</span><span class="c1"></span>			<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">interceptorIndex</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
				<span class="n">HandlerInterceptor</span> <span class="n">interceptor</span> <span class="o">=</span> <span class="n">interceptors</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
				<span class="k">try</span> <span class="o">{</span>
					<span class="n">interceptor</span><span class="o">.</span><span class="na">afterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">handler</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
				<span class="o">}</span>
				<span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">ex2</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;HandlerInterceptor.afterCompletion threw exception&#34;</span><span class="o">,</span> <span class="n">ex2</span><span class="o">);</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div><h2 id="5流程总结图">5、流程总结图</h2>
<p><img src="https://i.loli.net/2020/12/08/ufqejIRHb9S67gW.png" alt="image-20201208143436727"></p>
<hr>
<h2 id="6filter和拦截器使用时机">6、Filter和拦截器使用时机</h2>
<ul>
<li>
<p><strong>如果某些功能需要其他组件配合完成，我们就用拦截器</strong></p>
</li>
<li>
<p><strong>其它情况可以写filter</strong></p>
</li>
</ul>
<h1 id="十一国际化">十一、国际化</h1>
<h2 id="1简单国际化">1、简单国际化</h2>
<h3 id="1写好国际化资源文件">1.写好国际化资源文件</h3>
<ul>
<li>
<p><strong>login_en_US.properties</strong></p>
<pre><code class="language-properties" data-lang="properties">welcominfo=welcome to lql.com
username=USERNAME
password=PASSWORD
loginBtn=LOGIN
</code></pre></li>
<li>
<p><strong>login_zh_CN.properties</strong></p>
<pre><code class="language-properties" data-lang="properties">welcominfo=\u6B22\u8FCE\u6765\u5230\u4EE3\u7801\u4E16\u754C
username=\u7528\u6237\u540D
password=\u5BC6\u7801
loginBtn=\u767B\u5F55
</code></pre></li>
</ul>
<hr>
<h3 id="2让spring的resourcebundlemessagesource管理国际化资源文件">2.让Spring的ResourceBundleMessageSource管理国际化资源文件</h3>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;messageSource&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.context.support.ResourceBundleMessageSource&#34;</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;basename&#34;</span> <span class="na">value=</span><span class="s">&#34;loginpro/login&#34;</span><span class="nt">&gt;&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div><hr>
<h3 id="3直接去页面取值">3.直接去页面取值</h3>
<p><img src="https://i.loli.net/2020/12/11/3qGFYbraCMnBK69.png" alt="image-20201211235516880"></p>
<hr>
<h2 id="2页面显示现象">2、页面显示现象</h2>
<ul>
<li>是按照浏览器带来语言信息决定</li>
</ul>
<h2 id="3javaweb获取浏览器区域信息">3、javaWeb获取浏览器区域信息</h2>
<ul>
<li><code>Locale locale = Request.getLocale();</code></li>
</ul>
<h2 id="4springmvc区域信息">4、SpringMVC区域信息</h2>
<ul>
<li>由<strong>区域信息解析器</strong>得到
<ul>
<li><code>private LocaleResolver localeResolver;</code></li>
</ul>
</li>
<li>默认会用一个 <code>AcceptHeaderLocaleResolver</code>
<ul>
<li>所有用到区域信息的地方，都是用<code>AcceptHeaderLocaleResolver</code>获取的</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Locale</span> <span class="n">locale</span> <span class="o">=</span>
				<span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">localeResolver</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="k">this</span><span class="o">.</span><span class="na">localeResolver</span><span class="o">.</span><span class="na">resolveLocale</span><span class="o">(</span><span class="n">request</span><span class="o">)</span> <span class="o">:</span> <span class="n">request</span><span class="o">.</span><span class="na">getLocale</span><span class="o">());</span>
</code></pre></div><hr>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Locale</span> <span class="nf">resolveLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Locale</span> <span class="n">defaultLocale</span> <span class="o">=</span> <span class="n">getDefaultLocale</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">defaultLocale</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">&#34;Accept-Language&#34;</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">defaultLocale</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Locale</span> <span class="n">requestLocale</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getLocale</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Locale</span><span class="o">&gt;</span> <span class="n">supportedLocales</span> <span class="o">=</span> <span class="n">getSupportedLocales</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">supportedLocales</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">||</span> <span class="n">supportedLocales</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">requestLocale</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">requestLocale</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Locale</span> <span class="n">supportedLocale</span> <span class="o">=</span> <span class="n">findSupportedLocale</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">supportedLocales</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">supportedLocale</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">supportedLocale</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">defaultLocale</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">defaultLocale</span> <span class="o">:</span> <span class="n">requestLocale</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><hr>
<h2 id="5区域信息解析器">5、区域信息解析器</h2>
<hr>
<p><img src="https://i.loli.net/2020/12/08/ZczAHMRQgwCSFqx.png" alt="image-20201208163903202"></p>
<hr>
<h3 id="1acceptheaderlocaleresolver">1.AcceptHeaderLocaleResolver</h3>
<ul>
<li>使用请求头中的信息</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Locale</span> <span class="nf">resolveLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Locale</span> <span class="n">defaultLocale</span> <span class="o">=</span> <span class="n">getDefaultLocale</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">defaultLocale</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">&#34;Accept-Language&#34;</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">defaultLocale</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Locale</span> <span class="n">requestLocale</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getLocale</span><span class="o">();</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Locale</span><span class="o">&gt;</span> <span class="n">supportedLocales</span> <span class="o">=</span> <span class="n">getSupportedLocales</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">supportedLocales</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span> <span class="o">||</span> <span class="n">supportedLocales</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">requestLocale</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">requestLocale</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">Locale</span> <span class="n">supportedLocale</span> <span class="o">=</span> <span class="n">findSupportedLocale</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">supportedLocales</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">supportedLocale</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">supportedLocale</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">defaultLocale</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">defaultLocale</span> <span class="o">:</span> <span class="n">requestLocale</span><span class="o">);</span>
<span class="o">}</span>


<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">(</span>
        <span class="s">&#34;Cannot change HTTP accept header - use a different locale resolution strategy&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><hr>
<h3 id="2fixedlocaleresolver">2.FixedLocaleResolver</h3>
<ul>
<li>使用系统默认的区域信息</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Locale</span> <span class="nf">resolveLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="n">getDefaultLocale</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">locale</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">locale</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">LocaleContext</span> <span class="nf">resolveLocaleContext</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">TimeZoneAwareLocaleContext</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="nd">@Nullable</span>
        <span class="kd">public</span> <span class="n">Locale</span> <span class="nf">getLocale</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">getDefaultLocale</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="n">TimeZone</span> <span class="nf">getTimeZone</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">getDefaultTimeZone</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLocaleContext</span><span class="o">(</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                             <span class="nd">@Nullable</span> <span class="n">LocaleContext</span> <span class="n">localeContext</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">(</span><span class="s">&#34;Cannot change fixed locale - use a different locale resolution strategy&#34;</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><hr>
<h3 id="3sessionlocaleresolver">3.SessionLocaleResolver</h3>
<ul>
<li>
<p>区域信息是从<strong>session</strong>中获取</p>
</li>
<li>
<p>可以根据请求参数创建一个<strong>locale</strong>对象，把他放在<strong>session</strong>中</p>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Locale</span> <span class="nf">resolveLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="o">(</span><span class="n">Locale</span><span class="o">)</span> <span class="n">WebUtils</span><span class="o">.</span><span class="na">getSessionAttribute</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">localeAttributeName</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">locale</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">locale</span> <span class="o">=</span> <span class="n">determineDefaultLocale</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">locale</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><hr>
<h3 id="4cookielocaleresolver">4.CookieLocaleResolver</h3>
<ul>
<li>从cookie中获取区域信息（麻烦）</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Locale</span> <span class="nf">resolveLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">parseLocaleCookieIfNecessary</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">Locale</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">LOCALE_REQUEST_ATTRIBUTE_NAME</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><hr>
<hr>
<h2 id="6点击链接切换国际化">6、点击链接切换国际化</h2>
<ul>
<li>国际化信息是要能改变的</li>
</ul>
<p><img src="C:%5CUsers%5C%E9%99%86%E4%B9%BE%E9%BE%99%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20201212134627247.png" alt="image-20201212134627247"></p>
<h3 id="1自定义区域信息解析器推荐">1.自定义区域信息解析器(推荐)</h3>
<ol>
<li>
<p>实现<strong>LocaleResolver</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>
   
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>
   
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
   
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.LocaleResolver</span><span class="o">;</span>
   
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyLocaleResolver</span> <span class="kd">implements</span> <span class="n">LocaleResolver</span><span class="o">{</span>
   
 <span class="cm">/**
</span><span class="cm">  * 解析返回locale
</span><span class="cm">  */</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="n">Locale</span> <span class="nf">resolveLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>     <span class="c1">//zh_CN
</span><span class="c1"></span>     <span class="n">Locale</span> <span class="n">l</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
     <span class="n">String</span> <span class="n">localeStr</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;locale&#34;</span><span class="o">);</span>
     <span class="c1">//如果带了local参数就用指定的区域信息，如果没带就用请求头的
</span><span class="c1"></span>     <span class="k">if</span><span class="o">(</span><span class="n">localeStr</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="s">&#34;&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">localeStr</span><span class="o">)){</span>
         <span class="n">l</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Locale</span><span class="o">(</span><span class="n">localeStr</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&#34;_&#34;</span><span class="o">)[</span><span class="n">0</span><span class="o">],</span><span class="n">localeStr</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&#34;_&#34;</span><span class="o">)[</span><span class="n">1</span><span class="o">]);</span>
     <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
         <span class="n">l</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getLocale</span><span class="o">();</span>
     <span class="o">}</span>
     <span class="k">return</span> <span class="n">l</span><span class="o">;</span>
 <span class="o">}</span>
   
 <span class="cm">/**
</span><span class="cm">  * 修改locale
</span><span class="cm">  */</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">arg0</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">arg1</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">arg2</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// TODO Auto-generated method stub
</span><span class="c1"></span>     <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">(</span>
             <span class="s">&#34;Cannot change HTTP accept header - use a different locale resolution strategy&#34;</span><span class="o">);</span>
 <span class="o">}</span>
   
<span class="o">}</span>
   
</code></pre></div><hr>
</li>
<li>
<p>配置<strong>springmvc.xml</strong></p>
</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;!--</span> <span class="n">自定义区域信息解析器</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;localeResolver&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;com.lql.controller.MyLocaleResolver&#34;</span><span class="o">&gt;&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</code></pre></div><hr>
<h3 id="2区域信息从session中拿">2.区域信息从session中拿</h3>
<ol>
<li>
<p><strong>Controller</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>
   
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>
   
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
   
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.MessageSource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.ui.Model</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.i18n.SessionLocaleResolver</span><span class="o">;</span>
   
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">I18nTestController</span> <span class="o">{</span>
   
 <span class="nd">@Autowired</span>
 <span class="kd">private</span> <span class="n">MessageSource</span> <span class="n">messageSource</span><span class="o">;</span>
   	
 <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/tologinpage&#34;</span><span class="o">)</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="nf">tologinPage</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;locale&#34;</span><span class="o">,</span><span class="n">defaultValue</span><span class="o">=</span><span class="s">&#34;zh_CN&#34;</span><span class="o">)</span><span class="n">String</span> <span class="n">localeStr</span><span class="o">,</span><span class="n">Locale</span> <span class="n">locale</span><span class="o">,</span><span class="n">Model</span> <span class="n">model</span><span class="o">,</span><span class="n">HttpSession</span> <span class="n">session</span><span class="o">){</span>
     <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">locale</span><span class="o">);</span>
   		
     <span class="n">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">messageSource</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(</span><span class="s">&#34;welcominfo&#34;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">locale</span><span class="o">);</span>
     <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
     <span class="c1">//model.addAttribute(&#34;msg&#34;,message);
</span><span class="c1"></span>   		
     <span class="cm">/*//zh_CN
</span><span class="cm">     Locale l = null;
</span><span class="cm">     //如果带了local参数就用指定的区域信息，如果没带就用请求头的
</span><span class="cm">     if(localeStr != null &amp;&amp; !&#34;&#34;.equals(localeStr)){
</span><span class="cm">         l = new Locale(localeStr.split(&#34;_&#34;)[0],localeStr.split(&#34;_&#34;)[1]);
</span><span class="cm">     }else {
</span><span class="cm">         l = locale;
</span><span class="cm">     }
</span><span class="cm">     session.setAttribute(SessionLocaleResolver.class.getName() + &#34;.LOCALE&#34;, l);*/</span>
   		
     <span class="k">return</span> <span class="s">&#34;login&#34;</span><span class="o">;</span>
 <span class="o">}</span>
   	
 <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/test01&#34;</span><span class="o">)</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="nf">test01</span><span class="o">(){</span>
     <span class="k">return</span> <span class="s">&#34;login&#34;</span><span class="o">;</span>
 <span class="o">}</span>
<span class="o">}</span>
   
</code></pre></div><hr>
</li>
<li>
<p>配置<strong>springmvc.xml</strong></p>
</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!-- 区域信息从session中拿 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;localeResolver&#34;</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.i18n.SessionLocaleResolver&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
<span class="nt">&lt;mvc:interceptors&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&#34;</span><span class="nt">&gt;&lt;/bean&gt;</span>
<span class="nt">&lt;/mvc:interceptors&gt;</span>
</code></pre></div><h1 id="十二异常处理">十二、异常处理</h1>
<h2 id="1源码-1">1、源码</h2>
<h3 id="1handlerexceptionresolver">1.HandlerExceptionResolver</h3>
<ul>
<li>默认就是这几个:</li>
</ul>
<pre><code class="language-properties" data-lang="properties">org.springframework.web.servlet.HandlerExceptionResolver=org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,\
	org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\
	org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver
</code></pre><hr>
<h3 id="2异常处理">2.异常处理</h3>
<ul>
<li>如果异常解析器都不能处理就直接抛出去（给tomcat）</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">processDispatchResult</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
			<span class="nd">@Nullable</span> <span class="n">HandlerExecutionChain</span> <span class="n">mappedHandler</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">ModelAndView</span> <span class="n">mv</span><span class="o">,</span>
			<span class="nd">@Nullable</span> <span class="n">Exception</span> <span class="n">exception</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

		<span class="kt">boolean</span> <span class="n">errorView</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>	<span class="c1">//如果有异常
</span><span class="c1"></span>			<span class="k">if</span> <span class="o">(</span><span class="n">exception</span> <span class="k">instanceof</span> <span class="n">ModelAndViewDefiningException</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;ModelAndViewDefiningException encountered&#34;</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
				<span class="n">mv</span> <span class="o">=</span> <span class="o">((</span><span class="n">ModelAndViewDefiningException</span><span class="o">)</span> <span class="n">exception</span><span class="o">).</span><span class="na">getModelAndView</span><span class="o">();</span>
			<span class="o">}</span>
			<span class="k">else</span> <span class="o">{</span>	<span class="c1">//处理异常
</span><span class="c1"></span>				<span class="n">Object</span> <span class="n">handler</span> <span class="o">=</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">mappedHandler</span><span class="o">.</span><span class="na">getHandler</span><span class="o">()</span> <span class="o">:</span> <span class="kc">null</span><span class="o">);</span>
				<span class="n">mv</span> <span class="o">=</span> <span class="n">processHandlerException</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
				<span class="n">errorView</span> <span class="o">=</span> <span class="o">(</span><span class="n">mv</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="c1">// Did the handler return a view to render?
</span><span class="c1"></span>		<span class="k">if</span> <span class="o">(</span><span class="n">mv</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mv</span><span class="o">.</span><span class="na">wasCleared</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">//来到页面
</span><span class="c1"></span>			<span class="n">render</span><span class="o">(</span><span class="n">mv</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">errorView</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">WebUtils</span><span class="o">.</span><span class="na">clearErrorRequestAttributes</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="o">{</span>
			<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
				<span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;No view rendering, null ModelAndView returned.&#34;</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">WebAsyncUtils</span><span class="o">.</span><span class="na">getAsyncManager</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">isConcurrentHandlingStarted</span><span class="o">())</span> <span class="o">{</span>
			<span class="c1">// Concurrent handling started during a forward
</span><span class="c1"></span>			<span class="k">return</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">mappedHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// Exception (if any) is already handled..
</span><span class="c1"></span>			<span class="n">mappedHandler</span><span class="o">.</span><span class="na">triggerAfterCompletion</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>

</code></pre></div><hr>
<h3 id="3异常解析">3.异常解析</h3>
<ul>
<li>所有异常解析器尝试解析
<ul>
<li>解析完成进行后续</li>
<li>解析失败下一个解析器</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Nullable</span>
<span class="kd">protected</span> <span class="n">ModelAndView</span> <span class="nf">processHandlerException</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                                               <span class="nd">@Nullable</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="c1">// Success and error responses may use different content types
</span><span class="c1"></span>    <span class="n">request</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="n">HandlerMapping</span><span class="o">.</span><span class="na">PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE</span><span class="o">);</span>

    <span class="c1">// Check registered HandlerExceptionResolvers...
</span><span class="c1"></span>    <span class="n">ModelAndView</span> <span class="n">exMv</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">handlerExceptionResolvers</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">HandlerExceptionResolver</span> <span class="n">resolver</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">handlerExceptionResolvers</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">exMv</span> <span class="o">=</span> <span class="n">resolver</span><span class="o">.</span><span class="na">resolveException</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">exMv</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">exMv</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">exMv</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">EXCEPTION_ATTRIBUTE</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// We might still need view name translation for a plain error model...
</span><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">exMv</span><span class="o">.</span><span class="na">hasView</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">defaultViewName</span> <span class="o">=</span> <span class="n">getDefaultViewName</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">defaultViewName</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">exMv</span><span class="o">.</span><span class="na">setViewName</span><span class="o">(</span><span class="n">defaultViewName</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&#34;Using resolved error view: &#34;</span> <span class="o">+</span> <span class="n">exMv</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&#34;Using resolved error view: &#34;</span> <span class="o">+</span> <span class="n">exMv</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">WebUtils</span><span class="o">.</span><span class="na">exposeErrorRequestAttributes</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">ex</span><span class="o">,</span> <span class="n">getServletName</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">exMv</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="k">throw</span> <span class="n">ex</span><span class="o">;</span>
<span class="o">}</span>

</code></pre></div><hr>
<h2 id="2异常解析器用法">2、异常解析器用法</h2>
<hr>
<blockquote>
<ul>
<li>
<p><strong>ExceptionHandlerExceptionResolver：@ExceptionHandler</strong></p>
<ul>
<li><strong>Controller</strong>类</li>
</ul>
</li>
</ul>
<p><img src="https://i.loli.net/2020/12/12/lLfikdmWEC3bQBK.png" alt="image-20201212143044881"></p>
<hr>
<ul>
<li>
<p><strong>ResponseStatusExceptionResolver：@ResponseStatus</strong></p>
<ul>
<li>给自定义异常上标注</li>
</ul>
</li>
</ul>
<p><img src="https://i.loli.net/2020/12/09/xviaz6mGc7X1qSU.png" alt="image-20201209103116119"></p>
<ul>
<li>运行结果</li>
</ul>
<p><img src="https://i.loli.net/2020/12/09/wuJTZ5tznrEicK3.png" alt="image-20201209103206799"></p>
<hr>
<ul>
<li>
<p>DefaultHandlerExceptionResolver</p>
<ul>
<li>判断是否<strong>SpringMVC自己的异常</strong></li>
</ul>
</li>
<li>
<p>如：<strong>HttpRequestMethodNotSupportedException</strong></p>
</li>
<li>
<p>如果没人处理，报错</p>
</li>
</ul>
<p><img src="https://i.loli.net/2020/12/09/3rwEOhL2Fxl7HSK.png" alt="image-20201209104029542"></p>
<hr>
<ul>
<li>源码（遍历异常解析器）</li>
</ul>
<p><img src="https://i.loli.net/2020/12/09/QFjJfguskKYGzrv.png" alt="image-20201209104527817"></p>
<hr>
<ul>
<li>默认的异常</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="nd">@Nullable</span>
<span class="kd">protected</span> <span class="n">ModelAndView</span> <span class="nf">doResolveException</span><span class="o">(</span>
   <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>

   <span class="k">try</span> <span class="o">{</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">HttpRequestMethodNotSupportedException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleHttpRequestMethodNotSupported</span><span class="o">(</span>
               <span class="o">(</span><span class="n">HttpRequestMethodNotSupportedException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">HttpMediaTypeNotSupportedException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleHttpMediaTypeNotSupported</span><span class="o">(</span>
               <span class="o">(</span><span class="n">HttpMediaTypeNotSupportedException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">HttpMediaTypeNotAcceptableException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleHttpMediaTypeNotAcceptable</span><span class="o">(</span>
               <span class="o">(</span><span class="n">HttpMediaTypeNotAcceptableException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">MissingPathVariableException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleMissingPathVariable</span><span class="o">(</span>
               <span class="o">(</span><span class="n">MissingPathVariableException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">MissingServletRequestParameterException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleMissingServletRequestParameter</span><span class="o">(</span>
               <span class="o">(</span><span class="n">MissingServletRequestParameterException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">ServletRequestBindingException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleServletRequestBindingException</span><span class="o">(</span>
               <span class="o">(</span><span class="n">ServletRequestBindingException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">ConversionNotSupportedException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleConversionNotSupported</span><span class="o">(</span>
               <span class="o">(</span><span class="n">ConversionNotSupportedException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">TypeMismatchException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleTypeMismatch</span><span class="o">(</span>
               <span class="o">(</span><span class="n">TypeMismatchException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">HttpMessageNotReadableException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleHttpMessageNotReadable</span><span class="o">(</span>
               <span class="o">(</span><span class="n">HttpMessageNotReadableException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">HttpMessageNotWritableException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleHttpMessageNotWritable</span><span class="o">(</span>
               <span class="o">(</span><span class="n">HttpMessageNotWritableException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">MethodArgumentNotValidException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleMethodArgumentNotValidException</span><span class="o">(</span>
               <span class="o">(</span><span class="n">MethodArgumentNotValidException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">MissingServletRequestPartException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleMissingServletRequestPartException</span><span class="o">(</span>
               <span class="o">(</span><span class="n">MissingServletRequestPartException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">BindException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleBindException</span><span class="o">((</span><span class="n">BindException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">NoHandlerFoundException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleNoHandlerFoundException</span><span class="o">(</span>
               <span class="o">(</span><span class="n">NoHandlerFoundException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
       <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="n">AsyncRequestTimeoutException</span><span class="o">)</span> <span class="o">{</span>
           <span class="k">return</span> <span class="n">handleAsyncRequestTimeoutException</span><span class="o">(</span>
               <span class="o">(</span><span class="n">AsyncRequestTimeoutException</span><span class="o">)</span> <span class="n">ex</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
       <span class="o">}</span>
   <span class="o">}</span>
   <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">handlerEx</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isWarnEnabled</span><span class="o">())</span> <span class="o">{</span>
           <span class="n">logger</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;Failure while trying to resolve exception [&#34;</span> <span class="o">+</span> <span class="n">ex</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;]&#34;</span><span class="o">,</span> <span class="n">handlerEx</span><span class="o">);</span>
       <span class="o">}</span>
   <span class="o">}</span>
   <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><hr>
</blockquote>
<h2 id="3集中处理异常推荐">3、集中处理异常（推荐）</h2>
<ul>
<li>
<p><strong>@ControllerAdvice</strong>专门处理异常的类</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.lql.controller</span><span class="o">;</span>
  
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ControllerAdvice</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>
  
<span class="cm">/**
</span><span class="cm"> * 集中处理所有异常
</span><span class="cm"> * @author 陆乾龙
</span><span class="cm"> * 
</span><span class="cm"> * 1、集中处理所有异常的类加入到ioc容器中
</span><span class="cm"> * 2、@ControllerAdvice专门处理异常的类
</span><span class="cm"> */</span>
<span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyFocusExceptionController</span> <span class="o">{</span>
  
  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="n">ArithmeticException</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
  <span class="kd">public</span> <span class="n">ModelAndView</span> <span class="nf">handleException01</span><span class="o">(</span><span class="n">Exception</span> <span class="n">exception</span><span class="o">){</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;全局的handleException01....&#34;</span><span class="o">+</span><span class="n">exception</span><span class="o">);</span>
      <span class="c1">//
</span><span class="c1"></span>      <span class="n">ModelAndView</span> <span class="n">modelAndView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ModelAndView</span><span class="o">(</span><span class="s">&#34;myerror&#34;</span><span class="o">);</span>
      <span class="n">modelAndView</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">&#34;ex&#34;</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
      <span class="c1">//视图解析器拼串
</span><span class="c1"></span>      <span class="k">return</span> <span class="n">modelAndView</span><span class="o">;</span>
  <span class="o">}</span>
  	
  <span class="cm">/*@ExceptionHandler(value={Exception.class})
</span><span class="cm">  public ModelAndView handleException02(Exception exception){
</span><span class="cm">      System.out.println(&#34;全局的handleException02....&#34;+exception);
</span><span class="cm">      //
</span><span class="cm">      ModelAndView modelAndView = new ModelAndView(&#34;myerror&#34;);
</span><span class="cm">      modelAndView.addObject(&#34;ex&#34;, exception);
</span><span class="cm">      //视图解析器拼串
</span><span class="cm">      return modelAndView;
</span><span class="cm">  }*/</span>
<span class="o">}</span>
  
</code></pre></div></li>
</ul>
<hr>
<h2 id="4simplemappingexceptionresolver">4、<strong>SimpleMappingExceptionResolver</strong></h2>
<p><img src="https://i.loli.net/2020/12/09/RQrSdyO9kwaEG6h.png" alt="image-20201209110748416"></p>
<hr>
<ul>
<li>
<p>通过配置的方式进行异常处理</p>
<p><img src="https://i.loli.net/2020/12/12/jwNqMz4RV1E6G9b.png" alt="Snipaste_2020-12-12_14-43-07"></p>
</li>
</ul>
<p><img src="https://i.loli.net/2020/12/09/jQbMmAw12FlfzhR.png" alt="image-20201209113016885"></p>
<hr>
<h1 id="十三springmvc的运行流程">十三、SpringMVC的运行流程</h1>
<ol>
<li>==所有请求，前端控制器（<strong>DispatcherServlet</strong>）收到请求，调用<strong>doDispatch</strong>进行处理==</li>
<li>==根据<strong>HandlerMapping</strong>中保存的请求映射信息找到处理当前请求的<strong>处理器执行链</strong>（包含拦截器）==</li>
<li>==根据当前处理器找到它的<strong>HandlerAdapter</strong>（适配器）==</li>
<li>==拦截器的<strong>preHandle</strong>先执行==</li>
<li>==适配器执行目标方法，并返回<strong>ModelAndView</strong>==
<ol>
<li><strong>ModelAttribute</strong>注解标注的方法提前运行</li>
<li>确定目标方法用的参数（执行目标方法的时候）
<ol>
<li>有注解</li>
<li>没注解
<ol>
<li>看是否Model、Map以及其他的</li>
<li>如果是自定义类型
<ul>
<li>看隐含模型中有没有
<ul>
<li>有：从隐含模型中拿</li>
<li>没有：看是否<strong>SessionAttribute</strong>标注的属性
<ul>
<li>是：从<strong>Session</strong>中拿（拿不到会抛异常）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>都不是，就利用反射创建对象</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>==拦截器的<strong>postHandle</strong>执行==</li>
<li>==处理结果（页面渲染流程）==
<ol>
<li>==如果有异常，使用异常解析器处理异常（处理完后还会返回<strong>ModelAndView</strong>）==</li>
<li>==调用<strong>render</strong>进行页面渲染==
<ol>
<li>视图解析器根据视图名得到视图对象</li>
<li>视图对象调用<strong>render</strong>方法</li>
</ol>
</li>
<li>==执行拦截器的<strong>afterCompletion</strong>==</li>
</ol>
</li>
</ol>
<hr>
<p><img src="https://i.loli.net/2020/12/09/f7e6RkDbLHi5VgZ.png" alt="image-20201209133251981"></p>
<hr>
<h1 id="十四springmvc与spring整合">十四、SpringMVC与Spring整合</h1>
<h2 id="1目的分工明确">1、目的（分工明确）</h2>
<h2 id="2配置文件">2、配置文件</h2>
<table>
<thead>
<tr>
<th>配置文件</th>
<th>配置相关</th>
</tr>
</thead>
<tbody>
<tr>
<td>SpringMVC</td>
<td>网站转发逻辑、网站功能（视图解析器，文件上传解析器，支持ajax，等等）</td>
</tr>
<tr>
<td>Spring</td>
<td>业务（事务控制，数据源，等等）</td>
</tr>
</tbody>
</table>
<ul>
<li>springmvc.xml中加入<code>&lt;import resource=&quot;spring.xml&quot;/&gt;</code>可以合并配置文件</li>
</ul>
<hr>
<h2 id="3springmvc和spring分容器">3、SpringMVC和Spring分容器</h2>
<ul>
<li>Spring管理业务逻辑组件</li>
</ul>
<p><img src="https://i.loli.net/2020/12/12/1p2ti3sBX6Zzqu9.png" alt="image-20201212154435679"></p>
<ul>
<li>SpringMVC管理控制器组件
<ul>
<li><code>use-default-filters=&quot;false&quot;</code>：禁用默认行为，让<strong>include-filter</strong>起作用</li>
</ul>
</li>
</ul>
<p><img src="https://i.loli.net/2020/12/12/BSGqaMoehxmZ9RC.png" alt="image-20201212154607259"></p>
<hr>
<h2 id="4-spring-mvc-配置文件中引用业务层的-bean">4、 Spring MVC 配置文件中引用业务层的 Bean</h2>
<ul>
<li>
<p>多个 Spring IOC 容器之间可以设置为父子关系，以实现良好的解耦。</p>
</li>
<li>
<p>Spring MVC WEB 层容器可作为 “业务层” Spring 容器的子容器</p>
<ul>
<li>即 WEB 层容器可以引用业务层容器的 Bean，而业务层容器却访问不到 WEB 层容器的 Bean</li>
</ul>
</li>
</ul>
<p><img src="https://i.loli.net/2020/12/09/pHbD6BwOQPGkCS5.png" alt="image-20201209150330898"></p>
<hr>

    
	</div>
  <footer class="article-footer clearfix">
  

<div class="article-tags">
  <span></span>
  
  <a href="https://qianlong98.github.io/tags/spring-mvc">Spring MVC</a>
  
  <a href="https://qianlong98.github.io/tags/%E7%AC%94%E8%AE%B0">笔记</a>
  
</div>





<div class="article-categories">
  <span></span>
  
  <a class="article-category-link" href="https://qianlong98.github.io/categories/%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">个人学习笔记</a>
  
</div>



  <div class="article-share" id="share">
    <div data-url="https://qianlong98.github.io/post/spring-mvc%E5%AD%A6%E4%B9%A0/" data-title="Spring MVC学习" data-tsina="1816308191" class="share clearfix">
    </div>
  </div>
</footer>

	</article>
  


<section class="comment">
<div id="disqus_thread"></div>
</section>
<script>
  
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '//disqus.com/next/config.json?' + new Date().getTime(), true);
  xhr.timeout = 3000; 

  xhr.onload = function() { 


var disqus_config = function () {
this.page.url = "https:\/\/qianlong98.github.io\/post\/spring-mvc%E5%AD%A6%E4%B9%A0\/"
this.page.identifier = "https:\/\/qianlong98.github.io\/post\/spring-mvc%E5%AD%A6%E4%B9%A0\/"
};
(function() { 
var d = document, s = d.createElement('script');

s.src = '//qianlong98.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
}
  xhr.ontimeout = function() {
  
  return;
}
xhr.send(null);
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</div>

    <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>
<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
  

<div class="categorieslist">
  <p class="asidetitle">分类</p>
  <ul>
    
    <li><a href="https://qianlong98.github.io/categories/%e4%b8%aa%e4%ba%ba%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0" title="个人学习笔记">个人学习笔记<sup>7</sup></a></li>
    
    <li><a href="https://qianlong98.github.io/categories/%e6%8a%80%e6%9c%af%e6%96%87%e7%ab%a0-%e5%8e%9f%e5%88%9b" title="技术文章-原创">技术文章-原创<sup>1</sup></a></li>
    
    <li><a href="https://qianlong98.github.io/categories/%e6%8a%80%e6%9c%af%e6%96%87%e7%ab%a0-%e8%bd%ac%e8%bd%bd" title="技术文章-转载">技术文章-转载<sup>2</sup></a></li>
    
  </ul>
</div>



  

<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
      
			<li><a href="https://qianlong98.github.io/tags/blog" title="blog">blog<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/git" title="git">git<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/hibernate" title="hibernate">hibernate<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/javascript" title="javascript">javascript<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/maven" title="maven">maven<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/mybatis" title="mybatis">mybatis<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/mysql" title="mysql">mysql<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/spring" title="spring">spring<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/spring-boot" title="spring-boot">spring-boot<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/spring-mvc" title="spring-mvc">spring-mvc<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/web" title="web">web<sup>1</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/%e6%95%b0%e6%8d%ae%e5%ba%93" title="数据库">数据库<sup>2</sup></a></li>
      
			<li><a href="https://qianlong98.github.io/tags/%e7%ac%94%e8%ae%b0" title="笔记">笔记<sup>5</sup></a></li>
      
		</ul>
</div>



  
  <div class="archiveslist">
    <p class="asidetitle">归档</p>
    <ul class="archive-list">
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://qianlong98.github.io/post/#2020-12">2020年12月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://qianlong98.github.io/post/#2020-11">2020年11月</a><span class="archive-list-count">5</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://qianlong98.github.io/post/#2020-10">2020年10月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://qianlong98.github.io/post/#2020-09">2020年09月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="https://qianlong98.github.io/post/#0001-01">0001年01月</a><span class="archive-list-count">1</span>
      </li>
      
    </ul>

  </div>


  

<div class="tagcloudlist">
  <p class="asidetitle">标签云</p>
  <div class="tagcloudlist clearfix">
    
    <a href="https://qianlong98.github.io/tags/blog" style="font-size: 12px;">blog</a>
    
    <a href="https://qianlong98.github.io/tags/git" style="font-size: 12px;">git</a>
    
    <a href="https://qianlong98.github.io/tags/hibernate" style="font-size: 12px;">hibernate</a>
    
    <a href="https://qianlong98.github.io/tags/javascript" style="font-size: 12px;">javascript</a>
    
    <a href="https://qianlong98.github.io/tags/maven" style="font-size: 12px;">maven</a>
    
    <a href="https://qianlong98.github.io/tags/mybatis" style="font-size: 12px;">mybatis</a>
    
    <a href="https://qianlong98.github.io/tags/mysql" style="font-size: 12px;">mysql</a>
    
    <a href="https://qianlong98.github.io/tags/spring" style="font-size: 12px;">spring</a>
    
    <a href="https://qianlong98.github.io/tags/spring-boot" style="font-size: 12px;">spring-boot</a>
    
    <a href="https://qianlong98.github.io/tags/spring-mvc" style="font-size: 12px;">spring-mvc</a>
    
    <a href="https://qianlong98.github.io/tags/web" style="font-size: 12px;">web</a>
    
    <a href="https://qianlong98.github.io/tags/%e6%95%b0%e6%8d%ae%e5%ba%93" style="font-size: 12px;">数据库</a>
    
    <a href="https://qianlong98.github.io/tags/%e7%ac%94%e8%ae%b0" style="font-size: 12px;">笔记</a>
    
  </div>
</div>



  

</aside>
</div>

  </div>
  <footer><div id="footer" >
  <div class="line">
    <span></span>
    
    <div style='background:no-repeat url("https://qianlong98.github.io/img/author.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <section class="info">
    <p>不要再甘于平庸 <br/> 做人上人要有野心</p>
  </section>
  <div class="social-font clearfix">
    <a href='http://weibo.com/qianlong98' target="_blank" title="weibo"></a>
    
    <a href='https://github.com/qianlong98' target="_blank" title="github"></a>
    
  
  </div>
  <p class="copyright">Powered by <a href="http://gohugo.io" target="_blank" title="hugo">hugo</a> and Name by <a href="https://weibo.com/u/6969049127?refer_flag=1005050005_&is_all=1" target="_blank" title="花生帆">花生帆小姐姐</a> © 2021
    
    <a href="https://qianlong98.github.io/" title="代码L">代码L</a>
    
  </p>
</div>
</footer>
  <script src="https://qianlong98.github.io/js/jquery-2.1.0.min.js"></script>

<script src="https://qianlong98.github.io/js/qrcode.js"></script>
<script type="text/javascript">
done = false;
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  $('form.search').on('submit', function (event) {
    if (false === done) {
      event.preventDefault();
      var orgVal = $(this).find('#search').val();
      $(this).find('#search').val('site:https:\/\/qianlong98.github.io\/ ' + orgVal);
      done = true;
      $(this).submit();
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="https://b.bshare.cn/barCode?site=weixin&url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});
</script>


<link rel="stylesheet" href="https://qianlong98.github.io/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="https://qianlong98.github.io/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
});
</script>




</body>
</html>
